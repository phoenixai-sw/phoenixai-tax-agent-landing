<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>양도세 챗봇</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* API 설정 모달 */
        .api-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }

        .api-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            min-width: 500px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .api-content h2 {
            color: #333;
            margin-bottom: 30px;
            font-size: 24px;
        }

        .api-form {
            margin-bottom: 30px;
        }

        .api-section {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
        }

        .api-section h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .api-input {
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
        }

        .api-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .api-button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .api-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .login-input {
            width: 100%;
            padding: 15px;
            margin-bottom: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            text-align: center;
        }

        .login-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .login-button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .login-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .error-message {
            color: #e74c3c;
            margin-top: 15px;
            font-size: 14px;
        }

        .success-message {
            color: #27ae60;
            margin-top: 15px;
            font-size: 14px;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .chat-container {
            width: 100%;
            max-width: 800px;
            height: 90vh;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            text-align: center;
            border-radius: 20px 20px 0 0;
            position: relative;
        }

        .header h1 {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .header p {
            opacity: 0.9;
            font-size: 16px;
        }

        .api-settings-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            border-radius: 20px;
            padding: 8px 16px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .api-settings-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .model-selector {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 15px;
            padding: 8px 12px;
            color: white;
            font-size: 12px;
            cursor: pointer;
        }

        .model-selector option {
            color: #333;
        }

        .messages {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            background: #f8f9fa;
        }

        .message {
            margin-bottom: 25px;
            display: flex;
            align-items: flex-start;
            gap: 15px;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .message.bot .message-avatar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .message.user .message-avatar {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .message-content {
            max-width: 75%;
            padding: 20px 25px;
            border-radius: 25px;
            line-height: 1.6;
            font-size: 15px;
            word-wrap: break-word;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .message.bot .message-content {
            background: white;
            color: #333;
            border-bottom-left-radius: 8px;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border-bottom-right-radius: 8px;
        }

        .input-area {
            padding: 25px;
            background: white;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 15px;
            align-items: flex-end;
        }

        .input-area textarea {
            flex: 1;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            padding: 15px 25px;
            font-size: 16px;
            resize: none;
            outline: none;
            min-height: 55px;
            max-height: 120px;
            font-family: inherit;
            transition: border-color 0.3s ease;
        }

        .input-area textarea:focus {
            border-color: #667eea;
        }

        .send-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 50%;
            width: 55px;
            height: 55px;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.3s ease;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .send-button:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .send-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .loading-dots {
            display: inline-block;
        }

        .loading-dots::after {
            content: '';
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 80% { content: '...'; }
            100% { content: ''; }
        }

        .welcome-message {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }

        .welcome-message h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 24px;
        }

        .welcome-message p {
            font-size: 16px;
            line-height: 1.6;
        }

        /* 크롬 전용 스타일 */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
        }

        /* 모바일 반응형 */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .chat-container {
                height: 95vh;
                border-radius: 15px;
            }
            
            .header {
                padding: 20px;
                border-radius: 15px 15px 0 0;
            }
            
            .header h1 {
                font-size: 24px;
            }
            
            .messages {
                padding: 20px;
            }
            
            .message-content {
                max-width: 85%;
                padding: 15px 20px;
                font-size: 14px;
            }
            
            .input-area {
                padding: 20px;
                gap: 12px;
            }
            
            .input-area textarea {
                padding: 12px 20px;
                font-size: 16px;
            }
            
            .send-button {
                width: 50px;
                height: 50px;
                font-size: 18px;
            }

            .api-content {
                min-width: 90%;
                padding: 30px 20px;
            }
        }
    </style>
</head>
<body>
    <div class="chat-container" id="chatContainer">
        <div class="header">
            <select class="model-selector" id="modelSelector">
                <option value="openai">OpenAI GPT-4o</option>
                <option value="google">Google Gemini 2.5</option>
                <option value="anthropic">Claude Sonnet 4</option>
                <option value="perplexity">Perplexity Sonar Pro</option>
            </select>
            <button class="api-settings-btn" onclick="openApiSettings()">⚙️ API 설정</button>
            <h1>💰 Tax Agent</h1>
            <p>양도소득세 관련 궁금한 점을 물어보세요</p>
        </div>

        <div class="messages" id="messages">
            <div class="welcome-message">
                <h2>안녕하세요! 👋</h2>
                <p>Tax Agent 양도소득세 전문 상담사입니다.<br>
                궁금한 점이 있으시면 언제든 질문해주세요.</p>
            </div>
        </div>

        <div class="input-area">
            <textarea 
                id="messageInput" 
                placeholder="양도세 관련 질문을 입력하세요..."
                rows="1"
            ></textarea>
            <button class="send-button" id="sendButton" onclick="sendMessage()">
                ➤
            </button>
        </div>
    </div>

    <!-- API 설정 모달 -->
    <div class="api-modal" id="apiModal">
        <div class="api-content">
            <h2>🔧 API 설정</h2>
            
            <!-- 로그인 섹션 -->
            <div id="loginSection">
                <div class="api-form">
                    <input type="text" class="login-input" id="loginId" placeholder="아이디" value="">
                    <input type="password" class="login-input" id="loginPw" placeholder="비밀번호" value="">
                    <button class="login-button" onclick="handleApiLogin()">로그인</button>
                    <div class="error-message" id="loginError"></div>
                </div>
            </div>

            <!-- API 설정 섹션 -->
            <div id="apiSettingsSection" style="display: none;">
                <!-- OpenAI -->
                <div class="api-section">
                    <h3>🤖 OpenAI (GPT-4o)</h3>
                    <input type="password" class="api-input" id="openaiKey" placeholder="OpenAI API Key">
                </div>

                <!-- Google -->
                <div class="api-section">
                    <h3>🌟 Google (Gemini 2.5)</h3>
                    <input type="password" class="api-input" id="googleKey" placeholder="Google API Key">
                </div>

                <!-- Anthropic -->
                <div class="api-section">
                    <h3>🧠 Anthropic (Claude Sonnet 4)</h3>
                    <input type="password" class="api-input" id="anthropicKey" placeholder="Anthropic API Key">
                </div>

                <!-- Perplexity -->
                <div class="api-section">
                    <h3>🔍 Perplexity</h3>
                    <input type="password" class="api-input" id="perplexityKey" placeholder="Perplexity API Key">
                </div>

                <button class="api-button" onclick="saveApiKeys()">API 키 저장</button>
                <button class="api-button" onclick="closeApiSettings()" style="background: #6c757d; margin-top: 10px;">닫기</button>
                <div class="success-message" id="apiSuccess"></div>
                <div class="error-message" id="apiError"></div>
            </div>
        </div>
    </div>

    <script>
        // 전역 변수
        let isLoading = false;
        let apiKeys = {
            openai: '',
            google: '',
            anthropic: '',
            perplexity: ''
        };

        // 브라우저 확인 (크롬만 지원)
        function checkBrowser() {
            const isChrome = /Chrome/.test(navigator.userAgent) && /Google Inc/.test(navigator.vendor);
            if (!isChrome) {
                alert('이 챗봇은 Google Chrome 브라우저에서만 사용할 수 있습니다.\n\nChrome 브라우저로 접속해주세요.');
                document.body.innerHTML = `
                    <div style="display: flex; justify-content: center; align-items: center; height: 100vh; background: #f5f5f5; font-family: 'Segoe UI', sans-serif;">
                        <div style="text-align: center; padding: 40px; background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.1);">
                            <h1 style="color: #333; margin-bottom: 20px;">🚫 지원되지 않는 브라우저</h1>
                            <p style="color: #666; font-size: 18px; margin-bottom: 30px;">이 챗봇은 Google Chrome 브라우저에서만 사용할 수 있습니다.</p>
                            <a href="https://www.google.com/chrome/" target="_blank" 
                               style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-decoration: none; padding: 15px 30px; border-radius: 25px; font-weight: bold;">
                                Chrome 다운로드
                            </a>
                        </div>
                    </div>
                `;
                return false;
            }
            return true;
        }

        // 초기화
        document.addEventListener('DOMContentLoaded', function() {
            if (!checkBrowser()) return;
            
            loadApiKeys();
            setupEventListeners();
        });

        // API 설정 모달 열기
        function openApiSettings() {
            document.getElementById('apiModal').style.display = 'flex';
            document.getElementById('loginSection').style.display = 'block';
            document.getElementById('apiSettingsSection').style.display = 'none';
            document.getElementById('loginError').textContent = '';
        }

        // API 설정 모달 닫기
        function closeApiSettings() {
            document.getElementById('apiModal').style.display = 'none';
        }

        // API 로그인 처리
        function handleApiLogin() {
            const loginId = document.getElementById('loginId').value;
            const loginPw = document.getElementById('loginPw').value;
            const errorEl = document.getElementById('loginError');
            
            if (loginId === '004050' && loginPw === '004050') {
                document.getElementById('loginSection').style.display = 'none';
                document.getElementById('apiSettingsSection').style.display = 'block';
                errorEl.textContent = '';
                loadApiKeysToInputs();
            } else {
                errorEl.textContent = '아이디 또는 비밀번호가 잘못되었습니다.';
                document.getElementById('loginPw').value = '';
            }
        }

        // 이벤트 리스너 설정
        function setupEventListeners() {
            const input = document.getElementById('messageInput');
            
            // 엔터키로 메시지 전송
            input.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            // 텍스트 영역 자동 크기 조절
            input.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 120) + 'px';
            });

            // 로그인 엔터키 이벤트
            document.getElementById('loginId').addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    document.getElementById('loginPw').focus();
                }
            });
            
            document.getElementById('loginPw').addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    handleApiLogin();
                }
            });
        }

        // API 키 저장
        function saveApiKeys() {
            apiKeys.openai = document.getElementById('openaiKey').value;
            apiKeys.google = document.getElementById('googleKey').value;
            apiKeys.anthropic = document.getElementById('anthropicKey').value;
            apiKeys.perplexity = document.getElementById('perplexityKey').value;
            
            // 로컬 스토리지에 저장 (암호화된 형태로)
            const encodedKeys = btoa(JSON.stringify(apiKeys));
            localStorage.setItem('tax_chatbot_api_keys', encodedKeys);
            
            document.getElementById('apiSuccess').textContent = 'API 키가 성공적으로 저장되었습니다.';
            setTimeout(() => {
                document.getElementById('apiSuccess').textContent = '';
            }, 3000);
        }

        // API 키 로드
        function loadApiKeys() {
            try {
                const encodedKeys = localStorage.getItem('tax_chatbot_api_keys');
                if (encodedKeys) {
                    apiKeys = JSON.parse(atob(encodedKeys));
                }
            } catch (error) {
                console.error('API 키 로드 실패:', error);
            }
        }

        // API 키를 입력 필드에 로드
        function loadApiKeysToInputs() {
            document.getElementById('openaiKey').value = apiKeys.openai || '';
            document.getElementById('googleKey').value = apiKeys.google || '';
            document.getElementById('anthropicKey').value = apiKeys.anthropic || '';
            document.getElementById('perplexityKey').value = apiKeys.perplexity || '';
        }

        // 메시지 전송
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message || isLoading) return;
            
            const selectedModel = document.getElementById('modelSelector').value;
            if (!apiKeys[selectedModel]) {
                alert(`${getModelDisplayName(selectedModel)} API 키가 설정되지 않았습니다. API 설정에서 키를 입력해주세요.`);
                return;
            }
            
            addUserMessage(message);
            input.value = '';
            input.style.height = 'auto';
            
            processMessage(message, selectedModel);
        }

        // 모델 표시 이름 가져오기
        function getModelDisplayName(model) {
            const names = {
                openai: 'OpenAI GPT-4o',
                google: 'Google Gemini 2.5',
                anthropic: 'Claude Sonnet 4',
                perplexity: 'Perplexity'
            };
            return names[model] || model;
        }

        // 메시지 처리
        async function processMessage(message, model) {
            if (isLoading) return;
            
            setLoading(true);
            
            try {
                const response = await callAPI(message, model);
                addBotMessage(response);
            } catch (error) {
                console.error('API 호출 오류:', error);
                addBotMessage('죄송합니다. 일시적인 오류가 발생했습니다. 잠시 후 다시 시도해주세요.');
            } finally {
                setLoading(false);
            }
        }

        // API 호출
        async function callAPI(message, model) {
            const systemPrompt = `당신은 한국의 양도소득세 전문가입니다. 다음 가이드라인을 따라 답변해주세요:

1. 양도소득세 관련 질문에 정확하고 상세한 답변을 제공하세요.
2. 관련 법률이나 세율, 공제 혜택 등을 명확히 설명하세요.
3. 복잡한 내용은 단계별로 나누어 설명하세요.
4. 실제 사례나 예시를 들어 이해하기 쉽게 설명하세요.
5. 세법 변경사항이 있을 경우 최신 정보를 제공하세요.
6. 답변은 한국어로 친근하고 전문적인 톤으로 작성하세요.`;

            switch (model) {
                case 'openai':
                    return await callOpenAI(message, systemPrompt);
                case 'google':
                    return await callGoogle(message, systemPrompt);
                case 'anthropic':
                    return await callAnthropic(message, systemPrompt);
                case 'perplexity':
                    return await callPerplexity(message, systemPrompt);
                default:
                    throw new Error('지원되지 않는 모델입니다.');
            }
        }

        // OpenAI API 호출
        async function callOpenAI(message, systemPrompt) {
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKeys.openai}`
                },
                body: JSON.stringify({
                    model: 'gpt-4o',
                    messages: [
                        { role: 'system', content: systemPrompt },
                        { role: 'user', content: message }
                    ],
                    max_tokens: 2000,
                    temperature: 0.7
                })
            });

            if (!response.ok) {
                throw new Error(`OpenAI API 오류: ${response.status}`);
            }

            const data = await response.json();
            return data.choices[0].message.content;
        }

        // Google Gemini API 호출
        async function callGoogle(message, systemPrompt) {
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${apiKeys.google}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    contents: [{
                        parts: [{
                            text: `${systemPrompt}\n\n사용자 질문: ${message}`
                        }]
                    }]
                })
            });

            if (!response.ok) {
                throw new Error(`Google API 오류: ${response.status}`);
            }

            const data = await response.json();
            return data.candidates[0].content.parts[0].text;
        }

        // Anthropic Claude API 호출
        async function callAnthropic(message, systemPrompt) {
            const response = await fetch('https://api.anthropic.com/v1/messages', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'x-api-key': apiKeys.anthropic,
                    'anthropic-version': '2023-06-01'
                },
                body: JSON.stringify({
                    model: 'claude-3-5-sonnet-20241022',
                    max_tokens: 2000,
                    system: systemPrompt,
                    messages: [
                        { role: 'user', content: message }
                    ]
                })
            });

            if (!response.ok) {
                throw new Error(`Anthropic API 오류: ${response.status}`);
            }

            const data = await response.json();
            return data.content[0].text;
        }

        // Perplexity API 호출
        async function callPerplexity(message, systemPrompt) {
            const response = await fetch('https://api.perplexity.ai/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKeys.perplexity}`
                },
                body: JSON.stringify({
                    model: 'sonar-pro',
                    messages: [
                        { role: 'system', content: systemPrompt },
                        { role: 'user', content: message }
                    ],
                    max_tokens: 2000,
                    temperature: 0.7
                })
            });

            if (!response.ok) {
                throw new Error(`Perplexity API 오류: ${response.status}`);
            }

            const data = await response.json();
            return data.choices[0].message.content;
        }

        // 사용자 메시지 추가
        function addUserMessage(message) {
            const messagesEl = document.getElementById('messages');
            const messageEl = document.createElement('div');
            messageEl.className = 'message user';
            messageEl.innerHTML = `
                <div class="message-avatar">👤</div>
                <div class="message-content">${escapeHtml(message)}</div>
            `;
            messagesEl.appendChild(messageEl);
            scrollToBottom();
        }

        // 봇 메시지 추가
        function addBotMessage(message) {
            const messagesEl = document.getElementById('messages');
            const messageEl = document.createElement('div');
            messageEl.className = 'message bot';
            messageEl.innerHTML = `
                <div class="message-avatar">💰</div>
                <div class="message-content">${formatMessage(message)}</div>
            `;
            messagesEl.appendChild(messageEl);
            scrollToBottom();
        }

        // 메시지 포맷팅
        function formatMessage(message) {
            // 줄바꿈을 <br>로 변환
            message = message.replace(/\n/g, '<br>');
            
            // **텍스트** -> <strong>텍스트</strong>
            message = message.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            
            // *텍스트* -> <em>텍스트</em>
            message = message.replace(/\*(.*?)\*/g, '<em>$1</em>');
            
            // ### 제목 -> h3 스타일
            message = message.replace(/^### (.*?)$/gm, '<h3 style="color: #667eea; margin: 20px 0 10px 0; font-size: 18px;">$1</h3>');
            
            // ## 제목 -> h2 스타일  
            message = message.replace(/^## (.*?)$/gm, '<h2 style="color: #333; margin: 25px 0 15px 0; font-size: 20px;">$1</h2>');
            
            // # 제목 -> h1 스타일
            message = message.replace(/^# (.*?)$/gm, '<h1 style="color: #333; margin: 30px 0 20px 0; font-size: 22px;">$1</h1>');
            
            // --- 구분선
            message = message.replace(/^---$/gm, '<hr style="border: none; height: 2px; background: linear-gradient(90deg, #667eea, #764ba2); margin: 20px 0; border-radius: 1px;">');
            
            // ▶ 기호 스타일링
            message = message.replace(/▶ (.*?)$/gm, '<div style="margin: 15px 0; padding: 10px 15px; background: #f8f9fa; border-left: 4px solid #667eea; border-radius: 0 8px 8px 0;"><strong>▶ $1</strong></div>');
            
            // ✅ 체크마크 스타일링
            message = message.replace(/✅ (.*?)$/gm, '<div style="margin: 10px 0; padding: 8px 12px; background: #e8f5e8; border-left: 3px solid #28a745; border-radius: 0 5px 5px 0;">✅ $1</div>');
            
            // • 리스트 항목
            message = message.replace(/^• (.*?)$/gm, '<div style="margin: 8px 0; padding-left: 20px;">• $1</div>');
            
            return message;
        }

        // 로딩 상태 설정
        function setLoading(loading) {
            isLoading = loading;
            const sendButton = document.getElementById('sendButton');
            
            if (loading) {
                sendButton.disabled = true;
                sendButton.innerHTML = '<span class="loading-dots"></span>';
                
                // 로딩 메시지 표시
                const messagesEl = document.getElementById('messages');
                const loadingEl = document.createElement('div');
                loadingEl.className = 'message bot';
                loadingEl.id = 'loadingMessage';
                loadingEl.innerHTML = `
                    <div class="message-avatar">💰</div>
                    <div class="message-content">답변을 준비하고 있습니다<span class="loading-dots"></span></div>
                `;
                messagesEl.appendChild(loadingEl);
                scrollToBottom();
            } else {
                sendButton.disabled = false;
                sendButton.innerHTML = '➤';
                
                // 로딩 메시지 제거
                const loadingEl = document.getElementById('loadingMessage');
                if (loadingEl) {
                    loadingEl.remove();
                }
            }
        }

        // 하단으로 스크롤
        function scrollToBottom() {
            const messagesEl = document.getElementById('messages');
            messagesEl.scrollTop = messagesEl.scrollHeight;
        }

        // HTML 이스케이프
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>