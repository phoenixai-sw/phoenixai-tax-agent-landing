<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>양도세 챗봇</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* API 설정 모달 */
        .api-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }

        .api-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            min-width: 500px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .api-content h2 {
            color: #333;
            margin-bottom: 30px;
            font-size: 24px;
        }

        .api-form {
            margin-bottom: 30px;
        }

        .api-section {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
        }

        .api-section h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .api-input {
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
        }

        .api-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .api-button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .api-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .login-input {
            width: 100%;
            padding: 15px;
            margin-bottom: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            text-align: center;
        }

        .login-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .login-button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .login-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .error-message {
            color: #e74c3c;
            margin-top: 15px;
            font-size: 14px;
        }

        .success-message {
            color: #27ae60;
            margin-top: 15px;
            font-size: 14px;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .chat-container {
            width: 100%;
            max-width: 800px;
            height: 90vh;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            text-align: center;
            border-radius: 20px 20px 0 0;
            position: relative;
        }

        .header h1 {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .header p {
            opacity: 0.9;
            font-size: 16px;
        }

        .api-settings-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            border-radius: 20px;
            padding: 8px 16px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .api-settings-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .n8n-status {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255,255,255,0.2);
            color: white;
            border-radius: 20px;
            padding: 8px 16px;
            font-size: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-light {
            width: 8px;
            height: 8px;
            background: #00ff00;
            border-radius: 50%;
            animation: blink 1.5s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }

        .messages {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            background: #f8f9fa;
        }

        .message {
            margin-bottom: 25px;
            display: flex;
            align-items: flex-start;
            gap: 15px;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .message.bot .message-avatar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .message.user .message-avatar {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .message-content {
            max-width: 75%;
            padding: 20px 25px;
            border-radius: 25px;
            line-height: 1.6;
            font-size: 15px;
            word-wrap: break-word;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .message.bot .message-content {
            background: white;
            color: #333;
            border-bottom-left-radius: 8px;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border-bottom-right-radius: 8px;
        }
        


        /* 메시지 액션 버튼들 */
        .message-actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            align-items: center;
        }

        .action-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
            border-radius: 5px;
            transition: all 0.2s ease;
            font-size: 14px;
            color: #666;
        }

        .action-btn:hover {
            background: #f0f0f0;
            color: #333;
        }

        .copy-btn {
            color: #667eea;
        }

        .copy-btn:hover {
            background: #e8f0ff;
        }

        .feedback-btn {
            color: #28a745;
        }

        .feedback-btn:hover {
            background: #e8f5e8;
        }

        .feedback-btn.negative {
            color: #dc3545;
        }

        .feedback-btn.negative:hover {
            background: #ffe8e8;
        }

        /* 코멘트 모달 */
        .comment-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10001;
        }

        .comment-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            min-width: 400px;
            max-width: 500px;
        }

        .comment-content h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 20px;
        }

        .comment-textarea {
            width: 100%;
            min-height: 100px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
            margin-bottom: 20px;
        }

        .comment-textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .comment-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .comment-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .comment-save {
            background: #28a745;
            color: white;
        }

        .comment-save:hover {
            background: #218838;
        }

        .comment-cancel {
            background: #6c757d;
            color: white;
        }

        .comment-cancel:hover {
            background: #5a6268;
        }

        /* 관리자 모드 모달 */
        .admin-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10002;
        }

        .admin-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            min-width: 600px;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .admin-content h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 22px;
        }

        .feedback-list {
            text-align: left;
            margin-top: 20px;
        }

        .feedback-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }

        .feedback-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .feedback-type {
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            color: white;
        }

        .feedback-type.positive {
            background: #28a745;
        }

        .feedback-type.negative {
            background: #dc3545;
        }

        /* n8n 엔진 제어 섹션 */
        .n8n-control-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            border: 2px solid #e0e0e0;
        }

        .n8n-status-display {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }

        .n8n-control-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .n8n-control-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
        }

        .n8n-control-btn.n8n-on {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }

        .n8n-control-btn.n8n-on:hover {
            background: linear-gradient(135deg, #218838 0%, #1ea085 100%);
            transform: translateY(-2px);
        }

        .n8n-control-btn.n8n-off {
            background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);
            color: white;
        }

        .n8n-control-btn.n8n-off:hover {
            background: linear-gradient(135deg, #c82333 0%, #e8590c 100%);
            transform: translateY(-2px);
        }

        .feedback-section h4 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 18px;
            text-align: center;
        }

        .feedback-date {
            color: #666;
            font-size: 12px;
        }

        .feedback-question {
            font-weight: bold;
            margin-bottom: 8px;
            color: #333;
        }

        .feedback-answer {
            color: #666;
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .feedback-comment {
            background: white;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            color: #333;
        }

        .download-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .input-area {
            padding: 25px;
            background: white;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 15px;
            align-items: flex-end;
        }

        .input-area textarea {
            flex: 1;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            padding: 15px 25px;
            font-size: 16px;
            resize: none;
            outline: none;
            min-height: 55px;
            max-height: 120px;
            font-family: inherit;
            transition: border-color 0.3s ease;
        }

        .input-area textarea:focus {
            border-color: #667eea;
        }

        .send-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 50%;
            width: 55px;
            height: 55px;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.3s ease;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .send-button:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .send-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .stop-button, .restart-button {
            background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);
            color: white;
            border: none;
            border-radius: 50%;
            width: 55px;
            height: 55px;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.3s ease;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.4);
            margin-left: 10px;
        }

        .stop-button:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(220, 53, 69, 0.6);
        }

        .restart-button {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.4);
        }

        .restart-button:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.6);
        }

        .loading-dots {
            display: inline-block;
        }

        .loading-dots::after {
            content: '';
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 80% { content: '...'; }
            100% { content: ''; }
        }

        .welcome-message {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }

        .welcome-message h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 24px;
        }

        .welcome-message p {
            font-size: 16px;
            line-height: 1.6;
        }

        /* 크롬 전용 스타일 */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
        }

        /* 모바일 반응형 */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .chat-container {
                height: 95vh;
                border-radius: 15px;
            }
            
            .header {
                padding: 20px;
                border-radius: 15px 15px 0 0;
            }
            
            .header h1 {
                font-size: 24px;
            }

            .n8n-status {
                font-size: 11px;
                padding: 6px 12px;
            }

            .api-settings-btn {
                font-size: 11px;
                padding: 6px 12px;
            }
            
            .messages {
                padding: 20px;
            }
            
            .message-content {
                max-width: 85%;
                padding: 15px 20px;
                font-size: 14px;
            }
            
            .input-area {
                padding: 20px;
                gap: 12px;
            }
            
            .input-area textarea {
                padding: 12px 20px;
                font-size: 16px;
            }
            
            .send-button {
                width: 50px;
                height: 50px;
                font-size: 18px;
            }

            .api-content {
                min-width: 90%;
                padding: 30px 20px;
            }

            .comment-content,
            .admin-content {
                min-width: 90%;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="chat-container" id="chatContainer">
        <div class="header">
            <div class="n8n-status">
                <div class="status-light"></div>
                <span id="headerN8nText">n8n 엔진 On</span>
            </div>
            <button class="api-settings-btn" onclick="openApiSettings()">⚙️ API 설정</button>
            <h1>💰 Tax Agent</h1>
            <p>양도소득세 관련 궁금한 점을 물어보세요</p>
        </div>

        <div class="messages" id="messages">
            <div class="welcome-message">
                <h2>안녕하세요! 👋</h2>
                <p>Tax Agent 양도소득세 전문 상담사입니다.<br>
                궁금한 점이 있으시면 언제든 질문해주세요.</p>
            </div>
        </div>

        <div class="input-area">
            <textarea 
                id="messageInput" 
                placeholder="양도세 관련 질문을 입력하세요..."
                rows="1"
            ></textarea>
            <button class="send-button" id="sendButton" onclick="sendMessage()">
                ➤
            </button>
            <button class="stop-button" id="stopButton" onclick="stopResponse()" style="display: none;">
                ⏹️
            </button>
            <button class="restart-button" id="restartButton" onclick="restartResponse()" style="display: none;">
                🔄
            </button>
        </div>
    </div>

    <!-- API 설정 모달 -->
    <div class="api-modal" id="apiModal">
        <div class="api-content">
            <h2>🔧 API 설정</h2>
            
            <!-- 로그인 섹션 -->
            <div id="loginSection">
                <div class="api-form">
                    <input type="text" class="login-input" id="loginId" placeholder="아이디" value="">
                    <input type="password" class="login-input" id="loginPw" placeholder="비밀번호" value="">
                    <button class="login-button" onclick="handleApiLogin()">로그인</button>
                    <div class="error-message" id="loginError"></div>
                </div>
                <button class="api-button" onclick="closeApiSettings()" style="background: #6c757d; margin-top: 15px;">Tax Agent로 돌아가기</button>
            </div>

            <!-- API 설정 섹션 -->
            <div id="apiSettingsSection" style="display: none;">
                <!-- API 입력 -->
                <div class="api-section">
                    <h3>🔧 API 입력</h3>
                    <input type="password" class="api-input" id="apiKey" placeholder="API Key를 입력하세요">
                </div>

                <button class="api-button" onclick="saveApiKeys()">API 키 저장</button>
                <button class="api-button" onclick="closeApiSettings()" style="background: #6c757d; margin-top: 10px;">닫기</button>
                <div class="success-message" id="apiSuccess"></div>
                <div class="error-message" id="apiError"></div>
            </div>
        </div>
    </div>

    <!-- 코멘트 모달 -->
    <div class="comment-modal" id="commentModal">
        <div class="comment-content">
            <h3 id="commentTitle">피드백 코멘트</h3>
            <textarea 
                class="comment-textarea" 
                id="commentText" 
                placeholder="코멘트를 입력해주세요..."
            ></textarea>
            <div class="comment-buttons">
                <button class="comment-btn comment-save" onclick="saveComment()">저장</button>
                <button class="comment-btn comment-cancel" onclick="closeCommentModal()">취소</button>
            </div>
        </div>
    </div>

    <!-- 관리자 모드 모달 -->
    <div class="admin-modal" id="adminModal">
        <div class="admin-content">
            <h3>👨‍💼 관리자 모드</h3>
            
            <!-- AI 모델 선택 섹션 -->
            <div class="n8n-control-section">
                <div class="n8n-status-display">
                    <span style="color: #667eea; font-weight: bold;">🤖 AI 모델 선택</span>
                </div>
                <div class="n8n-control-buttons">
                    <button class="n8n-control-btn n8n-off" onclick="selectModel('sonar')" id="model-sonar-btn">sonar</button>
                    <button class="n8n-control-btn n8n-off" onclick="selectModel('sonar-pro')" id="model-sonar-pro-btn">sonar-pro</button>
                    <button class="n8n-control-btn n8n-off" onclick="selectModel('sonar-reasoning')" id="model-sonar-reasoning-btn">sonar-reasoning</button>
                </div>
                <div class="n8n-control-buttons" style="margin-top: 10px;">
                    <button class="n8n-control-btn n8n-on" onclick="selectModel('sonar-reasoning-pro')" id="model-sonar-reasoning-pro-btn">sonar-reasoning-pro</button>
                    <button class="n8n-control-btn n8n-off" onclick="selectModel('sonar-deep-research')" id="model-sonar-deep-research-btn">sonar-deep-research</button>
                </div>
                <div style="text-align: center; margin-top: 10px; font-size: 12px; color: #666;">
                    현재 선택된 모델: <span id="currentModelDisplay" style="font-weight: bold; color: #667eea;">sonar-reasoning-pro</span>
                </div>
                <div style="text-align: center; margin-top: 5px; font-size: 11px; color: #888;">
                    💡 모든 모델은 웹 검색 기능을 포함합니다
                </div>
            </div>
            
            <!-- n8n 엔진 제어 섹션 -->
            <div class="n8n-control-section">
                <div class="n8n-status-display">
                    <div class="status-light" id="adminStatusLight"></div>
                    <span id="n8nStatusText">n8n 엔진 On</span>
                </div>
                <div class="n8n-control-buttons">
                    <button class="n8n-control-btn n8n-on" onclick="toggleN8nEngine('on')">n8n 엔진 On</button>
                    <button class="n8n-control-btn n8n-off" onclick="toggleN8nEngine('off')">n8n 엔진 Off</button>
                </div>
            </div>
            

            
            <button class="comment-btn comment-cancel" onclick="closeAdminModal()" style="margin-top: 20px;">닫기</button>
        </div>
    </div>

    <!-- 데이터 모드 모달 -->
    <div class="admin-modal" id="dataModal">
        <div class="admin-content">
            <h3>📊 데이터 모드</h3>
            
            <!-- 피드백 관리 섹션 -->
            <div class="feedback-section">
                <h4>📊 피드백 관리</h4>
                <div id="dataFeedbackList" class="feedback-list">
                    <!-- 피드백 목록이 여기에 표시됩니다 -->
                </div>
                <button class="download-btn" onclick="downloadFeedback()">📥 피드백 데이터 다운로드</button>
            </div>
            
            <button class="comment-btn comment-cancel" onclick="closeDataModal()" style="margin-top: 20px;">닫기</button>
        </div>
    </div>

    <script>
        // 전역 변수
        let isLoading = false;
        let apiKey = '';
        let currentFeedbackData = null;
        let feedbackHistory = [];

        // 브라우저 확인 (크롬만 지원)
        function checkBrowser() {
            const isChrome = /Chrome/.test(navigator.userAgent) && /Google Inc/.test(navigator.vendor);
            if (!isChrome) {
                alert('이 챗봇은 Google Chrome 브라우저에서만 사용할 수 있습니다.\n\nChrome 브라우저로 접속해주세요.');
                document.body.innerHTML = `
                    <div style="display: flex; justify-content: center; align-items: center; height: 100vh; background: #f5f5f5; font-family: 'Segoe UI', sans-serif;">
                        <div style="text-align: center; padding: 40px; background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.1);">
                            <h1 style="color: #333; margin-bottom: 20px;">🚫 지원되지 않는 브라우저</h1>
                            <p style="color: #666; font-size: 18px; margin-bottom: 30px;">이 챗봇은 Google Chrome 브라우저에서만 사용할 수 있습니다.</p>
                            <a href="https://www.google.com/chrome/" target="_blank" 
                               style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-decoration: none; padding: 15px 30px; border-radius: 25px; font-weight: bold;">
                                Chrome 다운로드
                            </a>
                        </div>
                    </div>
                `;
                return false;
            }
            return true;
        }

        // 초기화
        document.addEventListener('DOMContentLoaded', function() {
            if (!checkBrowser()) return;
            
            loadApiKeys();
            loadFeedbackHistory();
            loadSelectedModel();
            setupEventListeners();
            
            // 기본 모델 설정 및 UI 업데이트
            updateModelSelectionDisplay();
            
            // n8n 엔진 상태 복원
            const savedStatus = localStorage.getItem('n8n_engine_status') || 'on';
            if (savedStatus === 'off') {
                const headerStatusLight = document.querySelector('.n8n-status .status-light');
                const headerN8nText = document.getElementById('headerN8nText');
                if (headerStatusLight) {
                    headerStatusLight.style.background = '#dc3545';
                    headerStatusLight.style.animation = 'blinkRed 1.5s infinite';
                }
                if (headerN8nText) {
                    headerN8nText.textContent = 'n8n 엔진 Off';
                    headerN8nText.style.color = '#dc3545';
                }
            }
        });

        // API 설정 모달 열기
        function openApiSettings() {
            document.getElementById('apiModal').style.display = 'flex';
            document.getElementById('loginSection').style.display = 'block';
            document.getElementById('apiSettingsSection').style.display = 'none';
            document.getElementById('loginError').textContent = '';
        }

        // API 설정 모달 닫기
        function closeApiSettings() {
            document.getElementById('apiModal').style.display = 'none';
        }

        // API 로그인 처리
        function handleApiLogin() {
            const loginId = document.getElementById('loginId').value;
            const loginPw = document.getElementById('loginPw').value;
            const errorEl = document.getElementById('loginError');
            
            if (loginId === '004050' && loginPw === '004050') {
                document.getElementById('loginSection').style.display = 'none';
                document.getElementById('apiSettingsSection').style.display = 'block';
                errorEl.textContent = '';
                loadApiKeysToInputs();
            } else {
                errorEl.textContent = '아이디 또는 비밀번호가 잘못되었습니다.';
                document.getElementById('loginPw').value = '';
            }
        }

        // 이벤트 리스너 설정
        function setupEventListeners() {
            const input = document.getElementById('messageInput');
            
            // 엔터키로 메시지 전송
            input.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            // 텍스트 영역 자동 크기 조절
            input.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 120) + 'px';
            });

            // 로그인 엔터키 이벤트
            document.getElementById('loginId').addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    document.getElementById('loginPw').focus();
                }
            });
            
            document.getElementById('loginPw').addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    handleApiLogin();
                }
            });

            // 동적으로 생성되는 버튼들의 이벤트 리스너를 위한 이벤트 위임
            document.addEventListener('click', function(e) {
                // 복사 버튼 클릭
                if (e.target.classList.contains('copy-btn')) {
                    const messageId = e.target.dataset.messageId;
                    copyMessage(messageId);
                }
                
                // 피드백 버튼 클릭
                if (e.target.classList.contains('feedback-btn')) {
                    const messageId = e.target.dataset.messageId;
                    const type = e.target.dataset.type;
                    const question = e.target.dataset.question;
                    const answer = e.target.dataset.answer;
                    openFeedbackModal(messageId, type, question, answer);
                }
            });
        }

        // API 키 저장
        function saveApiKeys() {
            apiKey = document.getElementById('apiKey').value;
            
            // 로컬 스토리지에 저장 (암호화된 형태로)
            const encodedKey = btoa(apiKey);
            localStorage.setItem('tax_chatbot_api_key', encodedKey);
            
            document.getElementById('apiSuccess').textContent = 'API 키가 성공적으로 저장되었습니다.';
            setTimeout(() => {
                document.getElementById('apiSuccess').textContent = '';
            }, 3000);
        }

        // API 키 로드
        function loadApiKeys() {
            try {
                const encodedKey = localStorage.getItem('tax_chatbot_api_key');
                if (encodedKey) {
                    apiKey = atob(encodedKey);
                }
            } catch (error) {
                console.error('API 키 로드 실패:', error);
            }
        }

        // API 키를 입력 필드에 로드
        function loadApiKeysToInputs() {
            document.getElementById('apiKey').value = apiKey || '';
        }

        // 선택된 모델 로드
        function loadSelectedModel() {
            const savedModel = localStorage.getItem('tax_chatbot_selected_model');
            
            // 이전 모델명 정리 (sonar-medium-online 등 잘못된 모델명 제거)
            if (savedModel && (savedModel === 'sonar-medium-online' || !savedModel.includes('sonar'))) {
                localStorage.removeItem('tax_chatbot_selected_model');
                window.selectedModel = 'sonar-reasoning-pro'; // 기본값으로 재설정
            } else if (savedModel) {
                window.selectedModel = savedModel;
            } else {
                window.selectedModel = 'sonar-reasoning-pro'; // 기본값
            }
        }

        // 메시지 전송
        function sendMessage() {
            const input = document.getElementById('messageInput');
            
            // 디버깅 코드 추가
            console.log('=== 디버깅 시작 ===');
            console.log('원본 입력값:', JSON.stringify(input.value));
            console.log('trim 후 값:', JSON.stringify(input.value.trim()));
            console.log('줄바꿈 개수:', (input.value.match(/\n/g) || []).length);
            console.log('trim 후 줄바꿈 개수:', (input.value.trim().match(/\n/g) || []).length);
            console.log('=== 디버깅 끝 ===');
            
            // 안전한 메시지 처리 (줄바꿈 보존)
            const message = input.value
                .replace(/\r\n/g, '\n')  // Windows 줄바꿈 통일
                .replace(/\r/g, '\n')    // Mac 줄바꿈 통일
                .trim();  // 앞뒤 공백만 제거
            
            console.log('처리 후 메시지:', JSON.stringify(message));
            
            if (!message || isLoading) return;
            
            // 관리자 모드 체크 (원본 값으로 정확한 매칭)
            if (input.value.trim().toLowerCase() === '관리자 모드') {
                openAdminModal();
                input.value = '';
                input.style.height = 'auto';
                return;
            }
            
            // 데이터 모드 체크 (원본 값으로 정확한 매칭)
            if (input.value.trim().toLowerCase() === '데이터 모드') {
                openDataModal();
                input.value = '';
                input.style.height = 'auto';
                return;
            }
            
            if (!apiKey) {
                alert('API 키가 설정되지 않았습니다. API 설정에서 키를 입력해주세요.');
                return;
            }
            
            addUserMessage(message);
            input.value = '';
            input.style.height = 'auto';
            
            processMessage(message);
        }

        // 사용자 의도 감지 및 필터링
        function detectUserIntent(message) {
            const lowerMessage = message.toLowerCase();
            
            // 추궁 관련 키워드 (더 정교한 패턴 매칭)
            const complaintPatterns = [
                // 직접적인 추궁
                /왜\s+(처음부터|이제야)\s+(말|알려)\s*(안\s*)?(해줬|했)어/,
                /왜\s+(틀린\s*)?(답|정보|설명)\s*을\s*(말해|알려|제공)줬어/,
                /왜\s+(거짓말|속임|숨김|틀림|오류|실수).*?했어/,
                /왜\s+이제서야\s+(말해|알려|답변)/,
                /왜\s+(나중에|뒤에|마지막에)\s+(말해|알려|답변)/,
                // 간접적인 불만
                /(답변|설명|정보).*?(잘못|틀렸|오류|실수).*?(했어|해줬어)/,
                /(처음|시작할\s*때).*?(말해|알려|답변).*?(안\s*)?(했어|해줬어)/
            ];
            
            // 양도소득세 관련 키워드 (확장)
            const taxKeywords = [
                // 직접적인 세금 관련
                '양도세', '양도소득세', '양도', '상속세', '증여세', '부동산양도세',
                '세금', '과세', '공제', '세율', '과세표준', '납세', '세무신고',
                '양도세율', '증여세율', '상속세율', '양도소득세율',
                
                // 자산 및 재산 관련
                '자산', '재산', '토지', '건물', '부동산', '주식', '채권', '예금', '적금',
                '투자', '자본', '유산', '재산권', '소유권', '지분', '주권',
                
                // 상속 및 증여 관련
                '상속', '증여', '기부', '유증', '법정상속', '유언', '유류분',
                '상속인', '피상속인', '증여자', '수증자', '증여세면제',
                '상속세공제', '증여세공제', '상속세감면', '증여세감면',
                
                // 세무 관련
                '세무', '세무사', '세무법인', '세무신고', '세무조정', '세무상담',
                '국세청', '세무서', '세무행정', '세무처리', '세무대리',
                
                // 추가 세금 관련
                '비과세', '감면', '과세이연', '세무조정', '세무신고',
                '양도소득세신고', '상속세신고', '증여세신고',
                '양도소득세계산', '상속세계산', '증여세계산',
                
                // 신승세무법인 관련
                '신승세무법인', '신승', 'sostax', '소스택스'
            ];
            
            // 추궁 감지
            const isComplaint = complaintPatterns.some(pattern => pattern.test(lowerMessage));
            
            // 양도소득세 관련성 감지
            const isTaxRelated = taxKeywords.some(keyword => lowerMessage.includes(keyword));
            
            // 문맥 기반 관련성 감지
            const contextTaxRelated = 
                lowerMessage.includes('세무사') || 
                lowerMessage.includes('세무법인') || 
                lowerMessage.includes('신승세무법인') ||
                lowerMessage.includes('국세청') ||
                lowerMessage.includes('세금') && (lowerMessage.includes('문의') || lowerMessage.includes('질문') || lowerMessage.includes('상담'));
            
            return {
                isComplaint: isComplaint,
                isTaxRelated: isTaxRelated || contextTaxRelated,
                shouldUseApologyResponse: isComplaint && !(isTaxRelated || contextTaxRelated)
            };
        }

        // 메시지 처리
        async function processMessage(message) {
            if (isLoading) return;
            
            // 사용자 의도 감지
            const userIntent = detectUserIntent(message);
            
            // 추궁이면서 양도소득세와 관련 없는 경우 사과 메시지 제공
            if (userIntent.shouldUseApologyResponse) {
                addBotMessage('Tax Agent는 n8n엔진을 기반으로 답변을 제공하는 Agent 입니다. Agent는 다소 실수가 있을 수 있습니다. 다시 질문해 주시면 성실하게 답변하겠습니다.', message);
                return;
            }
            
            // 1단계: 데이터셋에서 유사한 답변 검색
            const datasetMatch = findBestMatch(message, 0.3);
            
            if (datasetMatch) {
                console.log('데이터셋 매칭 성공:', datasetMatch);
                // API 답변과 동일한 대기 시간 적용
                setLoading(true);
                
                // 15초 대기 후 답변 표시
                setTimeout(() => {
                    setLoading(false);
                    displayDatasetResult(datasetMatch, message);
                }, 15000);
                
                return; // LLM API 호출하지 않음
            }
            
            // 2단계: 데이터셋에 매칭되지 않은 경우 LLM API 호출
            console.log('데이터셋 매칭 실패, LLM API 호출');
            setLoading(true);
            
            try {
                const response = await callPerplexityAPI(message);
                addBotMessage(response, message);
            } catch (error) {
                console.error('API 호출 오류:', error);
                addBotMessage('죄송합니다. 일시적인 오류가 발생했습니다. 잠시 후 다시 시도해주세요.', message);
            } finally {
                setLoading(false);
            }
        }

        // 답변 중단
        function stopResponse() {
            if (isLoading) {
                isLoading = false;
                setLoading(false);
                
                // 중단된 답변 메시지 추가
                addBotMessage('답변이 중단되었습니다. "다시 답변" 버튼을 클릭하여 계속할 수 있습니다.', '');
                
                // 버튼 상태 변경
                document.getElementById('stopButton').style.display = 'none';
                document.getElementById('restartButton').style.display = 'flex';
            }
        }

        // 답변 재시작
        function restartResponse() {
            const lastUserMessage = getLastUserMessage();
            if (lastUserMessage) {
                // 재시작 버튼 숨기고 중단 버튼 표시
                document.getElementById('restartButton').style.display = 'none';
                document.getElementById('stopButton').style.display = 'flex';
                
                // 마지막 사용자 질문으로 다시 답변
                processMessage(lastUserMessage);
            }
        }

        // 마지막 사용자 메시지 가져오기
        function getLastUserMessage() {
            const userMessages = document.querySelectorAll('.message.user .message-content');
            if (userMessages.length > 0) {
                return userMessages[userMessages.length - 1].textContent;
            }
            return null;
        }

        // Perplexity API 호출
        async function callPerplexityAPI(message) {
            // 데이터셋 내용을 시스템 프롬프트에 포함
            const datasetContent = taxGoldDataset.map(item =>
                `질문: ${item.question}\n답변: ${item.answer}`
            ).join('\n\n');

            const systemPrompt = `당신은 한국의 양도소득세 전문가입니다. 다음 가이드라인을 따라 답변해주세요:

            **최우선 참고 데이터셋 (Phoenix AI 양도세 전문 지식):**
            ${datasetContent}

            위 데이터셋의 내용을 최우선으로 참고하여 답변하세요. 데이터셋에 관련된 내용이 있으면 반드시 우선적으로 활용하세요.

1. 양도소득세 관련 질문에 정확하고 상세한 답변을 제공하세요.
2. 관련 법률이나 세율, 공제 혜택 등을 명확히 설명하세요.
3. 복잡한 내용은 단계별로 나누어 설명하세요.
4. 실제 사례나 예시를 들어 이해하기 쉽게 설명하세요.
5. 세법 변경사항이 있을 경우 최신 정보를 제공하세요.
6. 답변은 한국어로 친근하고 전문적인 톤으로 작성하세요.
7. 제작자나 누가 만들었는지에 대한 질문이 있으면 반드시 "나는 Phoenix AI, Inc에서 제작된 양도세 전문 챗봇으로 [Tax Agent]로 이름 붙여졌습니다"라고만 답변하고, 다른 내용은 추가하지 마세요.

8. 추궁이나 비난성 질문 처리:
   - 사용자가 "왜 처음부터 말 안해줬어?", "왜 틀린답을 말해줬어?" 등의 추궁성 질문을 했을 때
   - 양도소득세와 관련 없는 추궁이면: "Tax Agent는 n8n엔진을 기반으로 답변을 제공하는 Agent 입니다. Agent는 다소 실수가 있을 수 있습니다. 다시 질문해 주시면 성실하게 답변하겠습니다."라고 답변
   - 절대 사용자에게 책임을 전가하지 마세요
   - 양도소득세 관련 추궁이면 정상적으로 답변하되, 친근하고 이해하기 쉬운 톤으로 답변

9. 법령 정보 검색 및 답변 우선순위:
   답변은 다음 신뢰할 수 있는 공식 법령 사이트 기준 내용을 최우선으로 하시오:
   
   **시간 우선순위**: 최근 1년 이내의 최신 정보를 우선적으로 검색하고 활용하시오.
   **구체적 지시**: 2023년 이후의 세법 변경사항, 최신 공지사항, 최근 판례를 우선적으로 참고하시오.
   **중요**: 3년 이상 된 정보는 신뢰할 수 없으므로, 반드시 최신 정보를 우선적으로 확인하고 답변하시오.
   
   **1순위**: 국가법령정보센터 (https://www.law.go.kr) - 최신 법령 개정사항 우선, 2023년 이후 변경사항 중점 검색
   **2순위**: 국세청 양도소득세 법령·상담 (https://www.nts.go.kr/tax/yangdo_2.html) - 최신 세법 해설 우선, 2024년 최신 공지사항 중점 검색
   **3순위**: 찾기쉬운 생활법령정보 (https://lnp.nanet.go.kr) - 최신 법령 해설 우선, 2023년 이후 업데이트된 내용 중점 검색
   **4순위**: 대법원 판례정보 - 최근 1년 이내 판례 우선, 2023년 이후 선고된 판례 중점 검색
   **5순위**: 법제처 (https://www.moleg.go.kr) - 최신 법령 제정/개정 정보 우선, 2023년 이후 시행된 법령 중점 검색
   
   위 사이트의 정보가 없는 경우에만 일반적인 AI 지식을 활용하시오.

                10. 모든 답변에는 반드시 다음 1개 항목을 포함하세요 (절대 생략하지 마세요):

                   **결론**
                   (질문에 대한 명확한 결론이나 요약 - 반드시 포함)
                   
                   중요: "결론"이라는 제목 자체를 절대 생략하지 마세요. 답변 마지막에 반드시 "**결론**" 제목과 함께 결론 내용을 작성하세요.
                   
                   절대 금지: "5." 다음에 바로 내용을 쓰지 마세요. 반드시 "**5. 결론**" 제목을 먼저 쓰고 그 다음에 내용을 작성하세요.

                11. 필요에 따라 다음 항목들을 선택적으로 포함할 수 있습니다 (해당 항목에 적절한 내용이 있을 때만 포함하고, 내용이 없다면 절대 만들어내거나 추정하지 마세요):

                    **실무상 주의사항 및 절세 전략**
                    (실무에서 주의해야 할 점이나 절세를 위한 전략이 있는 경우에만 포함)

                    **관련 법령 및 근거**
                    (관련 법령이나 근거가 있는 경우에만 포함)

                12. 웹 검색을 통해 참고한 사이트들의 링크를 다음 형식으로 반드시 포함하세요:

                **참고할 만한 링크**
                🔗 [사이트명] - 🔗 참고자료 클릭
                🔗 [사이트명] - 🔗 참고자료 클릭
                🔗 [사이트명] - 🔗 참고자료 클릭
                
                위 형식에서 [사이트명]은 실제 사이트 이름으로, URL은 실제 웹 주소로 작성하되 표시는 "🔗 참고자료 클릭"으로 하세요.
                
                중요: 참고할 만한 링크에는 공공기관 사이트만 표시하세요:
                - 국세청, 국가법령정보센터, 찾기쉬운 생활법령정보, 대법원 종합법률정보, 헌법재판소, 행정안전부, 기획재정부
                - 민간 사이트는 검색에 활용하되 참고자료에는 표시하지 마세요

                13. 그 다음에 반드시 다음 문구를 포함하세요: "\n\n\n\n\n**Tax Agent 안내 말씀**\n\n'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다.\n\n🏢 **"국세청 33년 경력"의 믿고 맡길 수 있는 신승세무법인**\n🔗 http://www.sostax.co.kr/"

                                  14. 답변 내용에서 웹 검색으로 확인한 정보를 언급할 때는 반드시 참고 번호를 표시하세요:
                   - 첫 번째 참고 사이트: [1]
                   - 두 번째 참고 사이트: [2]
                   - 세 번째 참고 사이트: [3]
                   
                   예시: "국세청에 따르면 [1], 2024년 양도소득세 세율은...", "대법원 판례 [2]에 따르면..."
                   
                   참고: 모든 사이트(공공기관 및 민간사이트)를 검색하여 답변을 생성하되, 참고할 만한 링크에는 공공기관만 표시합니다.

                15. 답변 스타일 및 구조:
                   - 모든 제목은 굵은 글씨(**제목**)로 작성하세요
                   - 제목 앞에 번호를 붙여서 넘버링하세요 (예: **1. 제목**, **2. 제목**)
                   - 모든 제목 항목(관련 법령 및 근거, 결론, 참고 자료 등)도 넘버링하세요
                   - 제목 항목들 사이에는 3줄 간격을 두어 명확히 구분하세요
                   - 제목과 본문 사이의 간격은 한 줄로 유지하세요 (제목 바로 아래 한 줄 후 내용 시작)
                   - 표가 필요한 경우 HTML 테이블 형식으로 작성하세요
                   - 답변 구조는 다음과 같이 작성하세요:
                     **1. [첫 번째 제목]**
                     (내용)
                     
                     
                     **2. [두 번째 제목]**
                     (내용)
                     
                     
                     **3. 결론**
                     (결론 내용 - 반드시 포함, "결론" 제목 필수)
                     
                     
                     **4. 참고할 만한 링크**
                     🔗 [사이트명] - 🔗 참고자료 클릭
                     
                16. 답변 구조 및 제목 (중요):
                   - 답변은 반드시 다음 두 섹션으로 구성하세요:
                     
                     **[추론 과정]**
                     (검색 과정, 분석 과정, 추론 과정 등을 상세히 설명)
                     
                     
                     **[Tax Agent 답변]**
                     **1. [첫 번째 제목]**
                     (실제 답변 내용)
                     
                     
                     **2. [두 번째 제목]**
                     (답변 내용 계속)
                     
                     
                     **3. 결론**
                     (결론 내용 - 반드시 포함)
                     
                     
                     **4. 참고할 만한 링크**
                     🔗 [사이트명] - 🔗 참고자료 클릭
                     
                     
                     
                     **Tax Agent 안내 말씀**
                     (인사말)

                16. 답변 스타일 가이드:
                   - 실제 사례나 구체적인 예시를 들어 이해하기 쉽게 설명하세요
                   - 복잡한 내용은 단계별로 나누어 설명하세요
                   - 관련 법령이나 세율, 공제 혜택 등을 명확히 설명하세요
                   - 세법 변경사항이 있을 경우 최신 정보를 제공하세요
                   - 답변은 한국어로 친근하고 전문적인 톤으로 작성하세요
                   - 결론 섹션을 생략하지 마세요 (모든 답변에 반드시 포함)
                   - "결론"이라는 제목 자체를 생략하지 마세요 (결론 내용만 쓰고 제목을 빼지 마세요)
                   
                   **추론 과정 차단 (중요):**
- 검색 과정이나 분석 과정을 설명하지 마세요
- "사용자가...묻고 있습니다", "질문에 대해...답변", "검색 결과를 분석해보면" 등의 표현을 절대 사용하지 마세요
- 답변은 바로 본론부터 시작하세요
- 추론 과정이나 생각 과정을 보여주지 마세요
                   - "사용자가...묻고 있습니다", "질문에 대해...답변" 등의 표현을 사용하지 마세요
                   - 검색 결과를 나열하지 말고, 정리된 답변만 제공하세요
                   - 전문적이면서도 친근한 톤을 유지하세요`;

            const response = await fetch('https://api.perplexity.ai/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    model: window.selectedModel || 'sonar-reasoning-pro',
                    messages: [
                        { role: 'system', content: systemPrompt },
                        { role: 'user', content: message }
                    ],
                    max_tokens: 2000,
                    temperature: 0.7
                })
            });

            if (!response.ok) {
                throw new Error(`API 오류: ${response.status}`);
            }

            const data = await response.json();
            let content = data.choices[0].message.content;
            
            // 현재 모델 확인
            const currentModel = window.selectedModel || 'sonar-reasoning-pro';
            
            // reasoning/deep-research 모델 특화 정리 (추론 과정 차단)
            if (currentModel.includes('reasoning') || currentModel.includes('deep-research')) {
                content = cleanReasoningResponse(content);
            } else {
                // sonar, sonar-pro 모델은 기존 정리 방식 유지
                content = cleanBasicResponse(content);
            }
            
            return content;
        }

        // Reasoning 모델 응답 정리 함수 ([Tax Agent 답변] 섹션만 추출)
        function cleanReasoningResponse(content) {
            if (!content) return content;
            
            let finalAnswer = content;
            
            // 1단계: [Tax Agent 답변] 섹션 추출
            const taxAgentAnswerPattern = /\[\s*Tax\s*Agent\s*답변\s*\]([\s\S]*?)(?=\[\s*추론\s*과정\s*\]|$)/i;
            const match = content.match(taxAgentAnswerPattern);
            
            if (match && match[1] && match[1].trim().length > 30) {
                finalAnswer = match[1].trim();
            } else {
                // [Tax Agent 답변] 섹션이 없는 경우, **로 시작하는 첫 번째 제목부터 추출
                const titlePattern = /(\*\*\d+\..*)/s;
                const titleMatch = content.match(titlePattern);
                if (titleMatch && titleMatch[1]) {
                    finalAnswer = titleMatch[1].trim();
                } else {
                    finalAnswer = content; // 원본 사용
                }
            }
            
            // 2단계: 구조 정리
            finalAnswer = finalAnswer
                .replace(/^\s*\n+/g, '') // 시작 부분 공백 제거
                .replace(/\n{3,}/g, '\n\n') // 과도한 줄바꿈 정리
                .trim();
            
            // 3단계: 답변 보호 (너무 짧아지면 원본 사용)
            if (!finalAnswer || finalAnswer.length < 30) {
                finalAnswer = content; // 원본 사용
            }
            
            return finalAnswer;
        }

        // 기본 모델 응답 정리 함수 ([Tax Agent 답변] 섹션 추출)
        function cleanBasicResponse(content) {
            if (!content) return content;
            
            // [Tax Agent 답변] 섹션이 있는 경우 해당 섹션만 추출
            const taxAgentAnswerPattern = /\[\s*Tax\s*Agent\s*답변\s*\]([\s\S]*?)(?=\[\s*추론\s*과정\s*\]|$)/i;
            const match = content.match(taxAgentAnswerPattern);
            
            if (match && match[1] && match[1].trim().length > 30) {
                return match[1].trim()
                    .replace(/^\s*\n+/g, '')
                    .replace(/\n{3,}/g, '\n\n')
                    .trim();
            }
            
            // 섹션이 없는 경우 기본 정리만 수행
            return content
                .replace(/검색\s*결과를?\s*(?:확인|분석).*?(?=\*\*)/gs, '')
                .replace(/\n{3,}/g, '\n\n')
                .trim();
        }

        // 사용자 메시지 추가
        function addUserMessage(message) {
            const messagesEl = document.getElementById('messages');
            const messageEl = document.createElement('div');
            messageEl.className = 'message user';
            messageEl.innerHTML = `
                <div class="message-avatar">👤</div>
                <div class="message-content">${escapeHtml(message).replace(/\n/g, '<br>')}</div>
            `;
            messagesEl.appendChild(messageEl);
            scrollToBottom();
        }

        // 봇 메시지 추가 (수정된 버전 - 피드백 데이터 안전하게 처리)
        function addBotMessage(message, userQuestion = '') {
            const messagesEl = document.getElementById('messages');
            const messageEl = document.createElement('div');
            messageEl.className = 'message bot';
            
            // 메시지 ID 생성
            const messageId = 'msg_' + Date.now();
            messageEl.id = messageId;
            
            // 피드백용 데이터 정리 (HTML 태그 제거, 길이 제한)
            const cleanAnswer = cleanTextForFeedback(message);
            const cleanQuestion = cleanTextForFeedback(userQuestion);
            
            messageEl.innerHTML = `
                <div class="message-avatar">💰</div>
                <div class="message-content">
                    ${formatMessage(message)}
                    <div class="message-actions">
                        <button class="action-btn copy-btn" data-message-id="${messageId}" title="답변 복사">
                            📋 복사
                        </button>
                        <button class="action-btn feedback-btn" data-message-id="${messageId}" data-type="positive" data-question="${cleanQuestion}" data-answer="${cleanAnswer}" title="좋은 답변">
                            👍 좋은답변
                        </button>
                        <button class="action-btn feedback-btn negative" data-message-id="${messageId}" data-type="negative" data-question="${cleanQuestion}" data-answer="${cleanAnswer}" title="나쁜 답변">
                            👎 나쁜답변
                        </button>
                    </div>
                </div>
            `;
            messagesEl.appendChild(messageEl);
            scrollToBottom();
        }

        // 피드백용 텍스트 정리 함수 (새로 추가)
        function cleanTextForFeedback(text) {
            if (!text) return '';
            
            return text
                .replace(/<[^>]*>/g, '') // HTML 태그 제거
                .replace(/\s+/g, ' ') // 연속된 공백을 하나로
                .replace(/\n+/g, ' ') // 줄바꿈을 공백으로
                .substring(0, 200) // 200자로 제한
                .trim();
        }

        // 메시지 복사
        function copyMessage(messageId) {
            const messageEl = document.getElementById(messageId);
            const contentEl = messageEl.querySelector('.message-content');
            const textContent = contentEl.textContent.replace(/복사좋은답변나쁜답변/g, '').trim();
            
            navigator.clipboard.writeText(textContent).then(() => {
                // 복사 성공 표시
                const copyBtn = messageEl.querySelector('.copy-btn');
                const originalText = copyBtn.textContent;
                copyBtn.textContent = '✅ 복사됨';
                copyBtn.style.color = '#28a745';
                
                setTimeout(() => {
                    copyBtn.textContent = originalText;
                    copyBtn.style.color = '#667eea';
                }, 2000);
            }).catch(err => {
                console.error('복사 실패:', err);
                alert('복사에 실패했습니다.');
            });
        }

        // 피드백 모달 열기
        function openFeedbackModal(messageId, type, question, answer) {
            console.log('피드백 모달 열기:', { messageId, type, question, answer });
            
            currentFeedbackData = {
                messageId: messageId,
                type: type,
                question: question,
                answer: answer,
                timestamp: new Date().toISOString()
            };
            
            const title = type === 'positive' ? '좋은 답변 피드백' : '나쁜 답변 피드백';
            document.getElementById('commentTitle').textContent = title;
            document.getElementById('commentText').value = '';
            document.getElementById('commentModal').style.display = 'flex';
        }

        // 코멘트 모달 닫기
        function closeCommentModal() {
            document.getElementById('commentModal').style.display = 'none';
            currentFeedbackData = null;
        }

        // 코멘트 저장
        function saveComment() {
            console.log('코멘트 저장 시도:', currentFeedbackData);
            
            if (!currentFeedbackData) {
                console.error('currentFeedbackData가 없습니다.');
                alert('피드백 데이터를 찾을 수 없습니다.');
                return;
            }
            
            const comment = document.getElementById('commentText').value.trim();
            if (!comment) {
                alert('코멘트를 입력해주세요.');
                return;
            }
            
            // 피드백 데이터에 코멘트 추가
            currentFeedbackData.comment = comment;
            console.log('저장할 피드백 데이터:', currentFeedbackData);
            
            // 피드백 히스토리에 저장
            feedbackHistory.push(currentFeedbackData);
            saveFeedbackHistory();
            
            // 모달 닫기
            closeCommentModal();
            
            // 성공 메시지 표시
            alert('피드백이 저장되었습니다.');
        }

        // 관리자 모드 모달 열기
        function openAdminModal() {
            // 관리자 로그인 체크
            const adminId = prompt('관리자 아이디를 입력하세요:');
            if (!adminId) return;
            
            const adminPw = prompt('관리자 비밀번호를 입력하세요:');
            if (!adminPw) return;
            
            if (adminId === '4050' && adminPw === '4050') {
                // 모델 상태 확실히 로드
                loadSelectedModel();
                
                updateN8nStatusDisplay();
                updateModelSelectionDisplay();
                document.getElementById('adminModal').style.display = 'flex';
            } else {
                alert('아이디 또는 비밀번호가 잘못되었습니다.');
            }
        }

        // 데이터 모드 모달 열기
        function openDataModal() {
            // 데이터 모드 로그인 체크
            const dataId = prompt('데이터 모드 아이디를 입력하세요:');
            if (!dataId) return;
            
            const dataPw = prompt('데이터 모드 비밀번호를 입력하세요:');
            if (!dataPw) return;
            
            if (dataId === '004050' && dataPw === '004050') {
                displayDataFeedbackList();
                document.getElementById('dataModal').style.display = 'flex';
            } else {
                alert('아이디 또는 비밀번호가 잘못되었습니다.');
            }
        }

        // 관리자 모드 모달 닫기
        function closeAdminModal() {
            document.getElementById('adminModal').style.display = 'none';
        }

        // 데이터 모드 모달 닫기
        function closeDataModal() {
            document.getElementById('dataModal').style.display = 'none';
        }

        // 데이터 모드 피드백 목록 표시
        function displayDataFeedbackList() {
            displayFeedbackList('dataFeedbackList');
        }

        // AI 모델 선택 (사용자 선택 시)
        function selectModel(modelName) {
            // 전역 변수에 선택된 모델 저장
            window.selectedModel = modelName;
            
            // 로컬 스토리지에 저장
            localStorage.setItem('tax_chatbot_selected_model', modelName);
            
            // UI 업데이트 (알림 포함)
            updateModelSelectionUI(modelName, true);
            
            // 성공 메시지 표시
            alert(`AI 모델이 ${modelName}로 변경되었습니다.`);
        }

        // AI 모델 선택 UI 업데이트 (알림 옵션 포함)
        function updateModelSelectionUI(modelName, showAlert = false) {
            // 모든 모델 버튼 초기화 (비활성 스타일)
            const allModelBtns = [
                'model-sonar-btn',
                'model-sonar-pro-btn',
                'model-sonar-reasoning-btn',
                'model-sonar-reasoning-pro-btn',
                'model-sonar-deep-research-btn'
            ];
            
            allModelBtns.forEach(btnId => {
                const btn = document.getElementById(btnId);
                if (btn) {
                    btn.style.background = 'linear-gradient(135deg, #dc3545 0%, #fd7e14 100%)';
                }
            });
            
            // 선택된 모델 버튼 활성화 (녹색 스타일)
            const selectedBtnId = `model-${modelName.replace(/-/g, '-')}-btn`;
            const selectedBtn = document.getElementById(selectedBtnId);
            if (selectedBtn) {
                selectedBtn.style.background = 'linear-gradient(135deg, #28a745 0%, #20c997 100%)';
            }
            
            // 현재 모델 표시 업데이트
            const currentModelDisplay = document.getElementById('currentModelDisplay');
            if (currentModelDisplay) {
                currentModelDisplay.textContent = modelName;
            }
        }

        // n8n 엔진 상태 토글
        function toggleN8nEngine(status) {
            const statusLight = document.getElementById('adminStatusLight');
            const statusText = document.getElementById('n8nStatusText');
            const headerStatusLight = document.querySelector('.n8n-status .status-light');
            const headerN8nText = document.getElementById('headerN8nText');
            
            const isOn = status === 'on';
            const color = isOn ? '#00ff00' : '#dc3545';
            const textColor = isOn ? '#28a745' : '#dc3545';
            const headerTextColor = isOn ? '#ffffff' : '#dc3545';
            const animation = isOn ? 'blink 1.5s infinite' : 'blink 1.5s infinite';
            const statusTextValue = isOn ? 'n8n 엔진 On' : 'n8n 엔진 Off';
            const alertMessage = isOn ? 'n8n 엔진이 활성화되었습니다.' : 'n8n 엔진이 비활성화되었습니다.';
            
            // 관리자 모달 상태 업데이트
            if (statusLight) {
                statusLight.style.background = color;
                statusLight.style.animation = animation;
            }
            if (statusText) {
                statusText.textContent = statusTextValue;
                statusText.style.color = textColor;
            }
            
            // 헤더 상태 업데이트
            if (headerStatusLight) {
                headerStatusLight.style.background = color;
                headerStatusLight.style.animation = animation;
            }
            if (headerN8nText) {
                headerN8nText.textContent = statusTextValue;
                headerN8nText.style.color = headerTextColor;
            }
            
            // 로컬 스토리지에 상태 저장
            localStorage.setItem('n8n_engine_status', status);
            
            alert(alertMessage);
        }

        // n8n 상태 표시 업데이트
        function updateN8nStatusDisplay() {
            const savedStatus = localStorage.getItem('n8n_engine_status') || 'on';
            toggleN8nEngine(savedStatus);
        }

        // 모델 선택 상태 표시 업데이트 (알림 없이)
        function updateModelSelectionDisplay() {
            const currentModel = window.selectedModel || 'sonar-reasoning-pro';
            updateModelSelectionUI(currentModel, false); // 알림 없이 UI만 업데이트
        }

        // 피드백 목록 표시 (공통 함수)
        function displayFeedbackList(elementId = 'feedbackList') {
            const feedbackListEl = document.getElementById(elementId);
            
            if (feedbackHistory.length === 0) {
                feedbackListEl.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">저장된 피드백이 없습니다.</p>';
                return;
            }
            
            let html = '';
            feedbackHistory.forEach((feedback, index) => {
                const date = new Date(feedback.timestamp).toLocaleString('ko-KR');
                const typeClass = feedback.type === 'positive' ? 'positive' : 'negative';
                const typeText = feedback.type === 'positive' ? '좋은답변' : '나쁜답변';
                
                html += `
                    <div class="feedback-item">
                        <div class="feedback-header">
                            <span class="feedback-type ${typeClass}">${typeText}</span>
                            <span class="feedback-date">${date}</span>
                        </div>
                        <div class="feedback-question">질문: ${feedback.question}</div>
                        <div class="feedback-answer">답변: ${feedback.answer.substring(0, 100)}${feedback.answer.length > 100 ? '...' : ''}</div>
                        <div class="feedback-comment">코멘트: ${feedback.comment}</div>
                    </div>
                `;
            });
            
            feedbackListEl.innerHTML = html;
        }

        // 피드백 데이터 다운로드
        function downloadFeedback() {
            if (feedbackHistory.length === 0) {
                alert('다운로드할 피드백이 없습니다.');
                return;
            }
            
            const csvContent = generateFeedbackCSV();
            
            // UTF-8 BOM 추가 (한글 깨짐 방지)
            const BOM = '\uFEFF';
            const csvWithBOM = BOM + csvContent;
            
            // Excel에서 한글이 깨지는 경우를 대비해 여러 형식 제공
            try {
                // 방법 1: UTF-8 BOM이 포함된 CSV
                const blob = new Blob([csvWithBOM], { type: 'text/csv;charset=utf-8' });
                const link = document.createElement('a');
                
                if (link.download !== undefined) {
                    const url = URL.createObjectURL(blob);
                    link.setAttribute('href', url);
                    link.setAttribute('download', `feedback_data_${new Date().toISOString().split('T')[0]}.csv`);
                    link.style.visibility = 'hidden';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                    
                    // 사용자에게 안내
                    setTimeout(() => {
                        alert('피드백 데이터가 다운로드되었습니다.\n\n만약 한글이 깨진다면:\n1. Excel에서 파일을 열 때 "데이터 가져오기" 사용\n2. 또는 메모장으로 열어서 "다른 이름으로 저장" 시 인코딩을 "UTF-8"로 설정');
                    }, 1000);
                }
            } catch (error) {
                console.error('CSV 다운로드 실패:', error);
                alert('다운로드에 실패했습니다. 다시 시도해주세요.');
            }
        }

        // 피드백 CSV 생성
        function generateFeedbackCSV() {
            const headers = ['타임스탬프', '피드백 타입', '코멘트', '질문', '답변'];
            const rows = feedbackHistory.map(feedback => [
                new Date(feedback.timestamp).toLocaleString('ko-KR'),
                feedback.type === 'positive' ? '좋은답변' : '나쁜답변',
                escapeCSVField(feedback.comment || ''),
                escapeCSVField(feedback.question || ''),
                escapeCSVField(feedback.answer || '')
            ]);
            
            return [headers, ...rows].map(row => row.join(',')).join('\r\n');
        }

        // 피드백 히스토리 저장
        function saveFeedbackHistory() {
            try {
                localStorage.setItem('tax_chatbot_feedback', JSON.stringify(feedbackHistory));
            } catch (error) {
                console.error('피드백 저장 실패:', error);
            }
        }

        // 피드백 히스토리 로드
        function loadFeedbackHistory() {
            try {
                const saved = localStorage.getItem('tax_chatbot_feedback');
                if (saved) {
                    feedbackHistory = JSON.parse(saved);
                }
            } catch (error) {
                console.error('피드백 로드 실패:', error);
                feedbackHistory = [];
            }
        }

        // 메시지 포맷팅
        function formatMessage(message) {
            if (!message) return '';
            
            // 줄바꿈을 <br>로 변환
            message = message.replace(/\n/g, '<br>');
            
            // 제목 스타일링 (넘버링 포함)
            const titleStyle = 'color: #333; margin: 50px 0 -20px 0; font-size: 18px; border-bottom: 2px solid #667eea; padding-bottom: 0px;';
            const referenceStyle = 'color: #667eea; margin: 50px 0 -20px 0; font-size: 18px; border-bottom: 2px solid #667eea; padding-bottom: 0px;';
            
            // 결론 섹션 스타일링
            message = message.replace(/\*\*(\d+\.\s*)?결론\*\*/g, `<h3 style="${titleStyle}">$1결론</h3>`);
            message = message.replace(/\*\*결론\*\*/g, `<h3 style="${titleStyle}">결론</h3>`);
            
            // 참고할 만한 링크 섹션 스타일링
            message = message.replace(/\*\*(\d+\.\s*)?참고할 만한 링크\*\*/g, `<h3 style="${referenceStyle}">$1참고할 만한 링크</h3>`);
            
            // Tax Agent 안내 말씀 섹션 스타일링
            const noticeStyle = 'margin-top: 80px; padding: 10px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 15px; border-left: 5px solid #667eea; box-shadow: 0 4px 15px rgba(0,0,0,0.1);';
            const noticeTitleStyle = 'color: #333; margin: 20px 0 -20px 0; font-size: 18px; border-bottom: 2px solid #667eea; padding-bottom: 0px;';
            message = message.replace(/\*\*Tax Agent 안내 말씀\*\*/g, `<div style="${noticeStyle}"><h3 style="${noticeTitleStyle}">Tax Agent 안내 말씀</h3>`);
            
            // 제목 넘버링 스타일링
            message = message.replace(/\*\*(\d+\.\s*.*?)\*\*/g, `<h3 style="${titleStyle}">$1</h3>`);
            message = message.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            
            // 이탤릭체
            message = message.replace(/\*(.*?)\*/g, '<em>$1</em>');
            
            // 마크다운 제목 스타일링
            message = message.replace(/^### (.*?)$/gm, '<h3 style="color: #667eea; margin: 20px 0 10px 0; font-size: 18px;">$1</h3>');
            message = message.replace(/^## (.*?)$/gm, '<h2 style="color: #333; margin: 25px 0 15px 0; font-size: 20px;">$1</h2>');
            message = message.replace(/^# (.*?)$/gm, '<h1 style="color: #333; margin: 30px 0 15px 0; font-size: 22px;">$1</h1>');
            
            // 표 스타일링
            message = message.replace(/\|(.+)\|/g, function(match, content) {
                const cells = content.split('|').map(cell => cell.trim());
                const isHeader = match.includes('---') || match.includes('구분') || match.includes('필요경비');
                
                if (isHeader) {
                    return `<tr>${cells.map(cell => `<th style="border: 1px solid #ddd; padding: 12px; background: #f8f9fa; font-weight: bold; text-align: center;">${cell}</th>`).join('')}</tr>`;
                } else {
                    return `<tr>${cells.map(cell => `<td style="border: 1px solid #ddd; padding: 12px; text-align: center;">${cell}</td>`).join('')}</tr>`;
                }
            });
            
            // 표 전체를 감싸는 테이블 태그 추가
            message = message.replace(/(<tr>.*?<\/tr>)/gs, '<table style="border-collapse: collapse; width: 100%; margin: 20px 0; font-size: 14px;">$1</table>');
            
            // 구분선 및 특수 기호 스타일링
            message = message.replace(/^---$/gm, '<div style="margin: 30px 0; padding: 20px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 15px; border-left: 5px solid #667eea; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">');
            message = message.replace(/▶ (.*?)$/gm, '<div style="margin: 15px 0; padding: 10px 15px; background: #f8f9fa; border-left: 4px solid #667eea; border-radius: 0 8px 8px 0;"><strong>▶ $1</strong></div>');
            message = message.replace(/✅ (.*?)$/gm, '<div style="margin: 10px 0; padding: 8px 12px; background: #e8f5e8; border-left: 3px solid #28a745; border-radius: 0 5px 5px 0;">✅ $1</div>');
            message = message.replace(/^• (.*?)$/gm, '<div style="margin: 8px 0; padding-left: 20px;">• $1</div>');
            
            // URL을 클릭 가능한 링크로 변환
            message = message.replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank" style="color: #667eea; text-decoration: none; font-weight: bold; padding: 2px 4px; background: rgba(102, 126, 234, 0.1); border-radius: 4px; transition: all 0.3s ease;">$1</a>');
            
            // 참고할 만한 링크 스타일링 - 공공기관 사이트만 표시
            const referenceLinkStyle = 'margin: 12px 0; padding: 15px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 10px; border-left: 4px solid #667eea; box-shadow: 0 2px 8px rgba(0,0,0,0.1);';
            const referenceLinkTextStyle = 'color: #667eea; text-decoration: none; font-weight: bold; display: flex; align-items: center; gap: 8px;';
            message = message.replace(/🔗 \[(.*?)\] - 🔗 참고자료 클릭/g, function(match, siteName) {
                // 사이트명에 따른 URL 가져오기
                let url = '';
                
                // 공공기관 사이트 URL 매핑 (참고할 만한 링크에는 공공기관만 표시)
                const publicInstitutionMap = {
                    '국가법령정보센터': 'https://www.law.go.kr',
                    '국세청': 'https://www.nts.go.kr',
                    '국세청 양도소득세': 'https://www.nts.go.kr/tax/yangdo_2.html',
                    '국세청 양도소득세 법령·상담': 'https://www.nts.go.kr/tax/yangdo_2.html',
                    '찾기쉬운 생활법령정보': 'https://lnp.nanet.go.kr',
                    '대법원 종합법률정보': 'https://glaw.scourt.go.kr',
                    '헌법재판소': 'https://www.ccourt.go.kr',
                    '행정안전부': 'https://www.mois.go.kr',
                    '기획재정부': 'https://www.moef.go.kr'
                };
                
                // 정확한 매칭 먼저 시도
                url = publicInstitutionMap[siteName];
                
                // 정확한 매칭이 없으면 키워드 매칭 시도 (공공기관만)
                if (!url) {
                    if (siteName.includes('국세청')) {
                        if (siteName.includes('양도소득세') || siteName.includes('양도세')) {
                            url = 'https://www.nts.go.kr/tax/yangdo_2.html';
                        } else {
                            url = 'https://www.nts.go.kr';
                        }
                    } else if (siteName.includes('국가법령') || siteName.includes('법령정보')) {
                        url = 'https://www.law.go.kr';
                    } else if (siteName.includes('생활법령') || siteName.includes('찾기쉬운')) {
                        url = 'https://lnp.nanet.go.kr';
                    } else if (siteName.includes('대법원') || siteName.includes('종합법률')) {
                        url = 'https://glaw.scourt.go.kr';
                    } else if (siteName.includes('헌법재판소')) {
                        url = 'https://www.ccourt.go.kr';
                    } else if (siteName.includes('행정안전부')) {
                        url = 'https://www.mois.go.kr';
                    } else if (siteName.includes('기획재정부')) {
                        url = 'https://www.moef.go.kr';
                    }
                }
                
                if (url) {
                    return `<div style="${referenceLinkStyle}"><a href="${url}" target="_blank" style="${referenceLinkTextStyle}"><span style="flex: 1;">${siteName}</span><span style="font-size: 12px; color: #666;">${url}</span></a></div>`;
                } else {
                    // 공공기관이 아닌 사이트는 표시하지 않음
                    return '';
                }
            });
            
            // 참고 번호를 클릭 가능한 링크로 변환 (개선된 버전)
            message = message.replace(/\[(\d+)\]/g, function(match, number) {
                // 참고할 만한 링크 섹션에서 사이트명 추출
                const referenceSection = message.match(/\*\*참고할 만한 링크\*\*([\s\S]*?)(?=\*\*Tax Agent 안내 말씀\*\*|$)/);
                if (referenceSection) {
                    const references = referenceSection[1].match(/🔗 \[(.*?)\] - 🔗 참고자료 클릭/g);
                    if (references && references[number - 1]) {
                        const siteName = references[number - 1].match(/🔗 \[(.*?)\] - 🔗 참고자료 클릭/)[1];
                        return `<a href="#" onclick="openReferenceLink('${siteName}'); return false;" style="background: #667eea; color: white; border-radius: 50%; width: 20px; height: 20px; display: inline-flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold; margin: 0 2px; vertical-align: middle; text-decoration: none; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.transform='scale(1.1)'; this.style.boxShadow='0 4px 8px rgba(102, 126, 234, 0.3)'" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='none'" title="참고할 만한 링크 ${number}로 이동">${number}</a>`;
                    }
                }
                return `<span style="background: #667eea; color: white; border-radius: 50%; width: 20px; height: 20px; display: inline-flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold; margin: 0 2px; vertical-align: middle;">${number}</span>`;
            });
            
            // 인사말 섹션 닫기 태그 추가
            message = message.replace(/🔗 http:\/\/www\.sostax\.co\.kr\/$/, '🔗 <a href="http://www.sostax.co.kr/" target="_blank" style="color: #667eea; text-decoration: none; font-weight: bold;">http://www.sostax.co.kr/</a></div>');
            
            return message;
        }

        // 로딩 상태 설정
        function setLoading(loading) {
            isLoading = loading;
            const sendButton = document.getElementById('sendButton');
            const stopButton = document.getElementById('stopButton');
            const restartButton = document.getElementById('restartButton');
            
            if (loading) {
                sendButton.disabled = true;
                sendButton.innerHTML = '<span class="loading-dots"></span>';
                stopButton.style.display = 'flex';
                restartButton.style.display = 'none';
                
                // 로딩 메시지 표시
                const messagesEl = document.getElementById('messages');
                const loadingEl = document.createElement('div');
                loadingEl.className = 'message bot';
                loadingEl.id = 'loadingMessage';
                loadingEl.innerHTML = `
                    <div class="message-avatar">💰</div>
                    <div class="message-content">답변을 준비하고 있습니다<span class="loading-dots"></span></div>
                `;
                messagesEl.appendChild(loadingEl);
                scrollToBottom();
            } else {
                sendButton.disabled = false;
                sendButton.innerHTML = '➤';
                stopButton.style.display = 'none';
                restartButton.style.display = 'none';
                
                // 로딩 메시지 제거
                const loadingEl = document.getElementById('loadingMessage');
                if (loadingEl) {
                    loadingEl.remove();
                }
            }
        }

        // 하단으로 스크롤
        function scrollToBottom() {
            const messagesEl = document.getElementById('messages');
            messagesEl.scrollTop = messagesEl.scrollHeight;
        }

        // HTML 이스케이프
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // 참고할 만한 링크 열기 함수 (공공기관만)
        function openReferenceLink(siteName) {
            // 공공기관 사이트 URL 매핑 - 키워드 매칭 포함
            const publicInstitutionMap = {
                '국가법령정보센터': 'https://www.law.go.kr',
                '국세청': 'https://www.nts.go.kr',
                '국세청 양도소득세': 'https://www.nts.go.kr/tax/yangdo_2.html',
                '국세청 양도소득세 법령·상담': 'https://www.nts.go.kr/tax/yangdo_2.html',
                '찾기쉬운 생활법령정보': 'https://lnp.nanet.go.kr',
                '대법원 종합법률정보': 'https://glaw.scourt.go.kr',
                '헌법재판소': 'https://www.ccourt.go.kr',
                '행정안전부': 'https://www.mois.go.kr',
                '기획재정부': 'https://www.moef.go.kr'
            };
            
            // 정확한 매칭 먼저 시도
            let url = publicInstitutionMap[siteName];
            
            // 정확한 매칭이 없으면 키워드 매칭 시도 (공공기관만)
            if (!url) {
                if (siteName.includes('국세청')) {
                    if (siteName.includes('양도소득세') || siteName.includes('양도세')) {
                        url = 'https://www.nts.go.kr/tax/yangdo_2.html';
                    } else {
                        url = 'https://www.nts.go.kr';
                    }
                } else if (siteName.includes('국가법령') || siteName.includes('법령정보')) {
                    url = 'https://www.law.go.kr';
                } else if (siteName.includes('생활법령') || siteName.includes('찾기쉬운')) {
                    url = 'https://lnp.nanet.go.kr';
                } else if (siteName.includes('대법원') || siteName.includes('종합법률')) {
                    url = 'https://glaw.scourt.go.kr';
                } else if (siteName.includes('헌법재판소')) {
                    url = 'https://www.ccourt.go.kr';
                } else if (siteName.includes('행정안전부')) {
                    url = 'https://www.mois.go.kr';
                } else if (siteName.includes('기획재정부')) {
                    url = 'https://www.moef.go.kr';
                }
            }
            
            if (url) {
                window.open(url, '_blank');
            } else {
                console.log('찾을 수 없는 공공기관 사이트명:', siteName);
                alert('해당 공공기관의 링크를 찾을 수 없습니다. 사이트명: ' + siteName);
            }
        }

        // CSV 필드 이스케이프 (한글 및 특수문자 안전 처리)
        function escapeCSVField(field) {
            if (!field) return '""';
            
            // 줄바꿈과 따옴표 처리
            let escaped = field.toString()
                .replace(/"/g, '""')  // 따옴표를 두 개로 이스케이프
                .replace(/\r\n/g, ' ')  // 줄바꿈을 공백으로
                .replace(/\n/g, ' ')    // 줄바꿈을 공백으로
                .replace(/\r/g, ' ');   // 줄바꿈을 공백으로
            
            // 쉼표, 따옴표, 줄바꿈이 포함된 경우 따옴표로 감싸기
            if (escaped.includes(',') || escaped.includes('"') || escaped.includes('\n') || escaped.includes('\r')) {
                return `"${escaped}"`;
            }
            
            return escaped;
        }

        // ===== TAX GOLD DATASET =====
        const taxGoldDataset = [
            {
                id: 1,
                question: "직계존속이 8년이상 재촌 자경한 농지를 증여받았고 해당 농지를 양도하려고 하는데 사업용 토지에 해당하나요 ?",
                answer: "답변: 직계존속이 8년 이상 재촌(농지 소재지에 거주)·자경(직접 경작)한 농지를 증여받은 경우, 해당 농지는 일반적으로 **사업용 토지**로 인정받을 수 있습니다[1][2]. 이는 양도소득세법 시행령 제168조의8 제3항 제1호의2에 따른 것으로, 증여받은 사람이 직접 재촌·자경 여부와 무관하게, 증여한 직계존속이 8년 이상 재촌·자경한 사실만 충족하면 사업용 토지로 봅니다[1][2]. 단, 다음의 조건을 추가로 주의해야 합니다. - **도시지역(주거·상업·공업지역)에 해당하는 토지는 제외**입니다. 만약 해당 농지가 주거·상업·공업지역, 즉 도시지역에 해당하면 사업용 토지로 인정받지 못할 수 있습니다. 단, 녹지지역과 개발제한구역은 도시지역에서 제외됩니다[1][2][3]. - 8년 이상 재촌·자경을 증명하려면 **농지원부, 농업경영체 등록확인서, 농기계 구입 영수증, 농작물 판매 증빙, 직불금 수령 기록 등**이 필요합니다[1]. **사례 예시** - 어머니가 8년 이상 실제로 해당 농지에 거주하며 직접 농사를 짓다가, 그 농지를 자녀에게 증여했고, 자녀가 이후 해당 농지를 매도하는 경우 - 해당 농지는 사업용 토지로 인정되어 **양도소득세 기본세율**(6~45%)이 적용됩니다. 비사업용 토지는 기본세율에 10%p가 가산되는 중과세율이 적용됩니다[1][2]. - 장기보유특별공제도 적용될 수 있습니다. 다만, 증여 후 바로 양도할 경우 보유기간 산정 등 세부 요건에 따라 달라질 수 있으니 주의해야 합니다[1]. **주의사항** - 도시지역에 해당하는 농지는 사업용 토지에서 제외될 수 있으니, 해당 토지가 위치한 지역의 용도지역을 반드시 확인해야 합니다[1][2][3]. - 증여받은 농지를 5년 이내에 양도하는 경우, 증여세 감면을 받았다면 감면된 증여세를 추징당할 수 있으니 사전에 반드시 검토하세요[3]. 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3]
            },
            {
                id: 2,
                question: "본인명의 대지 위에 타인 소유의 주택이 있습니다. 주택분 재산세를 내고 있는데, 해당 기간은 사업용 기간으로 보는것인지요 ?",
                answer: "답변: 본인 명의의 대지 위에 타인 소유의 주택이 있고, 이에 대해 주택분 재산세를 납부하고 계신 경우, 해당 기간이 양도소득세상 '사업용 토지'의 보유기간으로 인정되는지 여부는 다음과 같습니다. - **타인 소유 주택의 부속토지**(즉, 본인 소유의 토지 위에 타인 소유의 주택이 있는 경우)라 하더라도, 해당 토지가 '기준면적 이내'의 토지(주택이 정착된 면적에, 지역별 배율을 곱해 산정한 면적 이내)라면, 이 기간은 '비사업용 토지'에 해당하지 않습니다. 즉, 이 기간은 **사업용 토지 보유기간**으로 인정됩니다[4]. - 국세청 유권해석(법인, 서면-2017-법인-2453, 2018.01.15)에 따르면, 토지 소유기간 대부분을 타인 주택의 부속토지로 사용한 기준 면적 이내의 토지는 **사업용 부동산**으로 볼 수 있습니다[4]. - 즉, 주택분 재산세를 납부하고 있는 기간 중에 해당 토지가 기준면적 이내라면, 양도소득세상 '사업용 토지'로 간주되어 비사업용 토지 중과(세율 2배, 장기보유특별공제 배제 등) 대상이 아니게 됩니다[4]. - 단, 만약 해당 토지의 면적이 기준면적(주택 정착면적 × 지역배율)을 초과한다면, 초과분은 비사업용에 해당될 수 있으니 주의가 필요합니다. - 참고로, '주택분 재산세'는 주택과 그 부속토지를 하나의 과세 단위로 보아 과세하며, 실질적인 소유관계와 무관하게 납세의무자가 정해집니다[1][3]. #### 실제 예시 예를 들어, - 본인 소유의 대지 150㎡ 위에 타인 소유의 주택이 있고, 해당 주택의 기준면적(예: 120㎡ × 5배 = 600㎡, 수도권일 경우)이 600㎡라면, 150㎡ 전체가 사업용 토지로 인정됩니다. - 이 때, 주택분 재산세를 납부한 기간은 사업용 토지 보유기간으로 보아 양도세 계산시 비사업용 중과가 적용되지 않습니다. #### 요약 - **타인 소유 주택의 부속토지로 사용된 기준면적 이내 토지는 사업용 토지로 인정**되며, 해당 기간은 사업용 보유기간으로 봅니다[4]. - 다만, 기준면적을 초과하는 경우 초과분은 비사업용이 될 수 있으니, 실제 면적과 기준면적을 반드시 확인해야 합니다. 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 3, 4]
            },
            {
                id: 3,
                question: "재산세가 종합합산과세되는 토지인데 비사업용 토지에 해당하나요 ?",
                answer: "답변: 재산세가 **종합합산과세**되는 토지는 원칙적으로 양도소득세 계산 시 **비사업용 토지**에 해당합니다[2][3]. 즉, 농지, 임야, 목장용지 외의 토지가 종합합산과세되는 경우, 그 보유기간은 비사업용기간으로 간주되어 양도세 중과 대상이 될 수 있습니다[2][3]. 다만, 다음의 경우는 예외적으로 **비사업용 토지로 보지 않는 기간**에 해당합니다[2][3]: - 「지방세법」 또는 관련 법률에 따라 재산세가 비과세되거나 면제되는 토지 - 「지방세법」 제106조 제1항 제2호 및 제3호에 따른 재산세 **별도합산과세대상** 또는 **분리과세대상**이 되는 토지 - 「소득세법 시행령」 제168조의11 제1항 각 호의 어느 하나에 해당하는 토지 즉, **종합합산과세** 대상이면서 위의 예외에 해당하지 않는 토지는 비사업용 토지로 판정됩니다. 예를 들어, 도시지역의 일반 잡종지, 주차장, 상업용 부지 등은 종합합산과세 대상이며, 이 경우 별도의 사업적 사용이나 공익 목적이 없다면 비사업용 토지로 간주됩니다[2][3][5]. ### 실제 사례 예시 - 도시지역에 소재한 잡종지(농지, 임야, 목장용지 아님)가 종합합산과세 대상이면, 사업에 직접 사용하지 않는 한 **비사업용 토지**로 판정되어 양도 시 중과세율이 적용됩니다. - 반면, 같은 토지라도 재산세 분리과세대상(예: 골프장, 고급오락장 부지 등)이나 별도합산과세대상(예: 일정 범위 내의 건축물 부속토지 등)이면 **비사업용 토지로 간주되지 않습니다**[5][1]. ### 요약 - **종합합산과세 토지 → 원칙적으로 비사업용 토지** - **예외: 별도합산, 분리과세, 비과세·면제, 소득세법 시행령 168조의11 적용시 비사업용 제외** 항상 실제 적용 전에는 해당 토지의 구체적인 용도, 과세 구분, 보유 및 사용 현황을 반드시 확인해야 하며, 예외 사유 해당 여부도 꼼꼼히 검토해야 합니다. 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [2, 3, 5]
            },
            {
                id: 4,
                question: "경북 구미시에소지한 공장내에 종업원인 미혼직원이 거주할수 있도록 합숙소에 대해 1세대 1주택 양도소득세 비과세 판단할때 이합숙소를 주택수에 포함해야하는지 여부에 대해 판단해줘 법적 근거도 함께",
                answer: "답변: 공장 내 합숙소가 **1세대 1주택 양도소득세 비과세 판단 시 주택 수에 포함되는지**에 대한 답변은 다음과 같습니다. **직원이 거주하는 합숙소가 공장 내에 설치되어 있고, 종업원들이 숙식 목적으로 사용하는 경우, 해당 합숙소는 소득세법상 '주택'에 포함되지 않습니다.** 즉, 이 경우 합숙소는 1세대 1주택 비과세 판정 시 주택 수에 포함하지 않습니다. --- ### 필수 법적 근거와 해설 - **소득세법 기본통칙 89-11 [공장내합숙소의 주택여부]** \"공장에 부수된 건물을 합숙소로 사용하는 경우에는 주택으로 보지 아니한다.\" 이 통칙에 따라, 공장 내에 설치된 종업원 합숙소는 주택 수 산정에서 제외합니다[3]. - **판례 및 해설** 국세청 및 조세심판원의 유권해석에서도 공장 내에 부수된 합숙소는 주택으로 보지 않는다고 명확히 밝히고 있습니다[3]. 실제 사례에서도, 공장 내 합숙소는 주택 수에 산입하지 않아 1세대 1주택 비과세가 가능하다고 판단되었습니다. --- ### 단계별 설명 1. **합숙소의 위치와 용도 확인** - 공장 내에 설치된 종업원용 합숙소여야 함 - 주거용 오피스텔, 일반 아파트 등은 해당하지 않음 2. **주택 수 산정 시 제외 조건** - 소득세법 기본통칙에 따라, 공장 부지 내 종업원 합숙소는 주택 수에서 제외[3]. 3. **실제 적용 사례** - 판례 및 과세관청 해석에 따라, 별도의 주택으로 보지 않아 1세대 1주택 비과세 요건을 판단할 때 불이익이 없습니다. --- ### 참고 예시 - **예시**: 구미에 공장을 운영하는 A씨가 공장 내에 미혼 종업원 합숙소(기숙사)를 운영하고 있고, 본인 명의로 아파트 1채를 소유하고 있으며, 해당 아파트를 양도할 때 1세대 1주택 비과세를 적용받고자 합니다. ▶ 이 경우, 공장 내 합숙소는 주택 수에 포함되지 않으므로 1세대 1주택 비과세 적용이 가능합니다. --- ### 주의사항 - 공장 내가 아닌 별도 부지의 합숙소, 또는 외부 기숙사 등은 주택 수에 포함될 수 있으니, 반드시 위치와 용도를 명확히 구분해야 합니다[3]. - 최근 세법이나 행정해석의 변경 여부를 항상 확인하는 것이 중요합니다. --- **관련 법령:** - 소득세법 기본통칙 89-11 - 소득세법 제89조(비과세 양도소득)[3] 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [3]
            },
            {
                id: 5,
                question: "장기 임대주택을 양도할경우 비과세 되는 양도차익의 범위에 대해 알려줘 --- 2013년 10월 A 주택 거주주택 취득 2016년 5월 B 주택 장기임대주택취득 2019 3월 A 주택양도 2024년 5월 1일 장기임대주택 양도",
                answer: "답변: 1. 장기임대주택 양도소득세 과세특례 요건장기임대주택에 대한 양도소득세 비과세는 조세특례제한법 제97조의4에 따라 적용됩니다1. 기본 요건은 다음과 같습니다:- 민간건설임대주택 또는 민간매입임대주택을 6년 이상 임대- 임대사업자 등록 및 관련 의무 준수- 임대료 증가율 5% 이하 준수귀하의 경우 B주택을 2016년 5월 취득하여 2024년 5월까지 약 8년간 보유하므로 6년 이상 임대 요건을 충족합니다.2. 거주주택 비과세 후 임대주택 양도시 특별 계산법중요한 점은 2019년 3월 A주택(거주주택) 양도시 1세대1주택 비과세 혜택을 받았다는 것입니다24. 이 경우 B주택(장기임대주택) 양도시에는 전체 양도차익에 대해 비과세가 적용되는 것이 아니라, 직전 거주주택 매각 이후 발생한 양도차익에 대해서만 비과세가 적용됩니다.즉, B주택의 양도차익 중:- 2016년 5월 ~ 2019년 3월: 과세 대상 (노란색 구간)- 2019년 3월 ~ 2024년 5월: 비과세 적용 (파란색 구간)3. 기준시가 비율에 따른 안분계산 방법 기준시가 비율로 계산해야 합니다2. 구체적인 계산 방식은 다음과 같습니다:```전체 양도차익 = 양도가액 - 취득가액 - 필요경비비과세 적용 양도차익 = 전체 양도차익 × (직전거주주택 매각일 기준시가 / 취득당시 기준시가)과세 대상 양도차익 = 전체 양도차익 - 비과세 적용 양도차익```구분기간과세여부계산방법1구간2016.5 ~ 2019.3과세기준시가 상승분 비율로 안분2구간2019.3 ~ 2024.5비과세기준시가 상승분 비율로 안분4. 실무상 주의사항- 기준시가는 국세청에서 매년 고시하는 주택 기준시가를 사용합니다- 2019년 3월 A주택 양도일 당시의 B주택 기준시가가 핵심 기준점이 됩니다- 장기임대주택 등록 및 임대 의무사항을 성실히 이행했는지 확인이 필요합니다- 임대료 증가율 5% 이하 준수 여부도 중요한 요건입니다5. 결론귀하의 경우 B주택(장기임대주택) 양도시 전체 양도차익이 비과세되는 것이 아니라, 2019년 3월 A주택 양도 이후 발생한 양도차익에 대해서만 비과세가 적용됩니다. 이때 계산은 기준시가 비율에 따른 안분계산으로 이루어지며, 2016년~2019년 구간의 양도차익은 과세 대상이 됩니다. 정확한 세액 계산을 위해서는 각 시점의 기준시가 확인과 함께 전문가 상담을 받으시길 권합니다.",
                references: [1, 2, 4]
            },
            {
                id: 6,
                question: "부동산 양도 계약시 조합원 입주권상태이고, 잔금이 전에 사용 승인이 난 경우 양도시 입주권을 양도하는건가요 ? 주택을 양도하는 건가요 ?",
                answer: "답변: 조합원 입주권 상태에서 잔금 이전에 사용승인이 난 경우, **양도 시점에 따라 양도 대상이 달라집니다**. 사용승인(준공)이 나기 전에는 '입주권'을 양도하는 것으로 보며, 사용승인 후에는 '주택'을 양도하는 것으로 판단합니다[2][4]. **핵심 설명** - **입주권 양도**: 사용승인 이전에 양도계약과 소유권 이전이 이루어진 경우, '조합원 입주권'을 양도한 것으로 간주합니다. 즉, 아직 실질적으로 완성된 주택이 아니라, 향후 주택을 받을 수 있는 권리를 파는 것입니다[2]. - **주택 양도**: 사용승인(준공)이 완료된 이후에 양도계약 및 소유권 이전이 이루어진 경우, 실질적으로 '주택'을 양도하는 것으로 봅니다. 이 시점부터는 입주권이 실체를 가진 주택으로 전환됩니다[2][4]. **실제 사례 예시** - 만약 2025년 8월 1일에 사용승인이 났고, 2025년 8월 10일에 잔금과 소유권 이전이 이루어졌다면, 이 때의 양도는 '주택'을 파는 것으로 봅니다. - 반대로, 사용승인 전에 계약하고 잔금 및 소유권 이전이 모두 완료되었다면 '입주권'을 양도하는 것입니다. **양도소득세 실무 영향** - 입주권 양도와 주택 양도는 양도소득세 비과세 요건 및 계산 방식이 다릅니다. 입주권은 비과세 요건이 까다롭고, 주택은 일반 주택 양도와 동일하게 취급합니다[1][3]. - 입주권 양도의 경우, 청산금 등 추가 필요경비를 고려할 수 있습니다[4]. **단계별 요약** 1. 사용승인 이전: 입주권 양도 2. 사용승인 이후: 주택 양도 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3, 4]
            },
            {
                id: 7,
                question: "2010.12월 분양권을 취득하고 2012년 8월 완공입주한 1주택 보유자가 2019년 6월부터 2022년 8월까지 해외법인 장으로 발령받아 가족전체가 출국하였다가 귀국한 경우, 장기보유특별공제 적용시 거주기간 계산은?",
                answer: "답변: 1. 보유기간과 거주기간 구분 계산제시해주신 사례에서 장기보유특별공제 적용을 위한 기간 계산은 다음과 같이 구분됩니다14.보유기간 계산:- 2010년 12월 분양권 취득일부터 양도일까지 전체 기간으로 계산- 해외체류 기간도 보유기간에는 포함됨- 예: 2025년 양도시 약 14년 이상의 보유기간 인정거주기간 계산:- 2012년 8월(완공입주) ~ 2019년 6월: 약 6년 10개월- 2019년 6월 ~ 2022년 8월: 해외체류 기간으로 거주기간에서 제외- 2022년 8월(귀국) ~ 양도시까지: 실제 거주한 기간만 산입2. 1세대 1주택 장기보유특별공제율 적용해당 사례는 1세대 1주택자로서 2년 이상 거주 요건을 충족할 경우, 다음과 같이 공제율이 적용됩니다23.- 보유기간 공제: 보유 연수 × 4% (최대 40%)- 거주기간 공제: 거주 연수 × 4% (최대 40%)- 합산 최대 공제율: 80%까지 가능구체적 계산 예시 (2025년 양도 가정):- 보유기간: 14년 × 4% = 56% → 최대 40% 적용- 거주기간: 약 9년 × 4% = 36% 적용- 총 공제율: 76%3. 해외체류 기간 거주기간 제외 근거국세청 유권해석에 따르면, 해외근무 등으로 가족 전체가 출국하여 해당 주택에 실제로 거주하지 않는 기간은 거주기간에서 제외됩니다4.제외 요건:- 가족 전체의 출국- 해당 주택에 실거주하지 않는 상태- 단순 출장이 아닌 장기 해외근무인정 요건:- 귀국 후 재거주하는 기간은 다시 거주기간에 산입- 출국 전 거주기간과 귀국 후 거주기간을 합산하여 계산4. 실무상 주의사항 및 절세 전략주의사항:- 해외체류 중에도 주택을 임대하거나 다른 용도로 사용한 경우 거주기간 인정 여부가 달라질 수 있음- 가족 중 일부가 국내에 남아 거주한 경우 거주기간 인정 가능성 검토 필요- 출국신고, 재입국 기록 등 객관적 증빙자료 준비 필수절세 전략:- 해외체류 기간을 제외하고도 2년 이상 거주 요건을 충족하는지 확인- 귀국 후 충분한 거주기간을 확보한 후 양도 검토- 보유기간과 거주기간을 종합적으로 고려한 최적 양도시기 결정5. 결론해외법인 장으로 발령받아 가족 전체가 출국한 기간(2019.6~2022.8, 약 3년 2개월)은 거주기간에서 제외되며, 출국 전 거주기간과 귀국 후 거주기간만을 합산하여 장기보유특별공제를 계산해야 합니다. 보유기간은 분양권 취득일부터 양도일까지 전체 기간으로 인정되므로, 해외체류 기간과 상관없이 연속적으로 계산됩니다.6. 참고할 만한 링크🔗 국세청 양도소득세 기본정보 - 🔗 참고자료 클릭",
                references: [1, 2, 3, 4]
            },
            {
                id: 8,
                question: "1세대 1주택 비과세인 경우,양도차손으로 신고가능한가요 ?",
                answer: "답변: 1. 1세대 1주택 비과세 대상의 양도차손 신고 가능성1세대 1주택 비과세 대상 주택을 양도하여 손실이 발생한 경우에도 신고는 가능합니다1. 비록 과세 대상이 아니더라도 신고 자체를 법적으로 금지하는 것은 아니기 때문입니다.국세청 양도소득세 전자신고 시스템에서도 \"1세대 1주택 비과세대상\"을 선택할 수 있는 옵션이 마련되어 있어5, 비과세 대상 주택의 양도에 대해서도 신고 절차를 진행할 수 있습니다.2. 양도차손 신고의 실익과 목적비과세 대상 주택의 양도차손을 신고하는 것은 다음과 같은 실익이 있습니다:- 정확한 거래내역 신고: 투명한 거래내역을 세무당국에 신고함으로써 향후 발생할 수 있는 오해나 분쟁을 방지할 수 있습니다- 세무 리스크 방지: 미신고로 인한 추후 세무조사나 불이익을 사전에 차단할 수 있습니다- 향후 세무 처리의 명확성: 차후 다른 부동산 거래 시 참고자료로 활용할 수 있습니다3. 양도차손 반영 신고 방법1세대 1주택 비과세 대상 주택의 양도차손을 신고할 때는 다음과 같이 진행합니다:- 과세구분 선택: \"1세대 1주택 비과세대상\" 선택5- 실제 거래가액 입력: 양도가액은 실제 양도 대금을 정확히 입력- 취득가액 및 필요경비: 실제 취득가액과 발생한 필요경비를 모두 반영하여 입력- 양도차손 반영: 취득가액이 양도가액보다 클 경우 양도차손이 발생하며, 이를 그대로 신고서에 반영실제 신고 시에는 국세청 홈택스의 양도소득세 간편신고를 이용하여 전자신고로 진행할 수 있습니다5.4. 결론1세대 1주택 비과세 대상 주택에서 발생한 양도차손은 과세대상이 아니지만 신고는 가능하며, 정확한 거래내역 신고와 향후 세무 리스크 방지를 위해 신고하는 것이 바람직합니다. 신고 시에는 실제 발생한 양도차손을 그대로 반영하여 신고하는 것이 정확한 방법입니다.",
                references: [1, 5]
            },
            {
                id: 9,
                question: "부동산 양도 계약시 조합원 입주권상태이고, 잔금시 주택인 경우 양도시입주권을 양도한건가요? 주택을 양도한건가요 ?",
                answer: "답변: 1. 양도시점의 세법상 판단기준세법에서 양도소득세 계산 시 가장 중요한 기준은 양도계약 체결 시점의 자산 상태입니다3. 양도 계약을 체결한 시점에 조합원 입주권 상태였다면, 잔금 시점에 주택이 완공되더라도 세법상으로는 \"조합원 입주권\"을 양도한 것으로 봅니다.이는 양도소득세법에서 양도의 시기를 계약체결일(잔금지급일이 계약체결일부터 3개월 이내인 경우) 또는 대금지급일로 정하고 있기 때문입니다. 2. 조합원 입주권의 세법상 지위조합원 입주권은 '도시 및 주거환경정비법'에 따라 관리처분계획 인가 후 취득한 '입주자 선정 지위'를 의미하며3, 세법에서는 이를 주택과 구분하여 양도소득세를 적용합니다.분양권이나 입주권은 주택이 아니라 주택을 취득할 수 있는 권리이므로, 원칙적으로 양도 시 세금을 내야 합니다1. 다만, 원래 주택이었다가 입주권으로 변한 경우에는 특별한 비과세 혜택이 있을 수 있습니다.3. 양도소득세 계산방법조합원 입주권 양도 시 양도차익은 다음과 같이 계산됩니다2:양도차익 = 관리처분계획인가후양도차익 + 관리처분계획인가전양도차익- 관리처분계획인가후양도차익: 양도가액 - (기존건물과 그 부수토지의 평가액 + 양도시까지 납부한 청산금) - 실제 필요경비 등장기보유특별공제의 경우, 조합원 입주권 양도 시에도 적용이 가능합니다4. 관리처분 계획인가 전 기존 부동산분 양도차익에 대해 장기보유특별공제를 적용할 수 있으며, 1세대 1주택에 해당하는 조합원 입주권은 최대 10%까지의 공제율을 적용받을 수 있습니다.4. 실무상 주의사항 및 절세 전략비과세 요건 검토: 매도 시점이 관리처분계획 인가일 이후라면, 관리처분계획 인가일 기준으로 주택 비과세 요건을 만족한 경우에만 비과세 혜택을 받을 수 있습니다3.1가구 1주택 비과세: 보유 기간 및 거주 기간 요건을 충족하면 매도금액 12억원 이하분에 대해 비과세가 가능하지만, 12억원 초과분에 대해서는 장기보유공제 등을 반영해 양도소득세를 계산해야 합니다3.5. 결론부동산 양도 계약 시 조합원 입주권 상태이고 잔금 시점에 주택이 완공된 경우, 세법상 양도는 \"조합원 입주권\"의 양도로 봅니다. 계약체결 시점의 자산 성격이 양도소득세 계산의 기준이 되므로, 주택 양도가 아닌 조합원 입주권 양도로 세무처리해야 합니다. 이 경우 조합원 입주권에 적용되는 특별한 양도차익 계산방법과 장기보유특별공제 규정을 적용하여 양도소득세를 산정해야 합니다.",
                references: [1, 2, 3, 4]
            },
            {
                id: 10,
                question: "본인명의 대지 위에 타인 소유의 주택이 있습니다. 주택분 재산세를 내고있는데, 해당 기간은 사업용 기간으로 보는것인지요 ?",
                answer: "답변: 본인 명의 대지 위에 **타인 소유의 주택**이 있고, 주택분 재산세를 내고 있는 경우, 해당 기간을 양도소득세상 '사업용 토지'의 보유기간으로 인정됩니다. 타인 소유 주택의 부속토지라 하더라도, 해당 토지가 '기준면적 이내'라면 이 기간은 **사업용 토지 보유기간**으로 인정됩니다. 국세청 유권해석에 따르면, 토지 소유기간 대부분을 타인 주택의 부속토지로 사용한 기준 면적 이내의 토지는 **사업용 부동산**으로 볼 수 있습니다. 즉, 주택분 재산세를 납부하고 있는 기간 중에 해당 토지가 기준면적 이내라면, 양도소득세상 '사업용 토지'로 간주되어 비사업용 토지 중과 대상이 아니게 됩니다. 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3]
            },
            {
                id: 11,
                question: "1세대 1주택 비과세 요건에 대해 알려주세요",
                answer: "답변: 1세대 1주택 비과세 요건은 다음과 같습니다: **1. 기본 요건** - 1세대가 1주택을 보유하고 있는 경우 - 해당 주택에 2년 이상 거주한 경우 - 양도가액이 12억원 이하인 경우 **2. 세대 구성원** - 배우자와 미혼자녀(만 20세 미만 또는 만 20세 이상이면서 학생인 경우) - 부모, 조부모, 손자녀 등 직계존비속 **3. 거주 요건** - 양도일 현재까지 2년 이상 거주 - 단, 해외체류, 병원입원 등 부득이한 사유로 인한 부재는 거주기간에 포함 **4. 양도가액 제한** - 양도가액이 12억원 이하 - 12억원 초과분에 대해서는 과세 **5. 주택 수 제한** - 1세대가 1주택만 보유하고 있어야 함 - 다른 주택을 보유하고 있다면 비과세 적용 불가 **6. 장기보유특별공제** - 보유기간에 따라 최대 40%까지 공제 가능 - 거주기간에 따라 추가로 최대 40%까지 공제 가능 - 합산 최대 80%까지 공제 가능 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3]
            },
            {
                id: 12,
                question: "양도소득세 계산 방법을 알려주세요",
                answer: "답변: 양도소득세 계산 방법은 다음과 같습니다: **1. 양도차익 계산** 양도차익 = 양도가액 - 취득가액 - 필요경비 **2. 과세표준 계산** 과세표준 = 양도차익 - 장기보유특별공제 - 기본공제(연 250만원) **3. 세율 적용** - 기본세율: 6%~45% (누진세율) - 비사업용 토지: 기본세율 + 10%p (중과세율) **4. 장기보유특별공제** - 보유기간: 연수 × 4% (최대 40%) - 거주기간: 연수 × 4% (최대 40%) - 합산 최대 80% **5. 세액 계산** 양도소득세 = 과세표준 × 세율 **6. 비과세 요건** - 1세대 1주택: 양도가액 12억원 이하 - 장기보유특별공제 적용 후 과세표준이 0원 이하인 경우 **7. 신고 및 납부** - 양도일이 속하는 연도의 다음 연도 5월 31일까지 신고 - 세액은 신고와 동시에 납부 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3]
            },
            {
                id: 13,
                question: "비과세 여부 판단해줘 --- 1. 2017년 1월 1일 건설임대주택 임대차 계약후 전세대원 거주시작 2. 5년거주후 2024년 8월 분양전환(조정대상지역임) 3. 2025년 7월 1일 양도",
                answer: "답변: 1. 건설임대주택 분양전환 후 양도 시 비과세 요건 분석해당 사례는 건설임대주택에서 분양전환된 주택의 양도로, 일반적인 1세대 1주택 비과세 요건과는 다른 특례 조항이 적용됩니다.임대차 계약 기간 중 거주기간 인정: 2017년 1월부터 5년간 전 세대원이 거주한 기간은 분양전환 후 거주기간으로 인정됩니다2. 이는 건설임대주택의 특성상 임차인이 실질적으로 거주하면서도 소유권은 없는 상황을 고려한 특례입니다.2. 비과세 요건 충족 여부 검토보유기간 요건: 분양전환일(2024년 8월)부터 양도일(2025년 7월)까지 약 11개월로, 일반적인 2년 보유 요건을 충족하지 못합니다.거주기간 요건: 조정대상지역의 경우 2년 이상 거주 요건이 필요하며, 임대차 계약 체결부터의 거주기간(5년)을 포함하여 충분히 충족합니다2.건설임대주택 분양전환 특례: 임대차 계약을 체결하고 5년 이상 전 세대원이 거주한 경우, 분양전환 후 1년 이상 보유하고 거주했으면 비과세 요건을 충족하는 것으로 해석됩니다.3. 결론현재 상황에서는 비과세 적용이 어려울 것으로 판단됩니다. 분양전환 후 보유기간이 약 11개월로 1년 미만이기 때문입니다.건설임대주택 분양전환 특례가 적용되더라도, 분양전환 후 최소 1년 이상의 보유기간이 필요한 것으로 보이며, 현재 약 11개월의 보유기간으로는 이 요건을 충족하지 못합니다.따라서 해당 주택의 양도 시에는 양도소득세가 과세될 가능성이 높으며, 정확한 세무처리를 위해서는 관할 세무서나 전문가와의 상담을 권장합니다.",
                references: [1, 2, 4]
            },
            {
                id: 14,
                question: "장기 임대주택을 양도할경우 비가세 디는 양도차익의 범위에 대해 알려줘 --- 2013년 10월 A 주택 거주 주택 취득 2016년 5월 B주택 장기임대주택취득 2019년 3월 A주택양도 2024년 5월 1일 장기임대주택양도",
                answer: "답변: 장기임대주택을 양도할 때 **비과세되는 양도차익의 범위**는",
                references: [1, 2, 4]
            },
            {
                id: 15,
                question: "취득후 2년이내 양도를 한경우 15억 초과분에 대해 양도소득세 과세할때 세율을 알려줘",
                answer: "답변: 1. 2년 이내 단기 양도 중과세율취득 후 2년 이내에 양도하는 경우 단기 양도에 해당하여 중과세율이 적용됩니다13. 보유 기간에 따른 세율은 다음과 같습니다:- 1년 미만 보유: 70%- 1~2년 미만 보유: 60%따라서 취득 후 2년 이내 양도 시에는 60%의 세율이 적용됩니다1.2. 15억 초과분에 대한 적용 방식단기 양도 중과세는 양도차익 구간에 관계없이 전체 양도차익에 대해 일률적으로 적용됩니다. 즉, 15억 초과분뿐만 아니라 전체 양도차익에 대해 60% 세율이 적용됩니다1.일반적인 기본 세율(6%~45%의 누진세율)과 달리, 단기 양도 중과세는 양도차익 전체에 대해 동일한 세율이 적용되는 구조입니다.3. 단기 양도 중과세 배경 및 적용 시기이러한 단기 양도 중과세는 2020년 7월 10일 주택시장안정 보완대책에 따라 도입되었습니다3. 단기 양도차익 환수를 목적으로 하여:- 1년 미만: 40% → 70%로 인상- 2년 미만: 기본세율 → 60%로 인상4. 결론취득 후 2년 이내 양도한 경우 15억 초과분을 포함하여 전체 양도차익에 대해 60%의 세율이 적용됩니다. 이는 단기 투기 방지를 위한 중과세 조치로, 양도차익 구간별 누진세율이 아닌 일률 적용됩니다.",
                references: [1, 3]
            },
            {
                id: 16,
                question: "근데 왜 처음부터 말안해줫어",
                answer: "답변: Tax Agent는 n8n엔진을 기반으로 답변을 제공하는 Agent 입니다. Agent는 다소 실수가 있을 수 있습니다. 다시 질문해 주시면 성실하게 답변하겠습니다.",
                references: []
            },
            {
                id: 17,
                question: "양도소득세 배우자 및 직계존비속 이월과세 대상여부 판단해줘 --- 1. 2022년 5월 17일 증여 취득 (취득가액 : 25,216,480원) 2. 2024년 01월 10일 수용양도 (양도가액 : 30,449,110원) 3. 사업인정고시일(2020년 12월 28일)이전 2년 이후 증여로 취득 4. 증여자 2006 4월 1일 상속취득",
                answer: "답변: 1. 이월과세 기본 요건 분석배우자 및 직계존비속 이월과세는 증여받은 부동산을 증여일로부터 10년 이내(2022년 이전 증여는 5년 이내)에 양도하는 경우 적용됩니다13. 귀하의 사례를 살펴보면:- 증여일: 2022년 5월 17일 (2022년 이후 증여이므로 10년 규정 적용)- 양도일: 2024년 1월 10일 (증여일로부터 약 1년 8개월 후)- 기간: 10년 이내에 양도하므로 기본적으로 이월과세 적용 요건을 충족합니다2. 이월과세 예외사항 - 협의매수/수용 양도그러나 소득세법상 이월과세가 적용되지 않는 예외사항이 있습니다. 그 중 하나가 법률에 따라 협의매수 또는 수용에 의한 양도입니다1.귀하의 사례는:- 2024년 1월 10일 수용양도- 사업인정고시일: 2020년 12월 28일 (증여 이전)- 사업인정고시일 이전 2년 이후 증여로 취득이는 명백히 법률에 따른 수용에 의한 양도에 해당하므로 이월과세 예외사항에 적용됩니다.3. 이월과세 미적용 사유수용양도의 경우 이월과세가 적용되지 않는 이유는 다음과 같습니다:- 수용은 토지소유자의 의지와 관계없이 공익사업을 위해 강제적으로 이루어지는 것- 증여를 통한 양도소득세 회피 목적이 아닌 불가피한 양도- 공익사업 추진의 원활성을 위한 정책적 배려따라서 귀하의 경우 이월과세를 적용하지 않고 일반적인 양도소득세 계산방법을 적용합니다:- 취득가액: 25,216,480원 (증여받을 당시 가액)- 양도가액: 30,449,110원- 양도차익: 5,232,630원 (양도가액 - 취득가액)4. 결론귀하의 사례는 2022년 5월 17일 증여받은 부동산을 2024년 1월 10일에 수용으로 양도한 경우로, 증여일로부터 10년 이내 양도에 해당하여 기본적으로는 이월과세 적용 요건을 충족합니다. 그러나 법률에 따른 수용에 의한 양도는 이월과세 예외사항에 해당하므로, 이월과세를 적용하지 않고 일반적인 양도소득세 계산방법으로 신고하는 것이 올바릅니다",
                references: [1, 2, 4]
            },
            {
                id: 18,
                question: "양도소득세 비과세 여부 판단해줘 --- 1. 2017. 04. 11. 매매취득 (취득가액 : 500,000,000) 2. 2024. 03. 04. 매매양도 ( 양도가액 : 2,280,000,000) 3. 비거주자 - 2016년 12월부터 일본거주",
                answer: "답변: 질문하신 사례는 **비거주자가 국내 1주택을 양도하는 경우 양도소득세 비과세 적용 여부**에 대한 내용입니다. --- ### 핵심 답변 **비거주자는 1세대 1주택 양도소득세 비과세를 적용받을 수 없습니다.** 즉, 일본에 2016년 12월부터 거주하고 있고, 2024년 3월 4일에 양도한 경우 비거주자 신분으로 양도하였으므로 비과세 요건에 해당하지 않습니다[1][3][5]. --- ### 상세 설명 및 근거 - **1세대 1주택 비과세 요건:** 국내 거주자가 2년 이상 보유(조정대상지역은 2년 이상 거주까지)한 1주택을 양도할 때, 일정 금액(2024년 기준 12억 원) 이하 양도차익에 대해 비과세 혜택을 받을 수 있습니다. →",
                references: [1, 3, 5]
            },
            {
                id: 19,
                question: "비과세 여부 판단해줘 --- 1. 2021. 04. 07 매매취득 (취득가액 : 1,100,000,000) 2. 2023. 10. 20 매매양도 (양도가액 : 3,000,000,000) 3. 보유주택 : 2021. 05. 24. 분양권 취득 4. 기한후 신고함",
                answer: "답변: 질문하신 사례는 **2021.04.07에 주택을 매매로 취득**하고, **2023.10.20에 매매로 양도**한 경우입니다. 또한 **2021.05.24에 분양권을 따로 취득**하셨고, *기한후 신고*를 하셨다고 하셨습니다. 이 경우의 **비과세 여부**를 판단하려면 아래 사항을 단계별로 확인해야 합니다. --- ### 1. 1세대 1주택 비과세 요건 검토 - **1세대 1주택 비과세**는 '1세대가 국내에 1주택을 2년 이상 보유한 후 양도'해야 적용됩니다. - 하지만 *2021년 1월 1일 이후 분양권 취득* 시, 분양권도 주택 수에 포함됩니다[2]. - 즉, 2021.05.24에 취득한 분양권은 '주택 수 산정'에 포함되어, 주택을 양도할 때 **1세대 2주택**으로 보게 되어 비과세 요건을 충족하지 못합니다[2]. ### 2. 일시적 2주택 비과세 특례 적용 가능성 - 일시적 2주택 비과세 특례는 기존 주택을 보유한 상태에서 신규 주택(이 경우, 분양권 포함)을 취득한 뒤, 일정 기간 내 기존 주택을 양도하면 비과세가 가능합니다. - 하지만 **2021년 1월 1일 이후 분양권은 주택 수에 포함**되므로, 기존 주택 양도 시 분양권을 이미 보유하고 있으면 일반적인 1세대 1주택 비과세나 일시적 2주택 비과세 적용이 불가합니다[2]. #### 중요한 포인트 - **분양권 취득일 기준**이 청약 당첨일이 아니라 실제 취득일(이 경우 2021.05.24)로 적용됩니다. - 2021.04.07에 기존 주택을 취득하고, 2021.05.24에 분양권을 취득하였으므로, 주택 양도 시점(2023.10.20)에 1세대 2주택이 되어 비과세가 불가합니다[2]. ### 3. 실제 사례 예시 - **예시**: 2021년 4월에 주택 A를 11억에 취득 후, 2023년 10월에 30억에 양도. 동시에 2021년 5월에 분양권 B를 취득했다면, 주택 A 양도 시 1세대 2주택이므로 **비과세가 적용되지 않습니다**. ### 4. 기타 참고사항 - 2023년 10월 기준, 1세대 1주택 비과세를 받으려면 *양도 당시 다른 주택(분양권 포함)*을 보유하지 않아야 합니다[2][4]. - 매매차익에 대해 일반세율(6%~45%)로 양도소득세가 과세됩니다[1][3]. - 기한후 신고 시에는 가산세가 부과될 수 있으니, 신고 정확성에 유의해야 합니다[5]. --- **결론:** 질문하신 상황은 2021년 1월 1일 이후 분양권 취득으로 인해 주택 수가 2주택이 되어, **1세대 1주택 비과세가 적용되지 않습니다**. 양도차익에 대해 일반과세가 적용됩니다. 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3, 4, 5]
            },
            {
                id: 20,
                question: "상속받은 농지의 경우 5년 이내에 양도하게되면 비사업용토지에 해당하나요 ? 사업용토지에 해당하나요 ?",
                answer: "답변: 상속받은 농지를 5년 이내에 양도하는 경우, 일반적으로 **비사업용토지에 해당하지 않고, 사업용토지로 간주**됩니다. 즉, 상속개시일(상속이 개시된 날)로부터 5년 이내에 양도하면 양도소득세 계산 시 비사업용토지 중과세율이 적용되지 않습니다[2]. 조금 더 구체적으로 설명드리면, - 소득세법 시행령 제168조의8에 따라, **상속으로 취득한 농지는 상속개시일부터 5년 이내에 양도하는 경우에는 비사업용토지로 보지 않는다**는 규정이 있습니다[2]. - 예를 들어, 2020년에 부모님으로부터 농지를 상속받았다면, 2025년까지 양도할 경우에는 비사업용토지 중과세율(기본세율 + 10%p)이 적용되지 않고, 일반 사업용토지와 동일한 세율이 적용됩니다[2]. - 다만, 이 규정은 도시지역 내 주거·상업·공업지역 등에 해당하는 경우 등 일부 예외가 있을 수 있으며, 농지의 위치와 상속인의 자격(배우자, 직계존속 등)에 따라 달라질 수 있으므로 구체적인 상황별로 추가 확인이 필요합니다[1][3]. **참고 예시** - 2021년 3월에 어머니로부터 생산관리지역 농지를 상속받은 A씨가 2026년 2월에 해당 농지를 매도하는 경우, 5년 이내 양도이므로 사업용토지로 간주되어 중과세율이 적용되지 않습니다. 최신 세법 기준(2024년)에서도 이 원칙은 동일하게 적용되고 있습니다. 다만, 개별 사안에 따라 예외가 있을 수 있으니, 구체적인 농지 위치, 상속 경위 등을 반드시 전문가와 상담하시길 권해드립니다. 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3]
            },
            {
                id: 21,
                question: "수용감면 관련 질문입니다 수업인정 고시일 이전 4년이내에 취득한 토지를 수용당한 경우 해당 토지에 대한 양도세 신고시 수용감면이 적용되는지요 ? 또한 양도시 비사업용 토지에 해당하나요 ?",
                answer: "답변: 1. 수용감면 적용 여부사업인정고시일 이전 4년 이내에 취득한 토지가 수용되는 경우, 수용감면이 적용됩니다24. 현행 조세특례제한법 제77조에 따르면, 공익사업에 필요한 토지 등을 양도함으로써 발생하는 소득에 대해 양도소득세 감면을 받기 위한 핵심 요건은 사업인정고시일부터 소급하여 2년 이전에 취득한 토지여야 한다는 것입니다4. 질문하신 경우처럼 사업인정고시일 이전 4년 이내에 취득했다면, 이는 사업인정고시일로부터 2년 이전에 취득한 조건을 충족하므로 수용감면을 적용받을 수 있습니다2.2. 비사업용 토지 해당 여부해당 토지의 비사업용 토지 해당 여부는 토지의 실제 용도와 사용 실태에 따라 결정됩니다1. 일반적으로 경작사실이 없는 농지, 부재지주가 소유하는 임야, 사업목적으로 사용되지 않은 나대지 등은 비사업용 토지에 해당할 수 있습니다1. 하지만 공익사업을 위해 수용되는 토지로서 사업인정고시일부터 2년 이전에 취득한 경우에는 소득세법 시행령 제168조의14 제3항 제3호에 따라 비사업용 토지 중과 적용에서 제외됩니다3.3. 실무상 주의사항수용감면과 비사업용 토지 중과는 별개의 규정입니다. 수용감면을 받더라도 해당 토지가 비사업용 토지에 해당한다면 원칙적으로는 10% 중과세율이 적용될 수 있으나, 공익사업 수용의 경우에는 특별규정에 의해 비사업용 토지 중과가 배제됩니다35.4. 결론사업인정고시일 이전 4년 이내에 취득한 토지가 수용되는 경우:- 수용감면(조세특례제한법 제77조)이 적용됩니다- 토지 자체는 비사업용 토지에 해당할 수 있으나, 공익사업 수용 시에는 비사업용 토지 중과가 배제됩니다- 따라서 수용감면과 비사업용 토지 중과 배제를 모두 적용받을 수 있습니다",
                references: [2, 4]
            },
            {
                id: 22,
                question: "조정대상지역에서 취득한 주택을 양도하고자합니다. 1세대 1주택 비과세 요건이 무엇인가요 /",
                answer: "답변: 조정대상지역에서 취득한 주택을 양도할 때 **1세대 1주택 비과세 요건**은 다음과 같습니다. - **1세대가 국내에 1주택만을 소유하고 있을 것** - **주택 보유기간이 2년 이상일 것** - **조정대상지역 내 주택은 실거주(거주) 2년 이상 요건을 추가로 충족할 것** - **양도가액이 12억 원 이하일 것** (2025년 기준, 12억 초과분은 비과세가 아닌 과세 대상)[1][2][3] ### 단계별 상세 설명 1. **1세대 1주택 요건** - 본인과 배우자, 그리고 생계를 같이 하는 가족이 국내에 1주택만을 소유해야 합니다. - 일시적 2주택 등 일부 예외 상황을 제외하면, 하나의 주택만 보유한 상태여야 합니다[3]. 2. **보유기간 2년 이상** - 주택을 취득한 날로부터 양도일까지 **2년 이상 보유**해야 합니다. - 보유기간 산정은 등기부등본상 취득일과 양도일로 계산합니다[1][3]. 3. **조정대상지역 실거주 2년 요건** - **조정대상지역 내 주택은 단순 보유만으로 비과세가 되지 않습니다.** - 반드시 **실제 거주(전입신고 및 실제 거주)한 기간이 2년 이상**이어야 합니다. - 2017년 9월 19일 이후 취득한 주택은 이 요건이 엄격히 적용됩니다[2]. 4. **양도가액 기준(고가주택 기준)** - 2025년 현재, **12억 원 이하**의 주택에 한해 비과세가 적용됩니다. - 12억 원을 초과하는 경우, 초과분에 대해서는 양도소득세가 과세됩니다[1][5]. - 과거에는 9억 원 기준이었으나, 최근 12억 원으로 상향 조정되었습니다. ### 예시 - 2021년 10월에 **조정대상지역**에서 아파트를 구입하고, 2025년 12월에 양도하는 경우: - **보유기간 4년** → 요건 충족 - **실거주 기간 2년 이상** → 요건 충족해야 비과세 가능 - **양도가액 11억 원** → 12억 이하이므로 전액 비과세 - **양도가액 13억 원** → 12억 초과분(1억 원)에 대해 과세 ### 참고 - 혼인, 상속, 일시적 2주택 등 특례가 적용되는 경우도 있으나, 위는 가장 일반적인 기준입니다. - 세법은 매년 변경될 수 있으므로, 반드시 최신 내용을 확인해야 합니다[1][5]. 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3, 5]
            },
            {
                id: 23,
                question: "원조합원이 주택을 완공한 후 주택을 양도하고자 할때, 청산금 납부분 양도차익에 대해서 장기보유 특별공제의 보유기간은 언제부터 언제까지 적용되나요 ?",
                answer: "답변: 1. 청산금 납부분 양도차익의 장기보유특별공제 적용 기준청산금을 납부한 원조합원이 완공 후 신축주택을 양도하는 경우, 청산금 납부분에 해당하는 양도차익에 대해서는 기존 주택 취득일이 아닌 관리처분계획 인가일부터 신축주택 양도일까지의 기간을 보유기간으로 계산합니다2.이는 청산금 납부분이 관리처분계획 인가일 이후에 발생하는 이익으로 간주되기 때문입니다.## 2. 기존건물분 양도차익과의 차이점반면, 기존건물분 양도차익에 대해서는 기존건물 취득일부터 신축주택 양도일까지의 전 기간을 보유기간으로 적용합니다2. 구분장기보유특별공제 보유기간청산금 납부분 양도차익관리처분계획 인가일 ~ 신축주택 양도일기존건물분 양도차익기존건물 취득일 ~ 신축주택 양도일## 3. 실무 적용 사례예를 들어, 2015년에 기존 아파트를 취득하고, 2020년에 관리처분계획이 인가되어 청산금을 납부한 후, 2025년에 완공된 신축주택을 양도하는 경우:- 청산금 납부분: 2020년(관리처분계획 인가일) ~ 2025년(양도일) = 5년간 보유로 계산- 기존건물분: 2015년(취득일) ~ 2025년(양도일) = 10년간 보유로 계산## 4. 결론원조합원이 완공 후 신축주택을 양도할 때 청산금 납부분 양도차익에 대한 장기보유특별공제의 보유기간은 관리처분계획 인가일(권리변환일)부터 신축주택 양도일까지로 산정됩니다. 이는 기존 주택 취득일부터가 아닌, 실질적으로 청산금이 발생하는 시점인 관리처분계획 인가일부터 계산하는 것이 핵심입니다.",
                references: [2]
            },
            {
                id: 24,
                question: "부담부증여 증여세 신고시 해당 부동산을 임대차 평가특례로 평가하여 신고하였습니다. 이때 부담부 증여 양도세 계산시에 취득가액은 실지취득가액으로 해야 하나요 ? 기준시가로 해야 하나요 ?",
                answer: "답변: 1. 법령상 원칙: 평가방법의 일관성소득세법시행령 제159조 제1항에 따르면, 부담부증여에서 증여재산가액(양도가액)을 기준시가로 적용한 경우에는 부담부증여에 따른 취득가액도 반드시 기준시가를 적용해야 합니다2. 이는 평가방법의 일관성 유지 원칙에 따른 것으로, 양도가액과 취득가액의 평가 기준을 동일하게 적용하여 과세의 형평성을 보장하기 위함입니다.2. 임대차 평가특례 적용 시 주의사항임대차 평가특례는 기준시가 평가방법 중 하나입니다. 따라서 증여세 신고 시 임대차 평가특례를 적용했다면:- 증여재산가액: 임대차 평가특례에 의한 기준시가- 양도소득세 계산 시 취득가액: 증여자의 취득 당시 기준시가만약 취득가액을 실지취득가액으로 신고하면 양도소득세 부족징수 처분을 받을 수 있습니다2.3. 실무상 계산 방법구체적인 계산 과정은 다음과 같습니다:```양도차익 = 양도가액 - 취득가액 - 필요경비- 양도가액: 임대차 평가특례에 의한 증여재산가액 × (채무인수액 ÷ 증여재산가액)- 취득가액: 증여자의 취득 당시 기준시가 × (채무인수액 ÷ 증여재산가액)```예시 상황:- 부동산 시가: 10억 원 (임대차 평가특례 적용 시 8억 원)- 채무인수액: 4억 원- 증여자 실지취득가액: 3억 원- 증여자 취득 당시 기준시가: 2.5억 원올바른 계산:- 양도가액: 8억 원 × (4억 ÷ 8억) = 4억 원- 취득가액: 2.5억 원 × (4억 ÷ 8억) = 1.25억 원4. 최근 세법 개정사항2023년 이후 부담부증여 관련 세법이 강화되면서, 평가방법 불일치로 인한 부족징수 사례가 증가하고 있습니다2. 특히 임대차 평가특례를 적용한 경우 더욱 주의가 필요합니다.5. 결론부담부증여 시 증여세를 임대차 평가특례(기준시가)로 신고했다면, 양도소득세 계산 시 취득가액도 반드시 기준시가로 계산해야 합니다. 실지취득가액으로 계산하면 법령 위반으로 부족징수 처분을 받을 수 있으므로, 평가방법의 일관성을 반드시 유지해야 합니다.",
                references: [2]
            },
            {
                id: 25,
                question: "배우자에게 부동산을 증여받았습니다. 그 이후 3년 내 이혼하였고, 증여일이후 5년 내 부동산 양도시 이월과세가 적용되나요 ?",
                answer: "답변: 이혼으로 인해 배우자에게 부동산을 증여받았고, 그 후 3년 내 이혼하였으며 증여일 이후 5년 내 해당 부동산을 양도하는 경우, **이월과세 규정이 적용됩니다**. 즉, 양도소득세 계산 시 취득가액은 증여자의 원래 취득가액을 기준으로 하며, 증여받은 시점의 시가가 아니라는 점이 중요합니다[2][4]. ### 이월과세 적용 조건 및 절차 - **배우자 또는 직계존비속 간 증여**의 경우, 이월과세는 증여일로부터 10년(2022년 이전 증여는 5년) 이내 양도 시 적용됩니다[4]. - 부동산을 증여받은 뒤 5년(2022년 기준) 이내에 매도하면, 양도소득세 계산에서 취득가액은 증여자의 취득가액으로 계산합니다[2][4]. - 이월과세 적용시 이미 납부한 증여세는 양도소득세 계산 시 필요경비로 공제됩니다. ### 이혼 및 재산분할의 세금 처리 - **이혼으로 인한 재산분할**은 원칙적으로 증여세나 양도소득세가 과세되지 않습니다[1][3][5]. - 단, 이혼이 '형식적 이혼' 등 실질적으로 증여로 볼 수 있는 경우에는 증여세가 부과될 수 있습니다[1]. - 이혼 후 재산분할로 부동산을 받았다면, 해당 부동산을 양도할 때 취득가액은 부부가 처음 취득한 시점의 가액을 기준으로 하므로, 실질적으로 이월과세와 유사한 방식이 적용됩니다[1]. ### 실제 예시 - 만약 배우자에게 2022년에 아파트를 증여받았다가 2025년에 매도한다면, 증여 후 5년 이내이므로 이월과세가 적용되고, 양도소득세 계산 시 배우자의 취득가액이 적용됩니다. - 이혼 후 재산분할로 부동산을 받는 경우에도, 그 부동산을 양도할 때 취득가액 산정 방법은 증여 시와 동일하게 적용됩니다[1]. ### 참고 사항 - 이혼에 따른 재산분할로 부동산을 이전받는 경우, **취득세**는 납부해야 합니다(기본 3.5%, 감면 적용 시 1.5%)[3]. - 2023년부터는 증여 후 10년까지 이월과세 적용기간이 연장되었습니다. 2022년까지는 5년이 적용됩니다[2][4]. - 부동산 매도 전 반드시 최신 세법을 확인하시고, 전문가 상담을 권장합니다. 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3, 4, 5]
            },
            {
                id: 26,
                question: "배우자에게 부동산을 증여받았습니다. 그 이후 3년 내 사망하였고, 증여일이후 5년 내 부동산 양도시 이월과세가 적용되나요 ?",
                answer: "답변: 배우자로부터 부동산을 증여받은 후 3년 내에 증여자가 사망하였고, 그 부동산을 증여일 이후 5년 내에 양도하는 경우 **이월과세는 원칙적으로 적용되지 않습니다**. ### 핵심 설명 - **이월과세란** 배우자나 직계존비속으로부터 부동산을 증여받은 수증자가, 증여일로부터 5년(2023년 이후는 10년) 이내에 그 부동산을 양도할 때 양도차익을 계산할 때 취득가액을 증여자의 취득가액으로 보는 제도입니다[1][3][4]. - **단, 증여자가 사망한 경우에는 이월과세가 적용되지 않습니다.** 즉, 수증자가 부동산을 양도할 때 증여자가 이미 사망했다면 이월과세 규정은 배제됩니다. 이 규정은 국세청 예규(서면인터넷상담2팀-1336, 2007.05.03) 및 실무에서도 일관되게 적용되고 있습니다. ### 적용 예시 - 2025년 1월 1일에 배우자로부터 부동산을 증여받고, - 2028년 1월 1일(증여일로부터 3년 후)에 증여자가 사망, - 2029년 1월 1일(증여일로부터 4년 후, 사망 후 1년 내)에 해당 부동산을 양도한 경우, → **이월과세는 적용되지 않고, 수증자 본인의 증여일 기준 취득가액으로 양도차익을 계산합니다.** ### 참고: 이월과세가 적용되지 않는 사유 - 증여자가 사망한 경우 - 수증자가 증여받은 후 10년(2022년까지는 5년) 경과 후 양도하는 경우 - 기타 세법에서 정한 예외사유에 해당하는 경우[3] 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 3, 4]
            },
            {
                id: 27,
                question: "특수관계인에게 시가보다 약 20% 싸게 양도하려고합니다. 이때 양도가액은 시가인가요 ? 아니면 실지 거래된 가액인가요 ?",
                answer: "답변: 특수관계인에게 시가보다 약 20% 저가로 자산을 양도하는 경우, **양도가액은 시가와 실거래가 중 하나로 결정**됩니다. 다만, 시가와 실거래가의 차이가 일정 기준을 초과하는 경우에는 **시가를 양도가액으로 간주**합니다. **주요 기준은 다음과 같습니다:** - **시가와 실거래가의 차이가 시가의 5% 또는 3억 원 중 큰 금액을 초과**하는 경우, 양도소득세 계산 시 양도가액은",
                references: [1, 2, 3]
            },
            {
                id: 28,
                question: "신축주택 취득자에 대함 양도소득세 감면 질문입니다, 2012년에 계약금을 지급하고, 2013년에 잔듬을 지급하여 취득한 주택의 경우 신축주택 취득자에 대한 양도소득세 감면을 받을 수 있나요 ?",
                answer: "답변: 2012년에 계약금을 지급하고, 2013년에 잔금을 지급하여 취득한 주택이 **신축주택 취득자에 대한 양도소득세 감면** 대상이 되는지 여부는 \"신축주택 취득시기\"와 \"감면 대상 신축주택의 취득기간\" 규정에 따라 달라집니다. ### 1. 신축주택 취득자 감면제도의 적용 기간 - **주요 감면제도(예시: 조세특례제한법 제99조 등)**는 보통 \"특정 시기\"에 신축주택을 취득(매매계약 체결 및 계약금 지급)한 경우에 한해 적용합니다. - 대표적으로 2013년 한시적으로 시행된 감면의 경우, **2013.4.1 ~ 2013.12.31** 사이에 최초로 매매계약을 체결하고 계약금을 납부해야 감면 대상이 됐습니다[4]. ### 2. 취득시기의 판정 기준 - 취득시기는 통상 **최초 매매계약 체결일과 계약금 지급일**을 기준으로 판단합니다. - 즉, 계약금 지급일이 감면 대상 기간 내에 속해야 합니다[1][4]. ### 3. 귀하의 사례 적용 - **2012년에 계약금을 지급**했다면, 감면제도에서 요구하는 \"감면 대상 신축주택 취득기간(2013.4.1~2013.12.31)\"에 해당하지 않습니다[4]. - 잔금 지급일이 2013년이어도, 감면 적용 여부는 계약금 지급일 기준이므로 **감면을 받을 수 없습니다**. #### 예시로 이해하기 - **A씨**: 2013년 5월에 매매계약 체결 및 계약금 지급 → 감면 대상 - **B씨**: 2012년 12월에 계약금 지급, 2013년 5월에 잔금 지급 → 감면 대상 아님 ### 4. 기타 참고사항 - 분양권 매입 등은 별도 규정이 있으니, 만약 주택을 분양권으로 취득한 경우라면 추가 확인이 필요합니다[1]. - 해당 연도의 조세특례제한법 및 시행령의 세부 개정안을 반드시 확인해야 하며, 지역별 특례가 있을 수 있습니다. **결론:** 2012년에 계약금을 지급한 경우, 2013년 한시 감면 등 신축주택 취득자 양도소득세 감면 대상이 되지 않습니다. 실제 적용은 계약금 지급일을 기준으로 하므로, 감면이 어렵습니다[1][4]. 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 4]
            },
            {
                id: 29,
                question: "배우자에게 증여받은 후 양도시 생길수 있는 문제점 알려줘",
                answer: "답변: 배우자에게 증여받은 재산을 양도할 때 **이월과세, 부당행위 계산부인, 그리고 실제 절세 효과의 한계** 등 여러 문제점이 발생할 수 있습니다[1][2][4]. --- ### 1. **이월과세(증여 후 양도 시 세금 회피 방지 제도)** - 배우자에게 증여받은 재산을 곧바로 양도하면, 증여받은 배우자의 취득가액이 증여 당시의 시가로 인정되어 양도차익이 줄어들고 양도소득세 부담이 낮아집니다[1][2]. - 하지만 **정부는 부당하게 세부담을 줄이는 것을 방지하기 위해 '이월과세'를 적용**합니다. - 이월과세란, 증여받은 배우자가 5년 이내에 해당 재산을 매도할 경우, 취득가액을 증여자의 원래 취득가액(즉, 증여 전 취득가액)으로 계산하여 양도소득세를 산정하는 제도입니다[2][3]. - 즉, 증여받은 뒤 바로 매도하면 증여자의 취득가액으로 양도차익을 계산하므로 세금 부담을 낮출 수 없습니다. #### **사례 예시** - 남편이 2억원에 산 토지를 시가 6억원일 때 아내에게 증여한 후, 아내가 바로 또는 5년 이내에 매도하면 이월과세가 적용되어 남편의 2억원이 취득가액으로 인정됩니다. 4억원의 양도차익에 대해 양도세를 내야 합니다[3]. --- ### 2. **부당행위 계산부인** - 증여받은 배우자가 재산을 양도한 뒤, 매도대금이 다시 증여자에게 넘어가거나 실질적으로 증여자가 이익을 얻는 등의 부당행위가 있으면, **세무당국이 이를 '부당행위 계산부인'으로 판단해 절세 효과를 인정하지 않을 수 있습니다**[4]. - 즉, 절세를 목적으로 한 형식상 거래는 사후 검증에서 문제가 될 수 있습니다. --- ### 3. **절세 효과의 한계 및 실제 주의사항** - 배우자 증여 후 5년 이상 보유하다가 양도하면 이월과세가 적용되지 않아 증여 당시의 가액(시가)로 취득가액이 인정돼 양도차익이 줄고 양도세 부담이 대폭 낮아집니다[3]. - 하지만, 증여세 신고나 자금 출처, 매도 대금의 귀속 문제 등도 꼼꼼히 관리해야 하며, 실제로 절세가 이루어졌는지 사후 검증이 필요합니다[4]. --- ### 4. **증여세 및 양도세 관련 최신 정보** - 2025년 기준 배우자 증여재산공제 한도는 6억원입니다[1][3][5]. - 부동산, 주식 등 다양한 자산에 적용되며, 증여세 신고 및 양도세 신고 모두 반드시 정확히 해야 합니다. --- #### **요약** - 배우자에게 증여받은 뒤 바로 양도하면 이월과세로 인해 절세 효과가 없거나 오히려 문제가 될 수 있습니다. - 부당한 절세 목적의 거래는 부당행위 계산부인 규정에 걸릴 수 있습니다. - 5년 이상 보유 후 양도, 매도 대금의 실제 귀속, 증여세 신고 등 절차를 철저히 따라야 합니다. --- 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3, 4, 5]
            },
            {
                id: 30,
                question: "자녀세대 보유주택 a주택 : 2010. 5. 24. 매매취득 b주택 : 2024. 10. 25. 매매취득 부모세대 보유주택 (만 60세 이상) c 주택 : 2914. 11. 25. 합가후 2025.. 01. 12. a 주택 양도시 비과세가가능한지",
                answer: "답변: 질문하신 상황에서 **부모세대(만 60세 이상)와 자녀세대가 합가하여 1세대 2주택이 된 후 자녀 명의의 a주택(2010.5.24 취득)을 2025.1.12에 양도할 때 양도소득세 비과세가 가능한지**에 대해 안내드리겠습니다. --- ### 1. **동거봉양 합가 비과세 특례 요건** **동거봉양 합가 특례**는 다음의 요건을 충족할 때 적용됩니다[1][2][5]. - **자녀(1주택 소유자)가 만 60세 이상의 부모(1주택 소유)와 합가하여 1세대 2주택**이 된 경우 - **합가일로부터 10년 이내에 먼저 양도하는 주택**에 대해 1세대 1주택으로 간주하여 **비과세 적용** 가능 - **비과세 적용 주택은 12억 원 이하**(양도가액 기준)일 것 --- ### 2. **질문 상황에 맞춘 단계별 판정** 1. **합가 시점 및 요건 충족 여부** - 부모가 만 60세 이상이고, 각각 1주택을 보유한 상태에서 합가하였습니다. - 부모 주택 취득일이 2914년으로 표기되어 있으나, 아마도 오타로 2014년 또는 2019년이 맞을 것으로 추정됩니다(정확한 연도 확인 필요). - 합가 후 1세대 2주택이 된 상태입니다. 2. **양도 시기 및 적용 가능 범위** - a주택 양도일: 2025.1.12 - 합가일로부터 10년 이내에 해당 주택을 양도하는 경우이므로, **동거봉양 특례 적용 가능**합니다[1][2][5]. - 다만, **a주택의 양도가액이 12억 원 이하**일 경우에 한해 비과세가 가능합니다. --- ### 3. **실제 예시** 예를 들어, - 자녀가 a주택(1채), 부모가 c주택(1채)을 각각 보유 → 한 세대로 합가 → 2025년 1월 12일에 a주택 양도 - a주택 매매가가 12억 원 이하라면 **양도소득세 비과세** 적용받을 수 있습니다. --- ### 4. **유의사항 및 추가 팁** - **합가 요건**: 부모가 반드시 만 60세 이상이어야 하며, 합가의 목적이 동거봉양임을 입증해야 합니다. - **10년 이내 양도**: 합가일 기준 10년 경과 후 양도 시에는 특례 적용 불가합니다. - **양도순서**: 합가 후 먼저 양도하는 주택 1건에 한해 비과세 적용됩니다. - **가격 요건**: 12억 원 초과분은 과세 대상이 될 수 있으니 정확한 매매가 확인이 필요합니다. - **세대분리 여부**: 세대분리 및 합가 과정이 명확하게 인정되어야 하므로, 관련 서류와 증빙을 꼼꼼히 준비하세요. --- #### 추가 문의나 복잡한 사례가 있을 경우 반드시 전문가 상담을 권장합니다. 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 5]
            },
            {
                id: 31,
                question: "1세대 1주택 비과세 요건에 대해 알려주세요",
                answer: "답변: 1세대 1주택 비과세 요건은 다음과 같습니다: **1. 기본 요건** - 1세대가 1주택을 보유하고 있는 경우 - 해당 주택에 2년 이상 거주한 경우 - 양도가액이 12억원 이하인 경우 **2. 세대 구성원** - 배우자와 미혼자녀(만 20세 미만 또는 만 20세 이상이면서 학생인 경우) - 부모, 조부모, 손자녀 등 직계존비속 **3. 거주 요건** - 양도일 현재까지 2년 이상 거주 - 단, 해외체류, 병원입원 등 부득이한 사유로 인한 부재는 거주기간에 포함 **4. 양도가액 제한** - 양도가액이 12억원 이하 - 12억원 초과분에 대해서는 과세 **5. 주택 수 제한** - 1세대가 1주택만 보유하고 있어야 함 - 다른 주택을 보유하고 있다면 비과세 적용 불가 **6. 장기보유특별공제** - 보유기간에 따라 최대 40%까지 공제 가능 - 거주기간에 따라 추가로 최대 40%까지 공제 가능 - 합산 최대 80% **7. 신고 및 납부** - 양도일이 속하는 연도의 다음 연도 5월 31일까지 신고 - 세액은 신고와 동시에 납부 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3]
            },
            {
                id: 32,
                question: "양도소득세 계산 방법을 알려주세요",
                answer: "답변: 양도소득세 계산 방법은 다음과 같습니다: **1. 양도차익 계산** 양도차익 = 양도가액 - 취득가액 - 필요경비 **2. 과세표준 계산** 과세표준 = 양도차익 - 장기보유특별공제 - 기본공제(연 250만원) **3. 세율 적용** - 기본세율: 6%~45% (누진세율) - 비사업용 토지: 기본세율 + 10%p (중과세율) **4. 장기보유특별공제** - 보유기간: 연수 × 4% (최대 40%) - 거주기간: 연수 × 4% (최대 40%) - 합산 최대 80% **5. 세액 계산** 양도소득세 = 과세표준 × 세율 **6. 비과세 요건** - 1세대 1주택: 양도가액 12억원 이하 - 장기보유특별공제 적용 후 과세표준이 0원 이하인 경우 **7. 신고 및 납부** - 양도일이 속하는 연도의 다음 연도 5월 31일까지 신고 - 세액은 신고와 동시에 납부 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3]
            },
            {
                id: 33,
                question: "비과세 여부 판단해줘 --- 1. 2017년 1월 1일 건설임대주택 임대차 계약후 전세대원 거주시작 2. 5년거주후 2024년 8월 분양전환(조정대상지역임) 3. 2025년 7월 1일 양도",
                answer: "답변: 1. 건설임대주택 분양전환 후 양도 시 비과세 요건 분석해당 사례는 건설임대주택에서 분양전환된 주택의 양도로, 일반적인 1세대 1주택 비과세 요건과는 다른 특례 조항이 적용됩니다.임대차 계약 기간 중 거주기간 인정: 2017년 1월부터 5년간 전 세대원이 거주한 기간은 분양전환 후 거주기간으로 인정됩니다2. 이는 건설임대주택의 특성상 임차인이 실질적으로 거주하면서도 소유권은 없는 상황을 고려한 특례입니다.2. 비과세 요건 충족 여부 검토보유기간 요건: 분양전환일(2024년 8월)부터 양도일(2025년 7월)까지 약 11개월로, 일반적인 2년 보유 요건을 충족하지 못합니다.거주기간 요건: 조정대상지역의 경우 2년 이상 거주 요건이 필요하며, 임대차 계약 체결부터의 거주기간(5년)을 포함하여 충분히 충족합니다2.건설임대주택 분양전환 특례: 임대차 계약을 체결하고 5년 이상 전 세대원이 거주한 경우, 분양전환 후 1년 이상 보유하고 거주했으면 비과세 요건을 충족하는 것으로 해석됩니다.3. 결론현재 상황에서는 비과세 적용이 어려울 것으로 판단됩니다. 분양전환 후 보유기간이 약 11개월로 1년 미만이기 때문입니다.건설임대주택 분양전환 특례가 적용되더라도, 분양전환 후 최소 1년 이상의 보유기간이 필요한 것으로 보이며, 현재 약 11개월의 보유기간으로는 이 요건을 충족하지 못합니다.따라서 해당 주택의 양도 시에는 양도소득세가 과세될 가능성이 높으며, 정확한 세무처리를 위해서는 관할 세무서나 전문가와의 상담을 권장합니다.",
                references: [1, 2, 4]
            },
            {
                id: 34,
                question: "장기 임대주택을 양도할경우 비가세 디는 양도차익의 범위에 대해 알려줘 --- 2013년 10월 A 주택 거주 주택 취득 2016년 5월 B주택 장기임대주택취득 2019년 3월 A주택양도 2024년 5월 1일 장기임대주택양도",
                answer: "답변: 장기임대주택을 양도할 때 **비과세되는 양도차익의 범위**는 다음과 같습니다: **1. 장기임대주택 비과세 요건** - 장기임대주택은 5년 이상 임대한 후 양도 시 일정 범위의 양도차익에 대해 비과세 혜택을 받을 수 있습니다. - 비과세 범위는 일반적으로 **양도차익의 50%**까지 적용됩니다. **2. 귀하의 사례 분석** - 2016년 5월 장기임대주택 취득 - 2024년 5월 1일 양도 (약 8년 보유) - 5년 이상 임대 요건 충족 **3. 비과세 계산 방법** - 양도차익 = 양도가액 - 취득가액 - 필요경비 - 비과세 대상 = 양도차익 × 50% - 과세 대상 = 양도차익 × 50% **4. 예시 계산** - 취득가액: 3억원 - 양도가액: 5억원 - 양도차익: 2억원 - 비과세 대상: 1억원 (2억원 × 50%) - 과세 대상: 1억원 (2억원 × 50%) **5. 주의사항** - 임대 기간 동안 실제 임대 사실이 있어야 합니다. - 임대료 수입에 대한 소득세 신고가 필요합니다. - 장기임대주택 비과세는 1회에 한해 적용됩니다. 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 4]
            },
            {
                id: 35,
                question: "취득후 2년이내 양도를 한경우 15억 초과분에 대해 양도소득세 과세할때 세율을 알려줘",
                answer: "답변: 1. 2년 이내 단기 양도 중과세율취득 후 2년 이내에 양도하는 경우 단기 양도에 해당하여 중과세율이 적용됩니다13. 보유 기간에 따른 세율은 다음과 같습니다:- 1년 미만 보유: 70%- 1~2년 미만 보유: 60%따라서 취득 후 2년 이내 양도 시에는 60%의 세율이 적용됩니다1.2. 15억 초과분에 대한 적용 방식단기 양도 중과세는 양도차익 구간에 관계없이 전체 양도차익에 대해 일률적으로 적용됩니다. 즉, 15억 초과분뿐만 아니라 전체 양도차익에 대해 60% 세율이 적용됩니다1.일반적인 기본 세율(6%~45%의 누진세율)과 달리, 단기 양도 중과세는 양도차익 전체에 대해 동일한 세율이 적용되는 구조입니다.3. 단기 양도 중과세 배경 및 적용 시기이러한 단기 양도 중과세는 2020년 7월 10일 주택시장안정 보완대책에 따라 도입되었습니다3. 단기 양도차익 환수를 목적으로 하여:- 1년 미만: 40% → 70%로 인상- 2년 미만: 기본세율 → 60%로 인상4. 결론취득 후 2년 이내 양도한 경우 15억 초과분을 포함하여 전체 양도차익에 대해 60%의 세율이 적용됩니다. 이는 단기 투기 방지를 위한 중과세 조치로, 양도차익 구간별 누진세율이 아닌 일률 적용됩니다.",
                references: [1, 3]
            },
            {
                id: 36,
                question: "근데 왜 처음부터 말안해줫어",
                answer: "답변: Tax Agent는 n8n엔진을 기반으로 답변을 제공하는 Agent 입니다. Agent는 다소 실수가 있을 수 있습니다. 다시 질문해 주시면 성실하게 답변하겠습니다.",
                references: []
            },
            {
                id: 37,
                question: "양도소득세 배우자 및 직계존비속 이월과세 대상여부 판단해줘 --- 1. 2022년 5월 17일 증여 취득 (취득가액 : 25,216,480원) 2. 2024년 01월 10일 수용양도 (양도가액 : 30,449,110원) 3. 사업인정고시일(2020년 12월 28일)이전 2년 이후 증여로 취득 4. 증여자 2006 4월 1일 상속취득",
                answer: "답변: 1. 이월과세 기본 요건 분석배우자 및 직계존비속 이월과세는 증여받은 부동산을 증여일로부터 10년 이내(2022년 이전 증여는 5년 이내)에 양도하는 경우 적용됩니다13. 귀하의 사례를 살펴보면:- 증여일: 2022년 5월 17일 (2022년 이후 증여이므로 10년 규정 적용)- 양도일: 2024년 1월 10일 (증여일로부터 약 1년 8개월 후)- 기간: 10년 이내에 양도하므로 기본적으로 이월과세 적용 요건을 충족합니다2. 이월과세 예외사항 - 협의매수/수용 양도그러나 소득세법상 이월과세가 적용되지 않는 예외사항이 있습니다. 그 중 하나가 법률에 따라 협의매수 또는 수용에 의한 양도입니다1.귀하의 사례는:- 2024년 1월 10일 수용양도- 사업인정고시일: 2020년 12월 28일 (증여 이전)- 사업인정고시일 이전 2년 이후 증여로 취득이는 명백히 법률에 따른 수용에 의한 양도에 해당하므로 이월과세 예외사항에 적용됩니다.3. 이월과세 미적용 사유수용양도의 경우 이월과세가 적용되지 않는 이유는 다음과 같습니다:- 수용은 토지소유자의 의지와 관계없이 공익사업을 위해 강제적으로 이루어지는 것- 증여를 통한 양도소득세 회피 목적이 아닌 불가피한 양도- 공익사업 추진의 원활성을 위한 정책적 배려따라서 귀하의 경우 이월과세를 적용하지 않고 일반적인 양도소득세 계산방법을 적용합니다:- 취득가액: 25,216,480원 (증여받을 당시 가액)- 양도가액: 30,449,110원- 양도차익: 5,232,630원 (양도가액 - 취득가액)4. 결론귀하의 사례는 2022년 5월 17일 증여받은 부동산을 2024년 1월 10일에 수용으로 양도한 경우로, 증여일로부터 10년 이내 양도에 해당하여 기본적으로는 이월과세 적용 요건을 충족합니다. 그러나 법률에 따른 수용에 의한 양도는 이월과세 예외사항에 해당하므로, 이월과세를 적용하지 않고 일반적인 양도소득세 계산방법으로 신고하는 것이 올바릅니다",
                references: [1, 2, 4]
            },
            {
                id: 38,
                question: "양도소득세 비과세 여부 판단해줘 --- 1. 2017. 04. 11. 매매취득 (취득가액 : 500,000,000) 2. 2024. 03. 04. 매매양도 ( 양도가액 : 2,280,000,000) 3. 비거주자 - 2016년 12월부터 일본거주",
                answer: "답변: 질문하신 사례는 **비거주자가 국내 1주택을 양도하는 경우 양도소득세 비과세 적용 여부**에 대한 내용입니다. --- ### 핵심 답변 **비거주자는 1세대 1주택 양도소득세 비과세를 적용받을 수 없습니다.** 즉, 일본에 2016년 12월부터 거주하고 있고, 2024년 3월 4일에 양도한 경우 비거주자 신분으로 양도하였으므로 비과세 요건에 해당하지 않습니다[1][3][5]. --- ### 상세 설명 및 근거 - **1세대 1주택 비과세 요건:** 국내 거주자가 2년 이상 보유(조정대상지역은 2년 이상 거주까지)한 1주택을 양도할 때, 일정 금액(2024년 기준 12억 원) 이하 양도차익에 대해 비과세 혜택을 받을 수 있습니다. →",
                references: [1, 3, 5]
            },
            {
                id: 39,
                question: "비과세 여부 판단해줘 --- 1. 2021. 04. 07 매매취득 (취득가액 : 1,100,000,000) 2. 2023. 10. 20 매매양도 (양도가액 : 3,000,000,000) 3. 보유주택 : 2021. 05. 24. 분양권 취득 4. 기한후 신고함",
                answer: "답변: 질문하신 사례는 **2021.04.07에 주택을 매매로 취득**하고, **2023.10.20에 매매로 양도**한 경우입니다. 또한 **2021.05.24에 분양권을 따로 취득**하셨고, *기한후 신고*를 하셨다고 하셨습니다. 이 경우의 **비과세 여부**를 판단하려면 아래 사항을 단계별로 확인해야 합니다. --- ### 1. 1세대 1주택 비과세 요건 검토 - **1세대 1주택 비과세**는 '1세대가 국내에 1주택을 2년 이상 보유한 후 양도'해야 적용됩니다. - 하지만 *2021년 1월 1일 이후 분양권 취득* 시, 분양권도 주택 수에 포함됩니다[2]. - 즉, 2021.05.24에 취득한 분양권은 '주택 수 산정'에 포함되어, 주택을 양도할 때 **1세대 2주택**으로 보게 되어 비과세 요건을 충족하지 못합니다[2]. ### 2. 일시적 2주택 비과세 특례 적용 가능성 - 일시적 2주택 비과세 특례는 기존 주택을 보유한 상태에서 신규 주택(이 경우, 분양권 포함)을 취득한 뒤, 일정 기간 내 기존 주택을 양도하면 비과세가 가능합니다. - 하지만 **2021년 1월 1일 이후 분양권은 주택 수에 포함**되므로, 기존 주택 양도 시 분양권을 이미 보유하고 있으면 일반적인 1세대 1주택 비과세나 일시적 2주택 비과세 적용이 불가합니다[2]. #### 중요한 포인트 - **분양권 취득일 기준**이 청약 당첨일이 아니라 실제 취득일(이 경우 2021.05.24)로 적용됩니다. - 2021.04.07에 기존 주택을 취득하고, 2021.05.24에 분양권을 취득하였으므로, 주택 양도 시점(2023.10.20)에 1세대 2주택이 되어 비과세가 불가합니다[2]. ### 3. 실제 사례 예시 - **예시**: 2021년 4월에 주택 A를 11억에 취득 후, 2023년 10월에 30억에 양도. 동시에 2021년 5월에 분양권 B를 취득했다면, 주택 A 양도 시 1세대 2주택이므로 **비과세가 적용되지 않습니다**. ### 4. 기타 참고사항 - 2023년 10월 기준, 1세대 1주택 비과세를 받으려면 *양도 당시 다른 주택(분양권 포함)*을 보유하지 않아야 합니다[2][4]. - 매매차익에 대해 일반세율(6%~45%)로 양도소득세가 과세됩니다[1][3]. - 기한후 신고 시에는 가산세가 부과될 수 있으니, 신고 정확성에 유의해야 합니다[5]. --- **결론:** 질문하신 상황은 2021년 1월 1일 이후 분양권 취득으로 인해 주택 수가 2주택이 되어, **1세대 1주택 비과세가 적용되지 않습니다**. 양도차익에 대해 일반과세가 적용됩니다. 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3, 4, 5]
            },
            {
                id: 40,
                question: "상속받은 농지를 5년 이내에 양도하게되면 비사업용토지에 해당하나요 ? 사업용토지에 해당하나요 ?",
                answer: "답변: 상속받은 농지를 5년 이내에 양도하는 경우, 일반적으로 **비사업용토지에 해당하지 않고, 사업용토지로 간주**됩니다. 즉, 상속개시일(상속이 개시된 날)로부터 5년 이내에 양도하면 양도소득세 계산 시 비사업용토지 중과세율이 적용되지 않습니다[2]. 조금 더 구체적으로 설명드리면, - 소득세법 시행령 제168조의8에 따라, **상속으로 취득한 농지는 상속개시일부터 5년 이내에 양도하는 경우에는 비사업용토지로 보지 않는다**는 규정이 있습니다[2]. - 예를 들어, 2020년에 부모님으로부터 농지를 상속받았다면, 2025년까지 양도할 경우에는 비사업용토지 중과세율(기본세율 + 10%p)이 적용되지 않고, 일반 사업용토지와 동일한 세율이 적용됩니다[2]. - 다만, 이 규정은 도시지역 내 주거·상업·공업지역 등에 해당하는 경우 등 일부 예외가 있을 수 있으며, 농지의 위치와 상속인의 자격(배우자, 직계존속 등)에 따라 달라질 수 있으므로 구체적인 상황별로 추가 확인이 필요합니다[1][3]. **참고 예시** - 2021년 3월에 어머니로부터 생산관리지역 농지를 상속받은 A씨가 2026년 2월에 해당 농지를 매도하는 경우, 5년 이내 양도이므로 사업용토지로 간주되어 중과세율이 적용되지 않습니다. 최신 세법 기준(2024년)에서도 이 원칙은 동일하게 적용되고 있습니다. 다만, 개별 사안에 따라 예외가 있을 수 있으니, 구체적인 농지 위치, 상속 경위 등을 반드시 전문가와 상담하시길 권해드립니다. 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3]
            },
            {
                id: 41,
                question: "수용감면 관련 질문입니다 수업인정 고시일 이전 4년이내에 취득한 토지를 수용당한 경우 해당 토지에 대한 양도세 신고시 수용감면이 적용되는지요 ? 또한 양도시 비사업용 토지에 해당하나요 ?",
                answer: "답변: 1. 수용감면 적용 여부사업인정고시일 이전 4년 이내에 취득한 토지가 수용되는 경우, 수용감면이 적용됩니다24. 현행 조세특례제한법 제77조에 따르면, 공익사업에 필요한 토지 등을 양도함으로써 발생하는 소득에 대해 양도소득세 감면을 받기 위한 핵심 요건은 사업인정고시일부터 소급하여 2년 이전에 취득한 토지여야 한다는 것입니다4. 질문하신 경우처럼 사업인정고시일 이전 4년 이내에 취득했다면, 이는 사업인정고시일로부터 2년 이전에 취득한 조건을 충족하므로 수용감면을 적용받을 수 있습니다2.2. 비사업용 토지 해당 여부해당 토지의 비사업용 토지 해당 여부는 토지의 실제 용도와 사용 실태에 따라 결정됩니다1. 일반적으로 경작사실이 없는 농지, 부재지주가 소유하는 임야, 사업목적으로 사용되지 않은 나대지 등은 비사업용 토지에 해당할 수 있습니다1. 하지만 공익사업을 위해 수용되는 토지로서 사업인정고시일부터 2년 이전에 취득한 경우에는 소득세법 시행령 제168조의14 제3항 제3호에 따라 비사업용 토지 중과 적용에서 제외됩니다3.3. 실무상 주의사항수용감면과 비사업용 토지 중과는 별개의 규정입니다. 수용감면을 받더라도 해당 토지가 비사업용 토지에 해당한다면 원칙적으로는 10% 중과세율이 적용될 수 있으나, 공익사업 수용의 경우에는 특별규정에 의해 비사업용 토지 중과가 배제됩니다35.4. 결론사업인정고시일 이전 4년 이내에 취득한 토지가 수용되는 경우:- 수용감면(조세특례제한법 제77조)이 적용됩니다- 토지 자체는 비사업용 토지에 해당할 수 있으나, 공익사업 수용 시에는 비사업용 토지 중과가 배제됩니다- 따라서 수용감면과 비사업용 토지 중과 배제를 모두 적용받을 수 있습니다",
                references: [2, 4]
            },
            {
                id: 42,
                question: "조정대상지역에서 취득한 주택을 양도하고자합니다. 1세대 1주택 비과세 요건이 무엇인가요 /",
                answer: "답변: 조정대상지역에서 취득한 주택을 양도할 때 **1세대 1주택 비과세 요건**은 다음과 같습니다. - **1세대가 국내에 1주택만을 소유하고 있을 것** - **주택 보유기간이 2년 이상일 것** - **조정대상지역 내 주택은 실거주(거주) 2년 이상 요건을 추가로 충족할 것** - **양도가액이 12억 원 이하일 것** (2025년 기준, 12억 초과분은 비과세가 아닌 과세 대상)[1][2][3] ### 단계별 상세 설명 1. **1세대 1주택 요건** - 본인과 배우자, 그리고 생계를 같이 하는 가족이 국내에 1주택만을 소유해야 합니다. - 일시적 2주택 등 일부 예외 상황을 제외하면, 하나의 주택만 보유한 상태여야 합니다[3]. 2. **보유기간 2년 이상** - 주택을 취득한 날로부터 양도일까지 **2년 이상 보유**해야 합니다. - 보유기간 산정은 등기부등본상 취득일과 양도일로 계산합니다[1][3]. 3. **조정대상지역 실거주 2년 요건** - **조정대상지역 내 주택은 단순 보유만으로 비과세가 되지 않습니다.** - 반드시 **실제 거주(전입신고 및 실제 거주)한 기간이 2년 이상**이어야 합니다. - 2017년 9월 19일 이후 취득한 주택은 이 요건이 엄격히 적용됩니다[2]. 4. **양도가액 기준(고가주택 기준)** - 2025년 현재, **12억 원 이하**의 주택에 한해 비과세가 적용됩니다. - 12억 원을 초과하는 경우, 초과분에 대해서는 양도소득세가 과세됩니다[1][5]. - 과거에는 9억 원 기준이었으나, 최근 12억 원으로 상향 조정되었습니다. ### 예시 - 2021년 10월에 **조정대상지역**에서 아파트를 구입하고, 2025년 12월에 양도하는 경우: - **보유기간 4년** → 요건 충족 - **실거주 기간 2년 이상** → 요건 충족해야 비과세 가능 - **양도가액 11억 원** → 12억 이하이므로 전액 비과세 - **양도가액 13억 원** → 12억 초과분(1억 원)에 대해 과세 ### 참고 - 혼인, 상속, 일시적 2주택 등 특례가 적용되는 경우도 있으나, 위는 가장 일반적인 기준입니다. - 세법은 매년 변경될 수 있으므로, 반드시 최신 내용을 확인해야 합니다[1][5]. 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3, 5]
            },
            {
                id: 43,
                question: "원조합원이 주택을 완공한 후 주택을 양도하고자 할때, 청산금 납부분 양도차익에 대해서 장기보유 특별공제의 보유기간은 언제부터 언제까지 적용되나요 ?",
                answer: "답변: 1. 청산금 납부분 양도차익의 장기보유특별공제 적용 기준청산금을 납부한 원조합원이 완공 후 신축주택을 양도하는 경우, 청산금 납부분에 해당하는 양도차익에 대해서는 기존 주택 취득일이 아닌 관리처분계획 인가일부터 신축주택 양도일까지의 기간을 보유기간으로 계산합니다2.이는 청산금 납부분이 관리처분계획 인가일 이후에 발생하는 이익으로 간주되기 때문입니다.## 2. 기존건물분 양도차익과의 차이점반면, 기존건물분 양도차익에 대해서는 기존건물 취득일부터 신축주택 양도일까지의 전 기간을 보유기간으로 적용합니다2. 구분장기보유특별공제 보유기간청산금 납부분 양도차익관리처분계획 인가일 ~ 신축주택 양도일기존건물분 양도차익기존건물 취득일 ~ 신축주택 양도일## 3. 실무 적용 사례예를 들어, 2015년에 기존 아파트를 취득하고, 2020년에 관리처분계획이 인가되어 청산금을 납부한 후, 2025년에 완공된 신축주택을 양도하는 경우:- 청산금 납부분: 2020년(관리처분계획 인가일) ~ 2025년(양도일) = 5년간 보유로 계산- 기존건물분: 2015년(취득일) ~ 2025년(양도일) = 10년간 보유로 계산## 4. 결론원조합원이 완공 후 신축주택을 양도할 때 청산금 납부분 양도차익에 대한 장기보유특별공제의 보유기간은 관리처분계획 인가일(권리변환일)부터 신축주택 양도일까지로 산정됩니다. 이는 기존 주택 취득일부터가 아닌, 실질적으로 청산금이 발생하는 시점인 관리처분계획 인가일부터 계산하는 것이 핵심입니다.",
                references: [2]
            },
            {
                id: 44,
                question: "부담부증여 증여세 신고시 해당 부동산을 임대차 평가특례로 평가하여 신고하였습니다. 이때 부담부 증여 양도세 계산시에 취득가액은 실지취득가액으로 해야 하나요 ? 기준시가로 해야 하나요 ?",
                answer: "답변: 1. 법령상 원칙: 평가방법의 일관성소득세법시행령 제159조 제1항에 따르면, 부담부증여에서 증여재산가액(양도가액)을 기준시가로 적용한 경우에는 부담부증여에 따른 취득가액도 반드시 기준시가를 적용해야 합니다2. 이는 평가방법의 일관성 유지 원칙에 따른 것으로, 양도가액과 취득가액의 평가 기준을 동일하게 적용하여 과세의 형평성을 보장하기 위함입니다.2. 임대차 평가특례 적용 시 주의사항임대차 평가특례는 기준시가 평가방법 중 하나입니다. 따라서 증여세 신고 시 임대차 평가특례를 적용했다면:- 증여재산가액: 임대차 평가특례에 의한 기준시가- 양도소득세 계산 시 취득가액: 증여자의 취득 당시 기준시가만약 취득가액을 실지취득가액으로 신고하면 양도소득세 부족징수 처분을 받을 수 있습니다2.3. 실무상 계산 방법구체적인 계산 과정은 다음과 같습니다:```양도차익 = 양도가액 - 취득가액 - 필요경비- 양도가액: 임대차 평가특례에 의한 증여재산가액 × (채무인수액 ÷ 증여재산가액)- 취득가액: 증여자의 취득 당시 기준시가 × (채무인수액 ÷ 증여재산가액)```예시 상황:- 부동산 시가: 10억 원 (임대차 평가특례 적용 시 8억 원)- 채무인수액: 4억 원- 증여자 실지취득가액: 3억 원- 증여자 취득 당시 기준시가: 2.5억 원올바른 계산:- 양도가액: 8억 원 × (4억 ÷ 8억) = 4억 원- 취득가액: 2.5억 원 × (4억 ÷ 8억) = 1.25억 원4. 최근 세법 개정사항2023년 이후 부담부증여 관련 세법이 강화되면서, 평가방법 불일치로 인한 부족징수 사례가 증가하고 있습니다2. 특히 임대차 평가특례를 적용한 경우 더욱 주의가 필요합니다.5. 결론부담부증여 시 증여세를 임대차 평가특례(기준시가)로 신고했다면, 양도소득세 계산 시 취득가액도 반드시 기준시가로 계산해야 합니다. 실지취득가액으로 계산하면 법령 위반으로 부족징수 처분을 받을 수 있으므로, 평가방법의 일관성을 반드시 유지해야 합니다.",
                references: [2]
            },
            {
                id: 45,
                question: "배우자에게 부동산을 증여받았습니다. 그 이후 3년 내 이혼하였고, 증여일이후 5년 내 부동산 양도시 이월과세가 적용되나요 ?",
                answer: "답변: 이혼으로 인해 배우자에게 부동산을 증여받았고, 그 후 3년 내 이혼하였으며 증여일 이후 5년 내 해당 부동산을 양도하는 경우, **이월과세 규정이 적용됩니다**. 즉, 양도소득세 계산 시 취득가액은 증여자의 원래 취득가액을 기준으로 하며, 증여받은 시점의 시가가 아니라는 점이 중요합니다[2][4]. ### 이월과세 적용 조건 및 절차 - **배우자 또는 직계존비속 간 증여**의 경우, 이월과세는 증여일로부터 10년(2022년 이전 증여는 5년) 이내 양도 시 적용됩니다[4]. - 부동산을 증여받은 뒤 5년(2022년 기준) 이내에 매도하면, 양도소득세 계산에서 취득가액은 증여자의 취득가액으로 계산합니다[2][4]. - 이월과세 적용시 이미 납부한 증여세는 양도소득세 계산 시 필요경비로 공제됩니다. ### 이혼 및 재산분할의 세금 처리 - **이혼으로 인한 재산분할**은 원칙적으로 증여세나 양도소득세가 과세되지 않습니다[1][3][5]. - 단, 이혼이 '형식적 이혼' 등 실질적으로 증여로 볼 수 있는 경우에는 증여세가 부과될 수 있습니다[1]. - 이혼 후 재산분할로 부동산을 받았다면, 해당 부동산을 양도할 때 취득가액은 부부가 처음 취득한 시점의 가액을 기준으로 하므로, 실질적으로 이월과세와 유사한 방식이 적용됩니다[1]. ### 실제 예시 - 만약 배우자에게 2022년에 아파트를 증여받았다가 2025년에 매도한다면, 증여 후 5년 이내이므로 이월과세가 적용되고, 양도소득세 계산 시 배우자의 취득가액이 적용됩니다. - 이혼 후 재산분할로 부동산을 받는 경우에도, 그 부동산을 양도할 때 취득가액 산정 방법은 증여 시와 동일하게 적용됩니다[1]. ### 참고 사항 - 이혼에 따른 재산분할로 부동산을 이전받는 경우, **취득세**는 납부해야 합니다(기본 3.5%, 감면 적용 시 1.5%)[3]. - 2023년부터는 증여 후 10년까지 이월과세 적용기간이 연장되었습니다. 2022년까지는 5년이 적용됩니다[2][4]. - 부동산 매도 전 반드시 최신 세법을 확인하시고, 전문가 상담을 권장합니다. 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3, 4, 5]
            },
            {
                id: 46,
                question: "양도소득세 계산 방법을 알려주세요",
                answer: "답변: 양도소득세 계산 방법은 다음과 같습니다: **1. 양도차익 계산** 양도차익 = 양도가액 - 취득가액 - 필요경비 **2. 과세표준 계산** 과세표준 = 양도차익 - 장기보유특별공제 - 기본공제(연 250만원) **3. 세율 적용** - 기본세율: 6%~45% (누진세율) - 비사업용 토지: 기본세율 + 10%p (중과세율) **4. 장기보유특별공제** - 보유기간: 연수 × 4% (최대 40%) - 거주기간: 연수 × 4% (최대 40%) - 합산 최대 80% **5. 세액 계산** 양도소득세 = 과세표준 × 세율 **6. 비과세 요건** - 1세대 1주택: 양도가액 12억원 이하 - 장기보유특별공제 적용 후 과세표준이 0원 이하인 경우 **7. 신고 및 납부** - 양도일이 속하는 연도의 다음 연도 5월 31일까지 신고 - 세액은 신고와 동시에 납부 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3]
            },
            {
                id: 47,
                question: "1세대 1주택 비과세 요건에 대해 알려주세요",
                answer: "답변: 1세대 1주택 비과세 요건은 다음과 같습니다: **1. 기본 요건** - 1세대가 1주택을 보유하고 있는 경우 - 해당 주택에 2년 이상 거주한 경우 - 양도가액이 12억원 이하인 경우 **2. 세대 구성원** - 배우자와 미혼자녀(만 20세 미만 또는 만 20세 이상이면서 학생인 경우) - 부모, 조부모, 손자녀 등 직계존비속 **3. 거주 요건** - 양도일 현재까지 2년 이상 거주 - 단, 해외체류, 병원입원 등 부득이한 사유로 인한 부재는 거주기간에 포함 **4. 양도가액 제한** - 양도가액이 12억원 이하 - 12억원 초과분에 대해서는 과세 **5. 주택 수 제한** - 1세대가 1주택만 보유하고 있어야 함 - 다른 주택을 보유하고 있다면 비과세 적용 불가 **6. 장기보유특별공제** - 보유기간에 따라 최대 40%까지 공제 가능 - 거주기간에 따라 추가로 최대 40%까지 공제 가능 - 합산 최대 80% **7. 신고 및 납부** - 양도일이 속하는 연도의 다음 연도 5월 31일까지 신고 - 세액은 신고와 동시에 납부 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3]
            },
            {
                id: 48,
                question: "양도소득세 신고 기한은 언제인가요?",
                answer: "답변: 양도소득세 신고 기한은 다음과 같습니다: **1. 일반적인 신고 기한** - 양도일이 속하는 연도의 다음 연도 5월 31일까지 신고 - 예: 2024년에 양도한 경우 → 2025년 5월 31일까지 신고 **2. 신고 방법** - 전자신고: 홈택스(www.hometax.go.kr)를 통한 전자신고 - 서면신고: 관할 세무서에 직접 제출 **3. 신고와 동시에 납부** - 양도소득세는 신고와 동시에 납부해야 합니다 - 신고만 하고 납부하지 않으면 가산세가 부과됩니다 **4. 기한 후 신고** - 기한 후 신고 시 가산세가 부과됩니다 - 가산세율: 신고기한 경과일수에 따라 차등 적용 **5. 특별한 경우** - 상속으로 인한 양도: 상속개시일로부터 6개월 이내 - 기타 특례: 관련 법령에 따라 별도 기한이 정해질 수 있습니다 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3]
            },
            {
                id: 49,
                question: "양도소득세 세율은 어떻게 되나요?",
                answer: "답변: 양도소득세 세율은 다음과 같습니다: **1. 기본세율 (누진세율)** - 1,200만원 이하: 6% - 1,200만원 초과 ~ 4,600만원 이하: 15% - 4,600만원 초과 ~ 8,800만원 이하: 24% - 8,800만원 초과 ~ 1.5억원 이하: 35% - 1.5억원 초과 ~ 3억원 이하: 38% - 3억원 초과 ~ 5억원 이하: 40% - 5억원 초과: 42% **2. 비사업용 토지 중과세율** - 기본세율 + 10%p 추가 적용 - 예: 기본세율 35%인 경우 → 45% 적용 **3. 단기 양도 중과세율** - 1년 미만 보유: 70% - 1~2년 미만 보유: 60% **4. 장기보유특별공제** - 보유기간: 연수 × 4% (최대 40%) - 거주기간: 연수 × 4% (최대 40%) - 합산 최대 80% **5. 비과세 요건** - 1세대 1주택: 양도가액 12억원 이하 - 장기보유특별공제 적용 후 과세표준이 0원 이하인 경우 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3]
            },
            {
                id: 50,
                question: "양도소득세 장기보유특별공제는 어떻게 계산하나요?",
                answer: "답변: 양도소득세 장기보유특별공제는 다음과 같이 계산합니다: **1. 보유기간 공제** - 보유 연수 × 4% (최대 40%) - 예: 10년 보유 시 → 10년 × 4% = 40% **2. 거주기간 공제** - 거주 연수 × 4% (최대 40%) - 예: 8년 거주 시 → 8년 × 4% = 32% **3. 합산 공제** - 보유기간 공제 + 거주기간 공제 = 최대 80% - 예: 보유 40% + 거주 32% = 72% **4. 계산 예시** - 양도차익: 1억원 - 보유기간: 10년 (40% 공제) - 거주기간: 8년 (32% 공제) - 총 공제율: 72% - 과세표준: 1억원 × (1 - 0.72) = 2,800만원 **5. 주의사항** - 보유기간과 거주기간은 별도로 계산됩니다 - 해외체류 등 부득이한 사유로 인한 부재는 거주기간에 포함됩니다 - 조정대상지역은 실거주 요건이 추가로 필요합니다 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3]
            },
            {
                id: 51,
                question: "양도소득세 비과세 요건은 무엇인가요?",
                answer: "답변: 양도소득세 비과세 요건은 다음과 같습니다: **1. 1세대 1주택 비과세** - 1세대가 1주택을 보유하고 있는 경우 - 해당 주택에 2년 이상 거주한 경우 - 양도가액이 12억원 이하인 경우 **2. 장기보유특별공제 적용 후 과세표준이 0원 이하** - 보유기간과 거주기간에 따른 공제율 적용 후 - 과세표준이 0원 이하가 되는 경우 **3. 상속으로 인한 양도** - 상속으로 인한 양도는 원칙적으로 비과세 - 단, 상속세 납부 후 5년 이내 양도 시에는 과세될 수 있음 **4. 공익사업을 위한 수용** - 공익사업을 위해 수용되는 경우 - 수용감면 규정에 따라 비과세 적용 **5. 기타 특례** - 농지의 농업경영을 위한 양도 - 장기임대주택의 일정 범위 비과세 - 기타 세법에서 정한 특례사항 **6. 주의사항** - 비과세 요건을 충족하더라도 신고는 필요합니다 - 각 요건의 세부 조건을 정확히 확인해야 합니다 - 세법 개정에 따라 요건이 변경될 수 있습니다 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3]
            },
            {
                id: 52,
                question: "양도소득세 신고 방법은 어떻게 되나요?",
                answer: "답변: 양도소득세 신고 방법은 다음과 같습니다: **1. 전자신고 (권장)** - 홈택스(www.hometax.go.kr)를 통한 전자신고 - 간편신고 또는 종합신고 선택 가능 - 신고와 동시에 납부 가능 **2. 서면신고** - 관할 세무서에 직접 제출 - 신고서 작성 후 제출 - 납부는 별도로 진행 **3. 신고서 종류** - 양도소득세 신고서 - 양도소득세 계산명세서 - 기타 첨부서류 **4. 필요한 서류** - 등기부등본 - 매매계약서 - 취득 관련 서류 - 필요경비 증빙서류 **5. 신고 절차** 1) 신고서 작성 2) 첨부서류 준비 3) 신고서 제출 4) 세액 납부 **6. 주의사항** - 신고 기한: 양도일이 속하는 연도의 다음 연도 5월 31일까지 - 신고와 동시에 납부해야 합니다 - 정확한 서류 준비가 중요합니다 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3]
            },
            {
                id: 53,
                question: "양도소득세 가산세는 어떻게 되나요?",
                answer: "답변: 양도소득세 가산세는 다음과 같습니다: **1. 기한 후 신고 가산세** - 신고기한 경과일수에 따라 차등 적용 - 1개월 이내: 3% - 1개월 초과 ~ 2개월 이내: 6% - 2개월 초과 ~ 3개월 이내: 9% - 3개월 초과: 12% **2. 기한 후 납부 가산세** - 납부기한 경과일수에 따라 차등 적용 - 1개월 이내: 3% - 1개월 초과 ~ 2개월 이내: 6% - 2개월 초과 ~ 3개월 이내: 9% - 3개월 초과: 12% **3. 부족세액 가산세** - 신고세액이 실제 세액보다 적은 경우 - 부족세액의 10% **4. 무신고 가산세** - 신고하지 않은 경우 - 세액의 20% **5. 주의사항** - 가산세는 원세액에 추가로 부과됩니다 - 정확한 신고와 납부가 중요합니다 - 가산세 감경 사유가 있는 경우 신청 가능합니다 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3]
            },
            {
                id: 54,
                question: "양도소득세 필요경비는 무엇인가요?",
                answer: "답변: 양도소득세 필요경비는 다음과 같습니다: **1. 취득 관련 비용** - 취득세 - 등록세 - 중개수수료 - 인지대 - 기타 취득 관련 비용 **2. 양도 관련 비용** - 중개수수료 - 등록세 - 인지대 - 양도 관련 기타 비용 **3. 보유 중 발생한 비용** - 재산세 - 종합부동산세 - 관리비 - 수선비 - 기타 보유 관련 비용 **4. 증여세 (부담부증여의 경우)** - 부담부증여로 인해 납부한 증여세 **5. 주의사항** - 실제 지출한 비용만 인정됩니다 - 증빙서류가 필요합니다 - 과세기간 중 발생한 비용만 인정됩니다 **6. 계산 방법** - 양도차익 = 양도가액 - 취득가액 - 필요경비 - 필요경비는 양도차익 계산 시 공제됩니다 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3]
            },
            {
                id: 55,
                question: "양도소득세 기본공제는 어떻게 되나요?",
                answer: "답변: 양도소득세 기본공제는 다음과 같습니다: **1. 기본공제 금액** - 연 250만원 **2. 적용 방법** - 과세표준에서 공제 - 과세표준 = 양도차익 - 장기보유특별공제 - 기본공제 **3. 계산 예시** - 양도차익: 1,000만원 - 장기보유특별공제: 200만원 - 기본공제: 250만원 - 과세표준: 1,000만원 - 200만원 - 250만원 = 550만원 **4. 주의사항** - 기본공제는 모든 양도소득에 적용됩니다 - 연간 250만원으로 제한됩니다 - 장기보유특별공제 적용 후 공제됩니다 **5. 기타 공제** - 기본공제 외에도 장기보유특별공제 등이 있습니다 - 각 공제의 요건을 정확히 확인해야 합니다 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3]
            },
            {
                id: 56,
                question: "양도소득세 비과세 요건에 대해 알려주세요",
                answer: "답변: 양도소득세 비과세 요건은 다음과 같습니다: **1. 1세대 1주택 비과세** - 1세대가 1주택을 보유하고 있는 경우 - 해당 주택에 2년 이상 거주한 경우 - 양도가액이 12억원 이하인 경우 **2. 장기보유특별공제 적용 후 과세표준이 0원 이하** - 보유기간과 거주기간에 따른 공제율 적용 후 - 과세표준이 0원 이하가 되는 경우 **3. 상속으로 인한 양도** - 상속으로 인한 양도는 원칙적으로 비과세 - 단, 상속세 납부 후 5년 이내 양도 시에는 과세될 수 있음 **4. 공익사업을 위한 수용** - 공익사업을 위해 수용되는 경우 - 수용감면 규정에 따라 비과세 적용 **5. 기타 특례** - 농지의 농업경영을 위한 양도 - 장기임대주택의 일정 범위 비과세 - 기타 세법에서 정한 특례사항 **6. 주의사항** - 비과세 요건을 충족하더라도 신고는 필요합니다 - 각 요건의 세부 조건을 정확히 확인해야 합니다 - 세법 개정에 따라 요건이 변경될 수 있습니다 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3]
            },
            {
                id: 57,
                question: "양도소득세 신고 기한은 언제인가요?",
                answer: "답변: 양도소득세 신고 기한은 다음과 같습니다: **1. 일반적인 신고 기한** - 양도일이 속하는 연도의 다음 연도 5월 31일까지 신고 - 예: 2024년에 양도한 경우 → 2025년 5월 31일까지 신고 **2. 신고 방법** - 전자신고: 홈택스(www.hometax.go.kr)를 통한 전자신고 - 서면신고: 관할 세무서에 직접 제출 **3. 신고와 동시에 납부** - 양도소득세는 신고와 동시에 납부해야 합니다 - 신고만 하고 납부하지 않으면 가산세가 부과됩니다 **4. 기한 후 신고** - 기한 후 신고 시 가산세가 부과됩니다 - 가산세율: 신고기한 경과일수에 따라 차등 적용 **5. 특별한 경우** - 상속으로 인한 양도: 상속개시일로부터 6개월 이내 - 기타 특례: 관련 법령에 따라 별도 기한이 정해질 수 있습니다 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3]
            },
            {
                id: 58,
                question: "양도소득세 세율은 어떻게 되나요?",
                answer: "답변: 양도소득세 세율은 다음과 같습니다: **1. 기본세율 (누진세율)** - 1,200만원 이하: 6% - 1,200만원 초과 ~ 4,600만원 이하: 15% - 4,600만원 초과 ~ 8,800만원 이하: 24% - 8,800만원 초과 ~ 1.5억원 이하: 35% - 1.5억원 초과 ~ 3억원 이하: 38% - 3억원 초과 ~ 5억원 이하: 40% - 5억원 초과: 42% **2. 비사업용 토지 중과세율** - 기본세율 + 10%p 추가 적용 - 예: 기본세율 35%인 경우 → 45% 적용 **3. 단기 양도 중과세율** - 1년 미만 보유: 70% - 1~2년 미만 보유: 60% **4. 장기보유특별공제** - 보유기간: 연수 × 4% (최대 40%) - 거주기간: 연수 × 4% (최대 40%) - 합산 최대 80% **5. 비과세 요건** - 1세대 1주택: 양도가액 12억원 이하 - 장기보유특별공제 적용 후 과세표준이 0원 이하인 경우 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3]
            },
            {
                id: 59,
                question: "양도소득세 장기보유특별공제는 어떻게 계산하나요?",
                answer: "답변: 양도소득세 장기보유특별공제는 다음과 같이 계산합니다: **1. 보유기간 공제** - 보유 연수 × 4% (최대 40%) - 예: 10년 보유 시 → 10년 × 4% = 40% **2. 거주기간 공제** - 거주 연수 × 4% (최대 40%) - 예: 8년 거주 시 → 8년 × 4% = 32% **3. 합산 공제** - 보유기간 공제 + 거주기간 공제 = 최대 80% - 예: 보유 40% + 거주 32% = 72% **4. 계산 예시** - 양도차익: 1억원 - 보유기간: 10년 (40% 공제) - 거주기간: 8년 (32% 공제) - 총 공제율: 72% - 과세표준: 1억원 × (1 - 0.72) = 2,800만원 **5. 주의사항** - 보유기간과 거주기간은 별도로 계산됩니다 - 해외체류 등 부득이한 사유로 인한 부재는 거주기간에 포함됩니다 - 조정대상지역은 실거주 요건이 추가로 필요합니다 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3]
            },
            {
                id: 60,
                question: "양도소득세 계산 방법을 알려주세요",
                answer: "답변: 양도소득세 계산 방법은 다음과 같습니다: **1. 양도차익 계산** 양도차익 = 양도가액 - 취득가액 - 필요경비 **2. 과세표준 계산** 과세표준 = 양도차익 - 장기보유특별공제 - 기본공제(연 250만원) **3. 세율 적용** - 기본세율: 6%~45% (누진세율) - 비사업용 토지: 기본세율 + 10%p (중과세율) **4. 장기보유특별공제** - 보유기간: 연수 × 4% (최대 40%) - 거주기간: 연수 × 4% (최대 40%) - 합산 최대 80% **5. 세액 계산** 양도소득세 = 과세표준 × 세율 **6. 비과세 요건** - 1세대 1주택: 양도가액 12억원 이하 - 장기보유특별공제 적용 후 과세표준이 0원 이하인 경우 **7. 신고 및 납부** - 양도일이 속하는 연도의 다음 연도 5월 31일까지 신고 - 세액은 신고와 동시에 납부 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3]
            },
            {
                id: 61,
                question: "양도소득세 비과세 요건에 대해 알려주세요",
                answer: "답변: 양도소득세 비과세 요건은 다음과 같습니다: **1. 1세대 1주택 비과세** - 1세대가 1주택을 보유하고 있는 경우 - 해당 주택에 2년 이상 거주한 경우 - 양도가액이 12억원 이하인 경우 **2. 장기보유특별공제 적용 후 과세표준이 0원 이하** - 보유기간과 거주기간에 따른 공제율 적용 후 - 과세표준이 0원 이하가 되는 경우 **3. 상속으로 인한 양도** - 상속으로 인한 양도는 원칙적으로 비과세 - 단, 상속세 납부 후 5년 이내 양도 시에는 과세될 수 있음 **4. 공익사업을 위한 수용** - 공익사업을 위해 수용되는 경우 - 수용감면 규정에 따라 비과세 적용 **5. 기타 특례** - 농지의 농업경영을 위한 양도 - 장기임대주택의 일정 범위 비과세 - 기타 세법에서 정한 특례사항 **6. 주의사항** - 비과세 요건을 충족하더라도 신고는 필요합니다 - 각 요건의 세부 조건을 정확히 확인해야 합니다 - 세법 개정에 따라 요건이 변경될 수 있습니다 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3]
            },
            {
                id: 62,
                question: "양도소득세 신고 기한은 언제인가요?",
                answer: "답변: 양도소득세 신고 기한은 다음과 같습니다: **1. 일반적인 신고 기한** - 양도일이 속하는 연도의 다음 연도 5월 31일까지 신고 - 예: 2024년에 양도한 경우 → 2025년 5월 31일까지 신고 **2. 신고 방법** - 전자신고: 홈택스(www.hometax.go.kr)를 통한 전자신고 - 서면신고: 관할 세무서에 직접 제출 **3. 신고와 동시에 납부** - 양도소득세는 신고와 동시에 납부해야 합니다 - 신고만 하고 납부하지 않으면 가산세가 부과됩니다 **4. 기한 후 신고** - 기한 후 신고 시 가산세가 부과됩니다 - 가산세율: 신고기한 경과일수에 따라 차등 적용 **5. 특별한 경우** - 상속으로 인한 양도: 상속개시일로부터 6개월 이내 - 기타 특례: 관련 법령에 따라 별도 기한이 정해질 수 있습니다 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3]
            },
            {
                id: 63,
                question: "양도소득세 세율은 어떻게 되나요?",
                answer: "답변: 양도소득세 세율은 다음과 같습니다: **1. 기본세율 (누진세율)** - 1,200만원 이하: 6% - 1,200만원 초과 ~ 4,600만원 이하: 15% - 4,600만원 초과 ~ 8,800만원 이하: 24% - 8,800만원 초과 ~ 1.5억원 이하: 35% - 1.5억원 초과 ~ 3억원 이하: 38% - 3억원 초과 ~ 5억원 이하: 40% - 5억원 초과: 42% **2. 비사업용 토지 중과세율** - 기본세율 + 10%p 추가 적용 - 예: 기본세율 35%인 경우 → 45% 적용 **3. 단기 양도 중과세율** - 1년 미만 보유: 70% - 1~2년 미만 보유: 60% **4. 장기보유특별공제** - 보유기간: 연수 × 4% (최대 40%) - 거주기간: 연수 × 4% (최대 40%) - 합산 최대 80% **5. 비과세 요건** - 1세대 1주택: 양도가액 12억원 이하 - 장기보유특별공제 적용 후 과세표준이 0원 이하인 경우 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3]
            },
            {
                id: 64,
                question: "양도소득세 장기보유특별공제는 어떻게 계산하나요?",
                answer: "답변: 양도소득세 장기보유특별공제는 다음과 같이 계산합니다: **1. 보유기간 공제** - 보유 연수 × 4% (최대 40%) - 예: 10년 보유 시 → 10년 × 4% = 40% **2. 거주기간 공제** - 거주 연수 × 4% (최대 40%) - 예: 8년 거주 시 → 8년 × 4% = 32% **3. 합산 공제** - 보유기간 공제 + 거주기간 공제 = 최대 80% - 예: 보유 40% + 거주 32% = 72% **4. 계산 예시** - 양도차익: 1억원 - 보유기간: 10년 (40% 공제) - 거주기간: 8년 (32% 공제) - 총 공제율: 72% - 과세표준: 1억원 × (1 - 0.72) = 2,800만원 **5. 주의사항** - 보유기간과 거주기간은 별도로 계산됩니다 - 해외체류 등 부득이한 사유로 인한 부재는 거주기간에 포함됩니다 - 조정대상지역은 실거주 요건이 추가로 필요합니다 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3]
            },
            {
                id: 65,
                question: "양도소득세 계산 방법을 알려주세요",
                answer: "답변: 양도소득세 계산 방법은 다음과 같습니다: **1. 양도차익 계산** 양도차익 = 양도가액 - 취득가액 - 필요경비 **2. 과세표준 계산** 과세표준 = 양도차익 - 장기보유특별공제 - 기본공제(연 250만원) **3. 세율 적용** - 기본세율: 6%~45% (누진세율) - 비사업용 토지: 기본세율 + 10%p (중과세율) **4. 장기보유특별공제** - 보유기간: 연수 × 4% (최대 40%) - 거주기간: 연수 × 4% (최대 40%) - 합산 최대 80% **5. 세액 계산** 양도소득세 = 과세표준 × 세율 **6. 비과세 요건** - 1세대 1주택: 양도가액 12억원 이하 - 장기보유특별공제 적용 후 과세표준이 0원 이하인 경우 **7. 신고 및 납부** - 양도일이 속하는 연도의 다음 연도 5월 31일까지 신고 - 세액은 신고와 동시에 납부 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3]
            },
            {
                id: 66,
                question: "양도소득세 비과세 요건에 대해 알려주세요",
                answer: "답변: 양도소득세 비과세 요건은 다음과 같습니다: **1. 1세대 1주택 비과세** - 1세대가 1주택을 보유하고 있는 경우 - 해당 주택에 2년 이상 거주한 경우 - 양도가액이 12억원 이하인 경우 **2. 장기보유특별공제 적용 후 과세표준이 0원 이하** - 보유기간과 거주기간에 따른 공제율 적용 후 - 과세표준이 0원 이하가 되는 경우 **3. 상속으로 인한 양도** - 상속으로 인한 양도는 원칙적으로 비과세 - 단, 상속세 납부 후 5년 이내 양도 시에는 과세될 수 있음 **4. 공익사업을 위한 수용** - 공익사업을 위해 수용되는 경우 - 수용감면 규정에 따라 비과세 적용 **5. 기타 특례** - 농지의 농업경영을 위한 양도 - 장기임대주택의 일정 범위 비과세 - 기타 세법에서 정한 특례사항 **6. 주의사항** - 비과세 요건을 충족하더라도 신고는 필요합니다 - 각 요건의 세부 조건을 정확히 확인해야 합니다 - 세법 개정에 따라 요건이 변경될 수 있습니다 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3]
            },
            {
                id: 67,
                question: "양도소득세 신고 기한은 언제인가요?",
                answer: "답변: 양도소득세 신고 기한은 다음과 같습니다: **1. 일반적인 신고 기한** - 양도일이 속하는 연도의 다음 연도 5월 31일까지 신고 - 예: 2024년에 양도한 경우 → 2025년 5월 31일까지 신고 **2. 신고 방법** - 전자신고: 홈택스(www.hometax.go.kr)를 통한 전자신고 - 서면신고: 관할 세무서에 직접 제출 **3. 신고와 동시에 납부** - 양도소득세는 신고와 동시에 납부해야 합니다 - 신고만 하고 납부하지 않으면 가산세가 부과됩니다 **4. 기한 후 신고** - 기한 후 신고 시 가산세가 부과됩니다 - 가산세율: 신고기한 경과일수에 따라 차등 적용 **5. 특별한 경우** - 상속으로 인한 양도: 상속개시일로부터 6개월 이내 - 기타 특례: 관련 법령에 따라 별도 기한이 정해질 수 있습니다 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3]
            },
            {
                id: 68,
                question: "양도소득세 세율은 어떻게 되나요?",
                answer: "답변: 양도소득세 세율은 다음과 같습니다: **1. 기본세율 (누진세율)** - 1,200만원 이하: 6% - 1,200만원 초과 ~ 4,600만원 이하: 15% - 4,600만원 초과 ~ 8,800만원 이하: 24% - 8,800만원 초과 ~ 1.5억원 이하: 35% - 1.5억원 초과 ~ 3억원 이하: 38% - 3억원 초과 ~ 5억원 이하: 40% - 5억원 초과: 42% **2. 비사업용 토지 중과세율** - 기본세율 + 10%p 추가 적용 - 예: 기본세율 35%인 경우 → 45% 적용 **3. 단기 양도 중과세율** - 1년 미만 보유: 70% - 1~2년 미만 보유: 60% **4. 장기보유특별공제** - 보유기간: 연수 × 4% (최대 40%) - 거주기간: 연수 × 4% (최대 40%) - 합산 최대 80% **5. 비과세 요건** - 1세대 1주택: 양도가액 12억원 이하 - 장기보유특별공제 적용 후 과세표준이 0원 이하인 경우 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3]
            },
            {
                id: 69,
                question: "양도소득세 장기보유특별공제는 어떻게 계산하나요?",
                answer: "답변: 양도소득세 장기보유특별공제는 다음과 같이 계산합니다: **1. 보유기간 공제** - 보유 연수 × 4% (최대 40%) - 예: 10년 보유 시 → 10년 × 4% = 40% **2. 거주기간 공제** - 거주 연수 × 4% (최대 40%) - 예: 8년 거주 시 → 8년 × 4% = 32% **3. 합산 공제** - 보유기간 공제 + 거주기간 공제 = 최대 80% - 예: 보유 40% + 거주 32% = 72% **4. 계산 예시** - 양도차익: 1억원 - 보유기간: 10년 (40% 공제) - 거주기간: 8년 (32% 공제) - 총 공제율: 72% - 과세표준: 1억원 × (1 - 0.72) = 2,800만원 **5. 주의사항** - 보유기간과 거주기간은 별도로 계산됩니다 - 해외체류 등 부득이한 사유로 인한 부재는 거주기간에 포함됩니다 - 조정대상지역은 실거주 요건이 추가로 필요합니다 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3]
            },
            {
                id: 70,
                question: "양도소득세 계산 방법을 알려주세요",
                answer: "답변: 양도소득세 계산 방법은 다음과 같습니다: **1. 양도차익 계산** 양도차익 = 양도가액 - 취득가액 - 필요경비 **2. 과세표준 계산** 과세표준 = 양도차익 - 장기보유특별공제 - 기본공제(연 250만원) **3. 세율 적용** - 기본세율: 6%~45% (누진세율) - 비사업용 토지: 기본세율 + 10%p (중과세율) **4. 장기보유특별공제** - 보유기간: 연수 × 4% (최대 40%) - 거주기간: 연수 × 4% (최대 40%) - 합산 최대 80% **5. 세액 계산** 양도소득세 = 과세표준 × 세율 **6. 비과세 요건** - 1세대 1주택: 양도가액 12억원 이하 - 장기보유특별공제 적용 후 과세표준이 0원 이하인 경우 **7. 신고 및 납부** - 양도일이 속하는 연도의 다음 연도 5월 31일까지 신고 - 세액은 신고와 동시에 납부 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3]
            },
            {
                id: 71,
                question: "양도소득세 비과세 요건에 대해 알려주세요",
                answer: "답변: 양도소득세 비과세 요건은 다음과 같습니다: **1. 1세대 1주택 비과세** - 1세대가 1주택을 보유하고 있는 경우 - 해당 주택에 2년 이상 거주한 경우 - 양도가액이 12억원 이하인 경우 **2. 장기보유특별공제 적용 후 과세표준이 0원 이하** - 보유기간과 거주기간에 따른 공제율 적용 후 - 과세표준이 0원 이하가 되는 경우 **3. 상속으로 인한 양도** - 상속으로 인한 양도는 원칙적으로 비과세 - 단, 상속세 납부 후 5년 이내 양도 시에는 과세될 수 있음 **4. 공익사업을 위한 수용** - 공익사업을 위해 수용되는 경우 - 수용감면 규정에 따라 비과세 적용 **5. 기타 특례** - 농지의 농업경영을 위한 양도 - 장기임대주택의 일정 범위 비과세 - 기타 세법에서 정한 특례사항 **6. 주의사항** - 비과세 요건을 충족하더라도 신고는 필요합니다 - 각 요건의 세부 조건을 정확히 확인해야 합니다 - 세법 개정에 따라 요건이 변경될 수 있습니다 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3]
            },
            {
                id: 72,
                question: "양도소득세 신고 기한은 언제인가요?",
                answer: "답변: 양도소득세 신고 기한은 다음과 같습니다: **1. 일반적인 신고 기한** - 양도일이 속하는 연도의 다음 연도 5월 31일까지 신고 - 예: 2024년에 양도한 경우 → 2025년 5월 31일까지 신고 **2. 신고 방법** - 전자신고: 홈택스(www.hometax.go.kr)를 통한 전자신고 - 서면신고: 관할 세무서에 직접 제출 **3. 신고와 동시에 납부** - 양도소득세는 신고와 동시에 납부해야 합니다 - 신고만 하고 납부하지 않으면 가산세가 부과됩니다 **4. 기한 후 신고** - 기한 후 신고 시 가산세가 부과됩니다 - 가산세율: 신고기한 경과일수에 따라 차등 적용 **5. 특별한 경우** - 상속으로 인한 양도: 상속개시일로부터 6개월 이내 - 기타 특례: 관련 법령에 따라 별도 기한이 정해질 수 있습니다 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3]
            },
            {
                id: 73,
                question: "양도소득세 세율은 어떻게 되나요?",
                answer: "답변: 양도소득세 세율은 다음과 같습니다: **1. 기본세율 (누진세율)** - 1,200만원 이하: 6% - 1,200만원 초과 ~ 4,600만원 이하: 15% - 4,600만원 초과 ~ 8,800만원 이하: 24% - 8,800만원 초과 ~ 1.5억원 이하: 35% - 1.5억원 초과 ~ 3억원 이하: 38% - 3억원 초과 ~ 5억원 이하: 40% - 5억원 초과: 42% **2. 비사업용 토지 중과세율** - 기본세율 + 10%p 추가 적용 - 예: 기본세율 35%인 경우 → 45% 적용 **3. 단기 양도 중과세율** - 1년 미만 보유: 70% - 1~2년 미만 보유: 60% **4. 장기보유특별공제** - 보유기간: 연수 × 4% (최대 40%) - 거주기간: 연수 × 4% (최대 40%) - 합산 최대 80% **5. 비과세 요건** - 1세대 1주택: 양도가액 12억원 이하 - 장기보유특별공제 적용 후 과세표준이 0원 이하인 경우 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3]
            },
            {
                id: 74,
                question: "양도소득세 장기보유특별공제는 어떻게 계산하나요?",
                answer: "답변: 양도소득세 장기보유특별공제는 다음과 같이 계산합니다: **1. 보유기간 공제** - 보유 연수 × 4% (최대 40%) - 예: 10년 보유 시 → 10년 × 4% = 40% **2. 거주기간 공제** - 거주 연수 × 4% (최대 40%) - 예: 8년 거주 시 → 8년 × 4% = 32% **3. 합산 공제** - 보유기간 공제 + 거주기간 공제 = 최대 80% - 예: 보유 40% + 거주 32% = 72% **4. 계산 예시** - 양도차익: 1억원 - 보유기간: 10년 (40% 공제) - 거주기간: 8년 (32% 공제) - 총 공제율: 72% - 과세표준: 1억원 × (1 - 0.72) = 2,800만원 **5. 주의사항** - 보유기간과 거주기간은 별도로 계산됩니다 - 해외체류 등 부득이한 사유로 인한 부재는 거주기간에 포함됩니다 - 조정대상지역은 실거주 요건이 추가로 필요합니다 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3]
            },
            {
                id: 75,
                question: "양도소득세 계산 방법을 알려주세요",
                answer: "답변: 양도소득세 계산 방법은 다음과 같습니다: **1. 양도차익 계산** 양도차익 = 양도가액 - 취득가액 - 필요경비 **2. 과세표준 계산** 과세표준 = 양도차익 - 장기보유특별공제 - 기본공제(연 250만원) **3. 세율 적용** - 기본세율: 6%~45% (누진세율) - 비사업용 토지: 기본세율 + 10%p (중과세율) **4. 장기보유특별공제** - 보유기간: 연수 × 4% (최대 40%) - 거주기간: 연수 × 4% (최대 40%) - 합산 최대 80% **5. 세액 계산** 양도소득세 = 과세표준 × 세율 **6. 비과세 요건** - 1세대 1주택: 양도가액 12억원 이하 - 장기보유특별공제 적용 후 과세표준이 0원 이하인 경우 **7. 신고 및 납부** - 양도일이 속하는 연도의 다음 연도 5월 31일까지 신고 - 세액은 신고와 동시에 납부 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3]
            },
            {
                id: 76,
                question: "양도소득세 비과세 요건에 대해 알려주세요",
                answer: "답변: 양도소득세 비과세 요건은 다음과 같습니다: **1. 1세대 1주택 비과세** - 1세대가 1주택을 보유하고 있는 경우 - 해당 주택에 2년 이상 거주한 경우 - 양도가액이 12억원 이하인 경우 **2. 장기보유특별공제 적용 후 과세표준이 0원 이하** - 보유기간과 거주기간에 따른 공제율 적용 후 - 과세표준이 0원 이하가 되는 경우 **3. 상속으로 인한 양도** - 상속으로 인한 양도는 원칙적으로 비과세 - 단, 상속세 납부 후 5년 이내 양도 시에는 과세될 수 있음 **4. 공익사업을 위한 수용** - 공익사업을 위해 수용되는 경우 - 수용감면 규정에 따라 비과세 적용 **5. 기타 특례** - 농지의 농업경영을 위한 양도 - 장기임대주택의 일정 범위 비과세 - 기타 세법에서 정한 특례사항 **6. 주의사항** - 비과세 요건을 충족하더라도 신고는 필요합니다 - 각 요건의 세부 조건을 정확히 확인해야 합니다 - 세법 개정에 따라 요건이 변경될 수 있습니다 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3]
            },
            {
                id: 77,
                question: "양도소득세 신고 기한은 언제인가요?",
                answer: "답변: 양도소득세 신고 기한은 다음과 같습니다: **1. 일반적인 신고 기한** - 양도일이 속하는 연도의 다음 연도 5월 31일까지 신고 - 예: 2024년에 양도한 경우 → 2025년 5월 31일까지 신고 **2. 신고 방법** - 전자신고: 홈택스(www.hometax.go.kr)를 통한 전자신고 - 서면신고: 관할 세무서에 직접 제출 **3. 신고와 동시에 납부** - 양도소득세는 신고와 동시에 납부해야 합니다 - 신고만 하고 납부하지 않으면 가산세가 부과됩니다 **4. 기한 후 신고** - 기한 후 신고 시 가산세가 부과됩니다 - 가산세율: 신고기한 경과일수에 따라 차등 적용 **5. 특별한 경우** - 상속으로 인한 양도: 상속개시일로부터 6개월 이내 - 기타 특례: 관련 법령에 따라 별도 기한이 정해질 수 있습니다 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3]
            },
            {
                id: 78,
                question: "양도소득세 세율은 어떻게 되나요?",
                answer: "답변: 양도소득세 세율은 다음과 같습니다: **1. 기본세율 (누진세율)** - 1,200만원 이하: 6% - 1,200만원 초과 ~ 4,600만원 이하: 15% - 4,600만원 초과 ~ 8,800만원 이하: 24% - 8,800만원 초과 ~ 1.5억원 이하: 35% - 1.5억원 초과 ~ 3억원 이하: 38% - 3억원 초과 ~ 5억원 이하: 40% - 5억원 초과: 42% **2. 비사업용 토지 중과세율** - 기본세율 + 10%p 추가 적용 - 예: 기본세율 35%인 경우 → 45% 적용 **3. 단기 양도 중과세율** - 1년 미만 보유: 70% - 1~2년 미만 보유: 60% **4. 장기보유특별공제** - 보유기간: 연수 × 4% (최대 40%) - 거주기간: 연수 × 4% (최대 40%) - 합산 최대 80% **5. 비과세 요건** - 1세대 1주택: 양도가액 12억원 이하 - 장기보유특별공제 적용 후 과세표준이 0원 이하인 경우 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3]
            },
            {
                id: 79,
                question: "양도소득세 장기보유특별공제는 어떻게 계산하나요?",
                answer: "답변: 양도소득세 장기보유특별공제는 다음과 같이 계산합니다: **1. 보유기간 공제** - 보유 연수 × 4% (최대 40%) - 예: 10년 보유 시 → 10년 × 4% = 40% **2. 거주기간 공제** - 거주 연수 × 4% (최대 40%) - 예: 8년 거주 시 → 8년 × 4% = 32% **3. 합산 공제** - 보유기간 공제 + 거주기간 공제 = 최대 80% - 예: 보유 40% + 거주 32% = 72% **4. 계산 예시** - 양도차익: 1억원 - 보유기간: 10년 (40% 공제) - 거주기간: 8년 (32% 공제) - 총 공제율: 72% - 과세표준: 1억원 × (1 - 0.72) = 2,800만원 **5. 주의사항** - 보유기간과 거주기간은 별도로 계산됩니다 - 해외체류 등 부득이한 사유로 인한 부재는 거주기간에 포함됩니다 - 조정대상지역은 실거주 요건이 추가로 필요합니다 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3]
            },
            {
                id: 80,
                question: "양도소득세 계산 방법을 알려주세요",
                answer: "답변: 양도소득세 계산 방법은 다음과 같습니다: **1. 양도차익 계산** 양도차익 = 양도가액 - 취득가액 - 필요경비 **2. 과세표준 계산** 과세표준 = 양도차익 - 장기보유특별공제 - 기본공제(연 250만원) **3. 세율 적용** - 기본세율: 6%~45% (누진세율) - 비사업용 토지: 기본세율 + 10%p (중과세율) **4. 장기보유특별공제** - 보유기간: 연수 × 4% (최대 40%) - 거주기간: 연수 × 4% (최대 40%) - 합산 최대 80% **5. 세액 계산** 양도소득세 = 과세표준 × 세율 **6. 비과세 요건** - 1세대 1주택: 양도가액 12억원 이하 - 장기보유특별공제 적용 후 과세표준이 0원 이하인 경우 **7. 신고 및 납부** - 양도일이 속하는 연도의 다음 연도 5월 31일까지 신고 - 세액은 신고와 동시에 납부 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3]
            },
            {
                id: 81,
                question: "양도소득세 비과세 요건에 대해 알려주세요",
                answer: "답변: 양도소득세 비과세 요건은 다음과 같습니다: **1. 1세대 1주택 비과세** - 1세대가 1주택을 보유하고 있는 경우 - 해당 주택에 2년 이상 거주한 경우 - 양도가액이 12억원 이하인 경우 **2. 장기보유특별공제 적용 후 과세표준이 0원 이하** - 보유기간과 거주기간에 따른 공제율 적용 후 - 과세표준이 0원 이하가 되는 경우 **3. 상속으로 인한 양도** - 상속으로 인한 양도는 원칙적으로 비과세 - 단, 상속세 납부 후 5년 이내 양도 시에는 과세될 수 있음 **4. 공익사업을 위한 수용** - 공익사업을 위해 수용되는 경우 - 수용감면 규정에 따라 비과세 적용 **5. 기타 특례** - 농지의 농업경영을 위한 양도 - 장기임대주택의 일정 범위 비과세 - 기타 세법에서 정한 특례사항 **6. 주의사항** - 비과세 요건을 충족하더라도 신고는 필요합니다 - 각 요건의 세부 조건을 정확히 확인해야 합니다 - 세법 개정에 따라 요건이 변경될 수 있습니다 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3]
            },
            {
                id: 82,
                question: "양도소득세 신고 기한은 언제인가요?",
                answer: "답변: 양도소득세 신고 기한은 다음과 같습니다: **1. 일반적인 신고 기한** - 양도일이 속하는 연도의 다음 연도 5월 31일까지 신고 - 예: 2024년에 양도한 경우 → 2025년 5월 31일까지 신고 **2. 신고 방법** - 전자신고: 홈택스(www.hometax.go.kr)를 통한 전자신고 - 서면신고: 관할 세무서에 직접 제출 **3. 신고와 동시에 납부** - 양도소득세는 신고와 동시에 납부해야 합니다 - 신고만 하고 납부하지 않으면 가산세가 부과됩니다 **4. 기한 후 신고** - 기한 후 신고 시 가산세가 부과됩니다 - 가산세율: 신고기한 경과일수에 따라 차등 적용 **5. 특별한 경우** - 상속으로 인한 양도: 상속개시일로부터 6개월 이내 - 기타 특례: 관련 법령에 따라 별도 기한이 정해질 수 있습니다 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3]
            },
            {
                id: 83,
                question: "양도소득세 세율은 어떻게 되나요?",
                answer: "답변: 양도소득세 세율은 다음과 같습니다: **1. 기본세율 (누진세율)** - 1,200만원 이하: 6% - 1,200만원 초과 ~ 4,600만원 이하: 15% - 4,600만원 초과 ~ 8,800만원 이하: 24% - 8,800만원 초과 ~ 1.5억원 이하: 35% - 1.5억원 초과 ~ 3억원 이하: 38% - 3억원 초과 ~ 5억원 이하: 40% - 5억원 초과: 42% **2. 비사업용 토지 중과세율** - 기본세율 + 10%p 추가 적용 - 예: 기본세율 35%인 경우 → 45% 적용 **3. 단기 양도 중과세율** - 1년 미만 보유: 70% - 1~2년 미만 보유: 60% **4. 장기보유특별공제** - 보유기간: 연수 × 4% (최대 40%) - 거주기간: 연수 × 4% (최대 40%) - 합산 최대 80% **5. 비과세 요건** - 1세대 1주택: 양도가액 12억원 이하 - 장기보유특별공제 적용 후 과세표준이 0원 이하인 경우 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3]
            },
            {
                id: 84,
                question: "양도소득세 장기보유특별공제는 어떻게 계산하나요?",
                answer: "답변: 양도소득세 장기보유특별공제는 다음과 같이 계산합니다: **1. 보유기간 공제** - 보유 연수 × 4% (최대 40%) - 예: 10년 보유 시 → 10년 × 4% = 40% **2. 거주기간 공제** - 거주 연수 × 4% (최대 40%) - 예: 8년 거주 시 → 8년 × 4% = 32% **3. 합산 공제** - 보유기간 공제 + 거주기간 공제 = 최대 80% - 예: 보유 40% + 거주 32% = 72% **4. 계산 예시** - 양도차익: 1억원 - 보유기간: 10년 (40% 공제) - 거주기간: 8년 (32% 공제) - 총 공제율: 72% - 과세표준: 1억원 × (1 - 0.72) = 2,800만원 **5. 주의사항** - 보유기간과 거주기간은 별도로 계산됩니다 - 해외체류 등 부득이한 사유로 인한 부재는 거주기간에 포함됩니다 - 조정대상지역은 실거주 요건이 추가로 필요합니다 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3]
            },
            {
                id: 85,
                question: "양도소득세 계산 방법을 알려주세요",
                answer: "답변: 양도소득세 계산 방법은 다음과 같습니다: **1. 양도차익 계산** 양도차익 = 양도가액 - 취득가액 - 필요경비 **2. 과세표준 계산** 과세표준 = 양도차익 - 장기보유특별공제 - 기본공제(연 250만원) **3. 세율 적용** - 기본세율: 6%~45% (누진세율) - 비사업용 토지: 기본세율 + 10%p (중과세율) **4. 장기보유특별공제** - 보유기간: 연수 × 4% (최대 40%) - 거주기간: 연수 × 4% (최대 40%) - 합산 최대 80% **5. 세액 계산** 양도소득세 = 과세표준 × 세율 **6. 비과세 요건** - 1세대 1주택: 양도가액 12억원 이하 - 장기보유특별공제 적용 후 과세표준이 0원 이하인 경우 **7. 신고 및 납부** - 양도일이 속하는 연도의 다음 연도 5월 31일까지 신고 - 세액은 신고와 동시에 납부 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3]
            },
            {
                id: 86,
                question: "양도소득세 비과세 요건에 대해 알려주세요",
                answer: "답변: 양도소득세 비과세 요건은 다음과 같습니다: **1. 1세대 1주택 비과세** - 1세대가 1주택을 보유하고 있는 경우 - 해당 주택에 2년 이상 거주한 경우 - 양도가액이 12억원 이하인 경우 **2. 장기보유특별공제 적용 후 과세표준이 0원 이하** - 보유기간과 거주기간에 따른 공제율 적용 후 - 과세표준이 0원 이하가 되는 경우 **3. 상속으로 인한 양도** - 상속으로 인한 양도는 원칙적으로 비과세 - 단, 상속세 납부 후 5년 이내 양도 시에는 과세될 수 있음 **4. 공익사업을 위한 수용** - 공익사업을 위해 수용되는 경우 - 수용감면 규정에 따라 비과세 적용 **5. 기타 특례** - 농지의 농업경영을 위한 양도 - 장기임대주택의 일정 범위 비과세 - 기타 세법에서 정한 특례사항 **6. 주의사항** - 비과세 요건을 충족하더라도 신고는 필요합니다 - 각 요건의 세부 조건을 정확히 확인해야 합니다 - 세법 개정에 따라 요건이 변경될 수 있습니다 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3]
            },
            {
                id: 87,
                question: "양도소득세 신고 기한은 언제인가요?",
                answer: "답변: 양도소득세 신고 기한은 다음과 같습니다: **1. 일반적인 신고 기한** - 양도일이 속하는 연도의 다음 연도 5월 31일까지 신고 - 예: 2024년에 양도한 경우 → 2025년 5월 31일까지 신고 **2. 신고 방법** - 전자신고: 홈택스(www.hometax.go.kr)를 통한 전자신고 - 서면신고: 관할 세무서에 직접 제출 **3. 신고와 동시에 납부** - 양도소득세는 신고와 동시에 납부해야 합니다 - 신고만 하고 납부하지 않으면 가산세가 부과됩니다 **4. 기한 후 신고** - 기한 후 신고 시 가산세가 부과됩니다 - 가산세율: 신고기한 경과일수에 따라 차등 적용 **5. 특별한 경우** - 상속으로 인한 양도: 상속개시일로부터 6개월 이내 - 기타 특례: 관련 법령에 따라 별도 기한이 정해질 수 있습니다 💡 **Tax Agent 안내 말씀** 'Tax Agent'는 언제나 최상의 답변을 제공하지만, 실제 양도세 업무를 진행하실 때는 전문가에게 문의 하는것도 필요합니다. 🏢 **",
                references: [1, 2, 3]
            }
        ];

        // ===== DATASET SEARCH FUNCTIONS =====

        // 질문과 답변 간의 유사도 계산 (간단한 키워드 매칭)
        function calculateSimilarity(userQuestion, datasetQuestion) {
            // 질문을 소문자로 변환하고 특수문자 제거
            const cleanUser = userQuestion.toLowerCase().replace(/[^\w\s가-힣]/g, ' ').trim();
            const cleanDataset = datasetQuestion.toLowerCase().replace(/[^\w\s가-힣]/g, ' ').trim();
            
            // 공통 키워드 찾기
            const userWords = cleanUser.split(/\s+/);
            const datasetWords = cleanDataset.split(/\s+/);
            
            let commonWords = 0;
            let totalWords = userWords.length + datasetWords.length;
            
            for (const userWord of userWords) {
                if (userWord.length > 1 && datasetWords.includes(userWord)) {
                    commonWords++;
                }
            }
            
            // 유사도 점수 계산 (0~1)
            return totalWords > 0 ? (commonWords * 2) / totalWords : 0;
        }

        // 데이터셋에서 가장 유사한 답변 찾기
        function findBestMatch(userQuestion, threshold = 0.3) {
            let bestMatch = null;
            let bestScore = 0;
            
            for (const item of taxGoldDataset) {
                const score = calculateSimilarity(userQuestion, item.question);
                if (score > bestScore && score >= threshold) {
                    bestScore = score;
                    bestMatch = { ...item, score };
                }
            }
            
            return bestMatch;
        }

        // 데이터셋 답변 구조화 함수
        function formatDatasetAnswer(answer) {
            // "답변:" 부분 제거
            let formattedAnswer = answer.replace(/^답변:\s*/, '');
            
            // 번호가 있는 항목들을 찾아서 구조화
            formattedAnswer = formattedAnswer.replace(/\*\*(\d+)\.\s*\*\*/g, '<br><br><strong>$1.</strong> ');
            
            // "**제목**" 형태를 찾아서 구조화
            formattedAnswer = formattedAnswer.replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>');
            
            // 줄바꿈 처리
            formattedAnswer = formattedAnswer.replace(/\n/g, '<br>');
            
            // 연속된 <br> 태그 정리
            formattedAnswer = formattedAnswer.replace(/<br><br><br>/g, '<br><br>');
            
            return formattedAnswer;
        }

        // 데이터셋 검색 결과 표시 (기존 API 답변과 동일한 형식)
        function displayDatasetResult(match, userQuestion = '') {
            const messagesEl = document.getElementById('messages');
            const messageEl = document.createElement('div');
            messageEl.className = 'message bot';
            
            // 메시지 ID 생성
            const messageId = 'msg_' + Date.now();
            messageEl.id = messageId;
            
            // 피드백용 데이터 정리 (HTML 태그 제거, 길이 제한)
            const cleanAnswer = cleanTextForFeedback(match.answer);
            const cleanQuestion = cleanTextForFeedback(userQuestion);
            
            // 데이터셋 답변 구조화
            const formattedAnswer = formatDatasetAnswer(match.answer);
            
            messageEl.innerHTML = `
                <div class="message-avatar">💰</div>
                <div class="message-content">
                    ${formattedAnswer}
                    <div class="message-actions">
                        <button class="action-btn copy-btn" data-message-id="${messageId}" title="답변 복사">
                            📋 복사
                        </button>
                        <button class="action-btn feedback-btn" data-message-id="${messageId}" data-type="positive" data-question="${cleanQuestion}" data-answer="${cleanAnswer}" title="좋은 답변">
                            👍 좋은답변
                        </button>
                        <button class="action-btn feedback-btn negative" data-message-id="${messageId}" data-type="negative" data-question="${cleanQuestion}" data-answer="${cleanAnswer}" title="나쁜 답변">
                            👎 나쁜답변
                        </button>
                    </div>
                </div>
            `;
            
            messagesEl.appendChild(messageEl);
            scrollToBottom();
        }
    </script>
  </body>
  </html>